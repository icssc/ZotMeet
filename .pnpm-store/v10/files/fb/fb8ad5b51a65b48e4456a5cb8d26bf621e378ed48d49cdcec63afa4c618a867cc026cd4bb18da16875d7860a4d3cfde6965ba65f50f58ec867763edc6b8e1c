{"version":3,"file":"count.js","names":["params: {\n\t\t\tsource: SQLiteTable | SQLiteView | SQL | SQLWrapper;\n\t\t\tfilters?: SQL<unknown>;\n\t\t\tsession: TSession;\n\t\t}"],"sources":["../../../src/sqlite-core/query-builders/count.ts"],"sourcesContent":["import { entityKind } from '~/entity.ts';\nimport { SQL, sql, type SQLWrapper } from '~/sql/sql.ts';\nimport type { SQLiteSession } from '../session.ts';\nimport type { SQLiteTable } from '../table.ts';\nimport type { SQLiteView } from '../view.ts';\n\nexport class SQLiteCountBuilder<\n\tTSession extends SQLiteSession<any, any, any, any>,\n> extends SQL<number> implements Promise<number>, SQLWrapper<number> {\n\tprivate sql: SQL<number>;\n\n\tstatic override readonly [entityKind]: string = 'SQLiteCountBuilderAsync';\n\t[Symbol.toStringTag] = 'SQLiteCountBuilderAsync';\n\n\tprivate session: TSession;\n\n\tprivate static buildEmbeddedCount(\n\t\tsource: SQLiteTable | SQLiteView | SQL | SQLWrapper,\n\t\tfilters?: SQL<unknown>,\n\t): SQL<number> {\n\t\treturn sql<number>`(select count(*) from ${source}${sql.raw(' where ').if(filters)}${filters})`;\n\t}\n\n\tprivate static buildCount(\n\t\tsource: SQLiteTable | SQLiteView | SQL | SQLWrapper,\n\t\tfilters?: SQL<unknown>,\n\t): SQL<number> {\n\t\treturn sql<number>`select count(*) from ${source}${sql.raw(' where ').if(filters)}${filters}`;\n\t}\n\n\tconstructor(\n\t\treadonly params: {\n\t\t\tsource: SQLiteTable | SQLiteView | SQL | SQLWrapper;\n\t\t\tfilters?: SQL<unknown>;\n\t\t\tsession: TSession;\n\t\t},\n\t) {\n\t\tsuper(SQLiteCountBuilder.buildEmbeddedCount(params.source, params.filters).queryChunks);\n\n\t\tthis.session = params.session;\n\n\t\tthis.sql = SQLiteCountBuilder.buildCount(\n\t\t\tparams.source,\n\t\t\tparams.filters,\n\t\t);\n\t}\n\n\tthen<TResult1 = number, TResult2 = never>(\n\t\tonfulfilled?: ((value: number) => TResult1 | PromiseLike<TResult1>) | null | undefined,\n\t\tonrejected?: ((reason: any) => TResult2 | PromiseLike<TResult2>) | null | undefined,\n\t): Promise<TResult1 | TResult2> {\n\t\treturn Promise.resolve(this.session.count(this.sql)).then(\n\t\t\tonfulfilled,\n\t\t\tonrejected,\n\t\t);\n\t}\n\n\tcatch(\n\t\tonRejected?: ((reason: any) => never | PromiseLike<never>) | null | undefined,\n\t): Promise<number> {\n\t\treturn this.then(undefined, onRejected);\n\t}\n\n\tfinally(onFinally?: (() => void) | null | undefined): Promise<number> {\n\t\treturn this.then(\n\t\t\t(value) => {\n\t\t\t\tonFinally?.();\n\t\t\t\treturn value;\n\t\t\t},\n\t\t\t(reason) => {\n\t\t\t\tonFinally?.();\n\t\t\t\tthrow reason;\n\t\t\t},\n\t\t);\n\t}\n}\n"],"mappings":";;;;AAMA,IAAa,qBAAb,MAAa,2BAEH,IAA2D;CACpE,AAAQ;CAER,QAA0B,cAAsB;CAChD,CAAC,OAAO,eAAe;CAEvB,AAAQ;CAER,OAAe,mBACd,QACA,SACc;AACd,SAAO,GAAW,yBAAyB,SAAS,IAAI,IAAI,UAAU,CAAC,GAAG,QAAQ,GAAG,QAAQ;;CAG9F,OAAe,WACd,QACA,SACc;AACd,SAAO,GAAW,wBAAwB,SAAS,IAAI,IAAI,UAAU,CAAC,GAAG,QAAQ,GAAG;;CAGrF,YACC,AAASA,QAKR;AACD,QAAM,mBAAmB,mBAAmB,OAAO,QAAQ,OAAO,QAAQ,CAAC,YAAY;EAN9E;AAQT,OAAK,UAAU,OAAO;AAEtB,OAAK,MAAM,mBAAmB,WAC7B,OAAO,QACP,OAAO,QACP;;CAGF,KACC,aACA,YAC+B;AAC/B,SAAO,QAAQ,QAAQ,KAAK,QAAQ,MAAM,KAAK,IAAI,CAAC,CAAC,KACpD,aACA,WACA;;CAGF,MACC,YACkB;AAClB,SAAO,KAAK,KAAK,QAAW,WAAW;;CAGxC,QAAQ,WAA8D;AACrE,SAAO,KAAK,MACV,UAAU;AACV,gBAAa;AACb,UAAO;MAEP,WAAW;AACX,gBAAa;AACb,SAAM;IAEP"}