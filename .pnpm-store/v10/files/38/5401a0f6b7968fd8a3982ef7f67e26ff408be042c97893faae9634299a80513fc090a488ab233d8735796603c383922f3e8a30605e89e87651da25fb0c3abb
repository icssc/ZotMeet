{"version":3,"file":"delete.cjs","names":["PgDeleteBase","entityKind","tracer","extractUsedTable","QueryPromise"],"sources":["../../../src/pg-core/async/delete.ts"],"sourcesContent":["import { entityKind } from '~/entity.ts';\nimport type { PgQueryResultHKT, PgQueryResultKind, PreparedQueryConfig } from '~/pg-core/session.ts';\nimport type { PgTable } from '~/pg-core/table.ts';\nimport type { TypedQueryBuilder } from '~/query-builders/query-builder.ts';\nimport { QueryPromise } from '~/query-promise.ts';\nimport type { RunnableQuery } from '~/runnable-query.ts';\nimport type { ColumnsSelection, SQLWrapper } from '~/sql/sql.ts';\nimport { tracer } from '~/tracing.ts';\nimport { applyMixins, type Assume, type NeonAuthToken } from '~/utils.ts';\nimport { PgDeleteBase, type PgDeleteHKTBase } from '../query-builders/delete.ts';\nimport { extractUsedTable } from '../utils.ts';\nimport type { PgAsyncPreparedQuery, PgAsyncSession } from './session.ts';\n\nexport type PgAsyncDelete<\n\tTTable extends PgTable = PgTable,\n\tTQueryResult extends PgQueryResultHKT = PgQueryResultHKT,\n\tTSelectedFields extends ColumnsSelection | undefined = undefined,\n\tTReturning extends Record<string, unknown> | undefined = Record<string, unknown> | undefined,\n> = PgAsyncDeleteBase<TTable, TQueryResult, TSelectedFields, TReturning, true, never>;\n\nexport type PgAsyncDeletePrepare<T extends AnyAsyncPgDelete> = PgAsyncPreparedQuery<\n\tPreparedQueryConfig & {\n\t\texecute: T['_']['returning'] extends undefined ? PgQueryResultKind<T['_']['queryResult'], never>\n\t\t\t: T['_']['returning'][];\n\t}\n>;\n\nexport type AnyAsyncPgDelete = PgAsyncDeleteBase<any, any, any, any, any, any>;\n\nexport interface PgAsyncDeleteHKT extends PgDeleteHKTBase {\n\t_type: PgAsyncDeleteBase<\n\t\tAssume<this['table'], PgTable>,\n\t\tAssume<this['queryResult'], PgQueryResultHKT>,\n\t\tAssume<this['selectedFields'], ColumnsSelection | undefined>,\n\t\tAssume<this['returning'], Record<string, unknown> | undefined>,\n\t\tthis['dynamic'],\n\t\tthis['excludedMethods']\n\t>;\n}\n\nexport interface PgAsyncDeleteBase<\n\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\n\tTTable extends PgTable,\n\tTQueryResult extends PgQueryResultHKT,\n\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\n\tTSelectedFields extends ColumnsSelection | undefined = undefined,\n\tTReturning extends Record<string, unknown> | undefined = undefined,\n\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\n\tTDynamic extends boolean = false,\n\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\n\tTExcludedMethods extends string = never,\n> extends QueryPromise<TReturning extends undefined ? PgQueryResultKind<TQueryResult, never> : TReturning[]> {}\n\nexport class PgAsyncDeleteBase<\n\tTTable extends PgTable,\n\tTQueryResult extends PgQueryResultHKT,\n\tTSelectedFields extends ColumnsSelection | undefined = undefined,\n\tTReturning extends Record<string, unknown> | undefined = undefined,\n\tTDynamic extends boolean = false,\n\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\n\tTExcludedMethods extends string = never,\n> extends PgDeleteBase<PgAsyncDeleteHKT, TTable, TQueryResult, TSelectedFields, TReturning, TDynamic, TExcludedMethods>\n\timplements\n\t\tTypedQueryBuilder<\n\t\t\tTSelectedFields,\n\t\t\tTReturning extends undefined ? PgQueryResultKind<TQueryResult, never> : TReturning[]\n\t\t>,\n\t\tRunnableQuery<TReturning extends undefined ? PgQueryResultKind<TQueryResult, never> : TReturning[], 'pg'>,\n\t\tSQLWrapper\n{\n\tstatic override readonly [entityKind]: string = 'PgAsyncDelete';\n\n\tdeclare protected session: PgAsyncSession;\n\n\t/** @internal */\n\t_prepare(name?: string): PgAsyncDeletePrepare<this> {\n\t\treturn tracer.startActiveSpan('drizzle.prepareQuery', () => {\n\t\t\treturn this.session.prepareQuery<\n\t\t\t\tPreparedQueryConfig & {\n\t\t\t\t\texecute: TReturning extends undefined ? PgQueryResultKind<TQueryResult, never> : TReturning[];\n\t\t\t\t}\n\t\t\t>(this.dialect.sqlToQuery(this.getSQL()), this.config.returning, name, true, undefined, {\n\t\t\t\ttype: 'delete',\n\t\t\t\ttables: extractUsedTable(this.config.table),\n\t\t\t}, this.cacheConfig).setToken(this.authToken);\n\t\t});\n\t}\n\n\tprepare(name: string): PgAsyncDeletePrepare<this> {\n\t\treturn this._prepare(name);\n\t}\n\n\t/** @internal */\n\tprivate authToken?: NeonAuthToken;\n\t/** @internal */\n\tsetToken(token?: NeonAuthToken) {\n\t\tthis.authToken = token;\n\t\treturn this;\n\t}\n\n\texecute: ReturnType<this['prepare']>['execute'] = (placeholderValues) => {\n\t\treturn tracer.startActiveSpan('drizzle.operation', () => {\n\t\t\treturn this._prepare().execute(placeholderValues);\n\t\t});\n\t};\n}\n\napplyMixins(PgAsyncDeleteBase, [QueryPromise]);\n"],"mappings":";;;;;;;;;AAqDA,IAAa,oBAAb,cAQUA,mDAQV;CACC,QAA0BC,0BAAsB;;CAKhD,SAAS,MAA2C;AACnD,SAAOC,oBAAO,gBAAgB,8BAA8B;AAC3D,UAAO,KAAK,QAAQ,aAIlB,KAAK,QAAQ,WAAW,KAAK,QAAQ,CAAC,EAAE,KAAK,OAAO,WAAW,MAAM,MAAM,QAAW;IACvF,MAAM;IACN,QAAQC,uCAAiB,KAAK,OAAO,MAAM;IAC3C,EAAE,KAAK,YAAY,CAAC,SAAS,KAAK,UAAU;IAC5C;;CAGH,QAAQ,MAA0C;AACjD,SAAO,KAAK,SAAS,KAAK;;;CAI3B,AAAQ;;CAER,SAAS,OAAuB;AAC/B,OAAK,YAAY;AACjB,SAAO;;CAGR,WAAmD,sBAAsB;AACxE,SAAOD,oBAAO,gBAAgB,2BAA2B;AACxD,UAAO,KAAK,UAAU,CAAC,QAAQ,kBAAkB;IAChD;;;4BAIQ,mBAAmB,CAACE,gCAAa,CAAC"}