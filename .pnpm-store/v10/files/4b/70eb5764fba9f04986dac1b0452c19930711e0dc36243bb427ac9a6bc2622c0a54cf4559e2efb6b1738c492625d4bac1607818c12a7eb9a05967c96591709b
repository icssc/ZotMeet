{"version":3,"file":"schema.cjs","names":["entityKind","schemaName: TName","cockroachTableWithSchema","EnableRLS","cockroachViewWithSchema","cockroachMaterializedViewWithSchema","cockroachEnumWithSchema","cockroachEnumObjectWithSchema","cockroachSequenceWithSchema","SQL","sql"],"sources":["../../src/cockroach-core/schema.ts"],"sourcesContent":["import { entityKind, is } from '~/entity.ts';\nimport { SQL, sql, type SQLWrapper } from '~/sql/sql.ts';\nimport type { NonArray, Writable } from '~/utils.ts';\nimport {\n\ttype CockroachEnum,\n\ttype CockroachEnumObject,\n\tcockroachEnumObjectWithSchema,\n\tcockroachEnumWithSchema,\n} from './columns/enum.ts';\nimport { type cockroachSequence, cockroachSequenceWithSchema } from './sequence.ts';\nimport { type CockroachTableFn, type CockroachTableFnInternal, cockroachTableWithSchema, EnableRLS } from './table.ts';\nimport {\n\ttype cockroachMaterializedView,\n\tcockroachMaterializedViewWithSchema,\n\ttype cockroachView,\n\tcockroachViewWithSchema,\n} from './view.ts';\n\nexport class CockroachSchema<TName extends string = string> implements SQLWrapper {\n\tstatic readonly [entityKind]: string = 'CockroachSchema';\n\n\tisExisting: boolean = false;\n\tconstructor(\n\t\tpublic readonly schemaName: TName,\n\t) {\n\t\tthis.table = Object.assign(this.table, {\n\t\t\twithRLS: ((name, columns, extraConfig) => {\n\t\t\t\tconst table = cockroachTableWithSchema(name, columns, extraConfig, this.schemaName);\n\t\t\t\ttable[EnableRLS] = true;\n\n\t\t\t\treturn table;\n\t\t\t}) as CockroachTableFnInternal<TName>,\n\t\t});\n\t}\n\n\ttable: CockroachTableFn<TName> = ((name, columns, extraConfig) => {\n\t\treturn cockroachTableWithSchema(name, columns, extraConfig, this.schemaName);\n\t}) as CockroachTableFn<TName>;\n\n\tview = ((name, columns) => {\n\t\treturn cockroachViewWithSchema(name, columns, this.schemaName);\n\t}) as typeof cockroachView;\n\n\tmaterializedView = ((name, columns) => {\n\t\treturn cockroachMaterializedViewWithSchema(name, columns, this.schemaName);\n\t}) as typeof cockroachMaterializedView;\n\n\tpublic enum<U extends string, T extends Readonly<[U, ...U[]]>>(\n\t\tenumName: string,\n\t\tvalues: T | Writable<T>,\n\t): CockroachEnum<Writable<T>>;\n\n\tpublic enum<E extends Record<string, string>>(\n\t\tenumName: string,\n\t\tenumObj: NonArray<E>,\n\t): CockroachEnumObject<E>;\n\n\tpublic enum(enumName: any, input: any): any {\n\t\treturn Array.isArray(input)\n\t\t\t? cockroachEnumWithSchema(\n\t\t\t\tenumName,\n\t\t\t\t[...input] as [string, ...string[]],\n\t\t\t\tthis.schemaName,\n\t\t\t)\n\t\t\t: cockroachEnumObjectWithSchema(enumName, input, this.schemaName);\n\t}\n\n\tsequence: typeof cockroachSequence = ((name, options) => {\n\t\treturn cockroachSequenceWithSchema(name, options, this.schemaName);\n\t});\n\n\tgetSQL(): SQL {\n\t\treturn new SQL([sql.identifier(this.schemaName)]);\n\t}\n\n\tshouldOmitSQLParens(): boolean {\n\t\treturn true;\n\t}\n\n\texisting(): this {\n\t\tthis.isExisting = true;\n\t\treturn this;\n\t}\n}\n\nexport function isCockroachSchema(obj: unknown): obj is CockroachSchema {\n\treturn is(obj, CockroachSchema);\n}\n\nexport function cockroachSchema<T extends string>(name: T) {\n\tif (name === 'public') {\n\t\tthrow new Error(\n\t\t\t`You can't specify 'public' as schema name. Postgres is using public schema by default. If you want to use 'public' schema, just use cockroachTable() instead of creating a schema`,\n\t\t);\n\t}\n\n\treturn new CockroachSchema(name);\n}\n"],"mappings":";;;;;;;;;AAkBA,IAAa,kBAAb,MAAkF;CACjF,QAAiBA,0BAAsB;CAEvC,aAAsB;CACtB,YACC,AAAgBC,YACf;EADe;AAEhB,OAAK,QAAQ,OAAO,OAAO,KAAK,OAAO,EACtC,WAAW,MAAM,SAAS,gBAAgB;GACzC,MAAM,QAAQC,sDAAyB,MAAM,SAAS,aAAa,KAAK,WAAW;AACnF,SAAMC,0CAAa;AAEnB,UAAO;MAER,CAAC;;CAGH,UAAmC,MAAM,SAAS,gBAAgB;AACjE,SAAOD,sDAAyB,MAAM,SAAS,aAAa,KAAK,WAAW;;CAG7E,SAAS,MAAM,YAAY;AAC1B,SAAOE,oDAAwB,MAAM,SAAS,KAAK,WAAW;;CAG/D,qBAAqB,MAAM,YAAY;AACtC,SAAOC,gEAAoC,MAAM,SAAS,KAAK,WAAW;;CAa3E,AAAO,KAAK,UAAe,OAAiB;AAC3C,SAAO,MAAM,QAAQ,MAAM,GACxBC,4DACD,UACA,CAAC,GAAG,MAAM,EACV,KAAK,WACL,GACCC,kEAA8B,UAAU,OAAO,KAAK,WAAW;;CAGnE,aAAuC,MAAM,YAAY;AACxD,SAAOC,4DAA4B,MAAM,SAAS,KAAK,WAAW;;CAGnE,SAAc;AACb,SAAO,IAAIC,iBAAI,CAACC,iBAAI,WAAW,KAAK,WAAW,CAAC,CAAC;;CAGlD,sBAA+B;AAC9B,SAAO;;CAGR,WAAiB;AAChB,OAAK,aAAa;AAClB,SAAO;;;AAIT,SAAgB,kBAAkB,KAAsC;AACvE,4BAAU,KAAK,gBAAgB;;AAGhC,SAAgB,gBAAkC,MAAS;AAC1D,KAAI,SAAS,SACZ,OAAM,IAAI,MACT,oLACA;AAGF,QAAO,IAAI,gBAAgB,KAAK"}