{"version":3,"file":"casing.cjs","names":["entityKind","Table","is","Column"],"sources":["../src/casing.ts"],"sourcesContent":["import { Column } from '~/column.ts';\nimport { entityKind, is } from './entity.ts';\nimport type { View } from './sql/index.ts';\nimport { Table } from './table.ts';\nimport type { Casing } from './utils.ts';\n\nexport function toSnakeCase(input: string) {\n\tconst words = input\n\t\t.replace(/['\\u2019]/g, '')\n\t\t.match(/[\\da-z]+|[A-Z]+(?![a-z])|[A-Z][\\da-z]+/g) ?? [];\n\n\treturn words.map((word) => word.toLowerCase()).join('_');\n}\n\nexport function toCamelCase(input: string) {\n\tconst words = input\n\t\t.replace(/['\\u2019]/g, '')\n\t\t.match(/[\\da-z]+|[A-Z]+(?![a-z])|[A-Z][\\da-z]+/g) ?? [];\n\n\treturn words.reduce((acc, word, i) => {\n\t\tconst formattedWord = i === 0 ? word.toLowerCase() : `${word[0]!.toUpperCase()}${word.slice(1)}`;\n\t\treturn acc + formattedWord;\n\t}, '');\n}\n\nfunction noopCase(input: string) {\n\treturn input;\n}\n\nexport class CasingCache {\n\tstatic readonly [entityKind]: string = 'CasingCache';\n\n\t/** @internal */\n\tcache: Record<string, string> = {};\n\tprivate cachedTables: Record<string, true> = {};\n\tprivate convert: (input: string) => string;\n\n\tconstructor(casing?: Casing) {\n\t\tthis.convert = casing === 'snake_case'\n\t\t\t? toSnakeCase\n\t\t\t: casing === 'camelCase'\n\t\t\t? toCamelCase\n\t\t\t: noopCase;\n\t}\n\n\tgetColumnCasing(column: Column): string {\n\t\tif (!column.keyAsName) return column.name;\n\n\t\tconst schema = column.table[Table.Symbol.Schema] ?? 'public';\n\t\tconst tableName = column.table[Table.Symbol.OriginalName];\n\t\tconst key = `${schema}.${tableName}.${column.name}`;\n\n\t\tif (!this.cache[key]) {\n\t\t\tthis.cacheTable(column.table);\n\t\t}\n\t\treturn this.cache[key]!;\n\t}\n\n\tprivate cacheTable(table: Table | View) {\n\t\tconst schema = table[Table.Symbol.Schema] ?? 'public';\n\t\tconst tableName = table[Table.Symbol.OriginalName];\n\t\tconst tableKey = `${schema}.${tableName}`;\n\n\t\tif (!this.cachedTables[tableKey]) {\n\t\t\tfor (const column of Object.values(table[Table.Symbol.Columns])) {\n\t\t\t\tif (!is(column, Column)) continue;\n\n\t\t\t\tconst columnKey = `${tableKey}.${column.name}`;\n\t\t\t\tthis.cache[columnKey] = this.convert(column.name);\n\t\t\t}\n\t\t\tthis.cachedTables[tableKey] = true;\n\t\t}\n\t}\n\n\tclearCache() {\n\t\tthis.cache = {};\n\t\tthis.cachedTables = {};\n\t}\n}\n"],"mappings":";;;;;;AAMA,SAAgB,YAAY,OAAe;AAK1C,SAJc,MACZ,QAAQ,cAAc,GAAG,CACzB,MAAM,0CAA0C,IAAI,EAAE,EAE3C,KAAK,SAAS,KAAK,aAAa,CAAC,CAAC,KAAK,IAAI;;AAGzD,SAAgB,YAAY,OAAe;AAK1C,SAJc,MACZ,QAAQ,cAAc,GAAG,CACzB,MAAM,0CAA0C,IAAI,EAAE,EAE3C,QAAQ,KAAK,MAAM,MAAM;AAErC,SAAO,OADe,MAAM,IAAI,KAAK,aAAa,GAAG,GAAG,KAAK,GAAI,aAAa,GAAG,KAAK,MAAM,EAAE;IAE5F,GAAG;;AAGP,SAAS,SAAS,OAAe;AAChC,QAAO;;AAGR,IAAa,cAAb,MAAyB;CACxB,QAAiBA,6BAAsB;;CAGvC,QAAgC,EAAE;CAClC,AAAQ,eAAqC,EAAE;CAC/C,AAAQ;CAER,YAAY,QAAiB;AAC5B,OAAK,UAAU,WAAW,eACvB,cACA,WAAW,cACX,cACA;;CAGJ,gBAAgB,QAAwB;AACvC,MAAI,CAAC,OAAO,UAAW,QAAO,OAAO;EAIrC,MAAM,MAAM,GAFG,OAAO,MAAMC,oBAAM,OAAO,WAAW,SAE9B,GADJ,OAAO,MAAMA,oBAAM,OAAO,cACT,GAAG,OAAO;AAE7C,MAAI,CAAC,KAAK,MAAM,KACf,MAAK,WAAW,OAAO,MAAM;AAE9B,SAAO,KAAK,MAAM;;CAGnB,AAAQ,WAAW,OAAqB;EAGvC,MAAM,WAAW,GAFF,MAAMA,oBAAM,OAAO,WAAW,SAElB,GADT,MAAMA,oBAAM,OAAO;AAGrC,MAAI,CAAC,KAAK,aAAa,WAAW;AACjC,QAAK,MAAM,UAAU,OAAO,OAAO,MAAMA,oBAAM,OAAO,SAAS,EAAE;AAChE,QAAI,CAACC,kBAAG,QAAQC,mBAAO,CAAE;IAEzB,MAAM,YAAY,GAAG,SAAS,GAAG,OAAO;AACxC,SAAK,MAAM,aAAa,KAAK,QAAQ,OAAO,KAAK;;AAElD,QAAK,aAAa,YAAY;;;CAIhC,aAAa;AACZ,OAAK,QAAQ,EAAE;AACf,OAAK,eAAe,EAAE"}