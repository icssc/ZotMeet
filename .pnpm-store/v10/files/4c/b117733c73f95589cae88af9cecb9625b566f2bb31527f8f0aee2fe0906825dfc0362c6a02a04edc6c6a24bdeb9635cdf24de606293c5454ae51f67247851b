{"version":3,"sources":["../../../src/server/app-render/prospective-render-utils.ts"],"sourcesContent":["import { getDigestForWellKnownError } from './create-error-handler'\nimport { isReactLargeShellError } from './react-large-shell-error'\n\nexport enum Phase {\n  ProspectiveRender = 'the prospective render',\n  SegmentCollection = 'segment collection',\n}\n\nexport function printDebugThrownValueForProspectiveRender(\n  thrownValue: unknown,\n  route: string,\n  phase: Phase\n) {\n  // We don't need to print well-known Next.js errors.\n  if (getDigestForWellKnownError(thrownValue)) {\n    return\n  }\n\n  if (isReactLargeShellError(thrownValue)) {\n    // TODO: Aggregate\n    console.error(thrownValue)\n    return undefined\n  }\n\n  let message: undefined | string\n  if (\n    typeof thrownValue === 'object' &&\n    thrownValue !== null &&\n    typeof (thrownValue as any).message === 'string'\n  ) {\n    message = (thrownValue as any).message\n    if (typeof (thrownValue as any).stack === 'string') {\n      const originalErrorStack: string = (thrownValue as any).stack\n      const stackStart = originalErrorStack.indexOf('\\n')\n      if (stackStart > -1) {\n        const error = new Error(\n          `Route ${route} errored during ${phase}. These errors are normally ignored and may not prevent the route from prerendering but are logged here because build debugging is enabled.\n          \nOriginal Error: ${message}`\n        )\n        error.stack =\n          'Error: ' + error.message + originalErrorStack.slice(stackStart)\n        console.error(error)\n        return\n      }\n    }\n  } else if (typeof thrownValue === 'string') {\n    message = thrownValue\n  }\n\n  if (message) {\n    console.error(`Route ${route} errored during ${phase}. These errors are normally ignored and may not prevent the route from prerendering but are logged here because build debugging is enabled. No stack was provided.\n          \nOriginal Message: ${message}`)\n    return\n  }\n\n  console.error(\n    `Route ${route} errored during ${phase}. These errors are normally ignored and may not prevent the route from prerendering but are logged here because build debugging is enabled. The thrown value is logged just following this message`\n  )\n  console.error(thrownValue)\n  return\n}\n"],"names":["Phase","printDebugThrownValueForProspectiveRender","thrownValue","route","phase","getDigestForWellKnownError","isReactLargeShellError","console","error","undefined","message","stack","originalErrorStack","stackStart","indexOf","Error","slice"],"mappings":";;;;;;;;;;;;;;;IAGYA,KAAK;eAALA;;IAKIC,yCAAyC;eAAzCA;;;oCAR2B;sCACJ;AAEhC,IAAA,AAAKD,+BAAAA;;;WAAAA;;AAKL,SAASC,0CACdC,WAAoB,EACpBC,KAAa,EACbC,KAAY;IAEZ,oDAAoD;IACpD,IAAIC,IAAAA,8CAA0B,EAACH,cAAc;QAC3C;IACF;IAEA,IAAII,IAAAA,4CAAsB,EAACJ,cAAc;QACvC,kBAAkB;QAClBK,QAAQC,KAAK,CAACN;QACd,OAAOO;IACT;IAEA,IAAIC;IACJ,IACE,OAAOR,gBAAgB,YACvBA,gBAAgB,QAChB,OAAO,AAACA,YAAoBQ,OAAO,KAAK,UACxC;QACAA,UAAU,AAACR,YAAoBQ,OAAO;QACtC,IAAI,OAAO,AAACR,YAAoBS,KAAK,KAAK,UAAU;YAClD,MAAMC,qBAA6B,AAACV,YAAoBS,KAAK;YAC7D,MAAME,aAAaD,mBAAmBE,OAAO,CAAC;YAC9C,IAAID,aAAa,CAAC,GAAG;gBACnB,MAAML,QAAQ,qBAIb,CAJa,IAAIO,MAChB,CAAC,MAAM,EAAEZ,MAAM,gBAAgB,EAAEC,MAAM;;gBAEjC,EAAEM,SAAS,GAHL,qBAAA;2BAAA;gCAAA;kCAAA;gBAId;gBACAF,MAAMG,KAAK,GACT,YAAYH,MAAME,OAAO,GAAGE,mBAAmBI,KAAK,CAACH;gBACvDN,QAAQC,KAAK,CAACA;gBACd;YACF;QACF;IACF,OAAO,IAAI,OAAON,gBAAgB,UAAU;QAC1CQ,UAAUR;IACZ;IAEA,IAAIQ,SAAS;QACXH,QAAQC,KAAK,CAAC,CAAC,MAAM,EAAEL,MAAM,gBAAgB,EAAEC,MAAM;;kBAEvC,EAAEM,SAAS;QACzB;IACF;IAEAH,QAAQC,KAAK,CACX,CAAC,MAAM,EAAEL,MAAM,gBAAgB,EAAEC,MAAM,kMAAkM,CAAC;IAE5OG,QAAQC,KAAK,CAACN;IACd;AACF","ignoreList":[0]}