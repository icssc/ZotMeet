{"version":3,"file":"session.cjs","names":["MySqlPreparedQuery","entityKind","prisma: PrismaClient","query: Query","logger: Logger","MySqlSession","options: PrismaMySqlSessionOptions","NoopLogger"],"sources":["../../../src/prisma/mysql/session.ts"],"sourcesContent":["import type { PrismaClient } from '@prisma/client/extension';\n\nimport { entityKind } from '~/entity.ts';\nimport { type Logger, NoopLogger } from '~/logger.ts';\nimport type {\n\tMySqlDialect,\n\tMySqlPreparedQueryConfig,\n\tMySqlPreparedQueryHKT,\n\tMySqlQueryResultHKT,\n\tMySqlTransaction,\n\tMySqlTransactionConfig,\n} from '~/mysql-core/index.ts';\nimport { MySqlPreparedQuery, MySqlSession } from '~/mysql-core/index.ts';\nimport type { EmptyRelations } from '~/relations.ts';\nimport { fillPlaceholders } from '~/sql/sql.ts';\nimport type { Query, SQL } from '~/sql/sql.ts';\nimport type { Assume } from '~/utils.ts';\n\nexport class PrismaMySqlPreparedQuery<T> extends MySqlPreparedQuery<MySqlPreparedQueryConfig & { execute: T }> {\n\toverride iterator(_placeholderValues?: Record<string, unknown> | undefined): AsyncGenerator<unknown, any, unknown> {\n\t\tthrow new Error('Method not implemented.');\n\t}\n\tstatic override readonly [entityKind]: string = 'PrismaMySqlPreparedQuery';\n\n\tconstructor(\n\t\tprivate readonly prisma: PrismaClient,\n\t\tprivate readonly query: Query,\n\t\tprivate readonly logger: Logger,\n\t) {\n\t\tsuper(undefined, undefined, undefined);\n\t}\n\n\toverride execute(placeholderValues?: Record<string, unknown>): Promise<T> {\n\t\tconst params = fillPlaceholders(this.query.params, placeholderValues ?? {});\n\t\tthis.logger.logQuery(this.query.sql, params);\n\t\treturn this.prisma.$queryRawUnsafe(this.query.sql, ...params);\n\t}\n}\n\nexport interface PrismaMySqlSessionOptions {\n\tlogger?: Logger;\n}\n\nexport class PrismaMySqlSession extends MySqlSession {\n\tstatic override readonly [entityKind]: string = 'PrismaMySqlSession';\n\n\tprivate readonly logger: Logger;\n\n\tconstructor(\n\t\tdialect: MySqlDialect,\n\t\tprivate readonly prisma: PrismaClient,\n\t\tprivate readonly options: PrismaMySqlSessionOptions,\n\t) {\n\t\tsuper(dialect);\n\t\tthis.logger = options.logger ?? new NoopLogger();\n\t}\n\n\toverride execute<T>(query: SQL): Promise<T> {\n\t\treturn this.prepareQuery<MySqlPreparedQueryConfig & { execute: T }>(this.dialect.sqlToQuery(query)).execute();\n\t}\n\n\toverride all<T = unknown>(_query: SQL): Promise<T[]> {\n\t\tthrow new Error('Method not implemented.');\n\t}\n\n\toverride prepareQuery<T extends MySqlPreparedQueryConfig = MySqlPreparedQueryConfig>(\n\t\tquery: Query,\n\t): MySqlPreparedQuery<T> {\n\t\treturn new PrismaMySqlPreparedQuery(this.prisma, query, this.logger);\n\t}\n\n\toverride prepareRelationalQuery<T extends MySqlPreparedQueryConfig = MySqlPreparedQueryConfig>(\n\t\t// query: Query,\n\t): MySqlPreparedQuery<T> {\n\t\tthrow new Error('Method not implemented');\n\t\t// return new PrismaMySqlPreparedQuery(this.prisma, query, this.logger);\n\t}\n\n\toverride transaction<T>(\n\t\t_transaction: (\n\t\t\ttx: MySqlTransaction<\n\t\t\t\tPrismaMySqlQueryResultHKT,\n\t\t\t\tPrismaMySqlPreparedQueryHKT,\n\t\t\t\tRecord<string, never>,\n\t\t\t\tEmptyRelations,\n\t\t\t\tRecord<string, never>\n\t\t\t>,\n\t\t) => Promise<T>,\n\t\t_config?: MySqlTransactionConfig,\n\t): Promise<T> {\n\t\tthrow new Error('Method not implemented.');\n\t}\n}\n\nexport interface PrismaMySqlQueryResultHKT extends MySqlQueryResultHKT {\n\ttype: [];\n}\n\nexport interface PrismaMySqlPreparedQueryHKT extends MySqlPreparedQueryHKT {\n\ttype: PrismaMySqlPreparedQuery<Assume<this['config'], MySqlPreparedQueryConfig>>;\n}\n"],"mappings":";;;;;;;AAkBA,IAAa,2BAAb,cAAiDA,yCAA8D;CAC9G,AAAS,SAAS,oBAAiG;AAClH,QAAM,IAAI,MAAM,0BAA0B;;CAE3C,QAA0BC,0BAAsB;CAEhD,YACC,AAAiBC,QACjB,AAAiBC,OACjB,AAAiBC,QAChB;AACD,QAAM,QAAW,QAAW,OAAU;EAJrB;EACA;EACA;;CAKlB,AAAS,QAAQ,mBAAyD;EACzE,MAAM,4CAA0B,KAAK,MAAM,QAAQ,qBAAqB,EAAE,CAAC;AAC3E,OAAK,OAAO,SAAS,KAAK,MAAM,KAAK,OAAO;AAC5C,SAAO,KAAK,OAAO,gBAAgB,KAAK,MAAM,KAAK,GAAG,OAAO;;;AAQ/D,IAAa,qBAAb,cAAwCC,mCAAa;CACpD,QAA0BJ,0BAAsB;CAEhD,AAAiB;CAEjB,YACC,SACA,AAAiBC,QACjB,AAAiBI,SAChB;AACD,QAAM,QAAQ;EAHG;EACA;AAGjB,OAAK,SAAS,QAAQ,UAAU,IAAIC,wBAAY;;CAGjD,AAAS,QAAW,OAAwB;AAC3C,SAAO,KAAK,aAAwD,KAAK,QAAQ,WAAW,MAAM,CAAC,CAAC,SAAS;;CAG9G,AAAS,IAAiB,QAA2B;AACpD,QAAM,IAAI,MAAM,0BAA0B;;CAG3C,AAAS,aACR,OACwB;AACxB,SAAO,IAAI,yBAAyB,KAAK,QAAQ,OAAO,KAAK,OAAO;;CAGrE,AAAS,yBAEgB;AACxB,QAAM,IAAI,MAAM,yBAAyB;;CAI1C,AAAS,YACR,cASA,SACa;AACb,QAAM,IAAI,MAAM,0BAA0B"}