{"version":3,"file":"point.cjs","names":["PgColumnBuilder","entityKind","PgColumn"],"sources":["../../../src/pg-core/columns/point.ts"],"sourcesContent":["import { entityKind } from '~/entity.ts';\nimport type { PgTable } from '~/pg-core/table.ts';\nimport { type Equal, getColumnNameAndConfig } from '~/utils.ts';\nimport { PgColumn, PgColumnBuilder } from './common.ts';\n\nexport class PgPointTupleBuilder extends PgColumnBuilder<{\n\tdataType: 'array point';\n\tdata: [number, number];\n\tdriverParam: number | string;\n}> {\n\tstatic override readonly [entityKind]: string = 'PgPointTupleBuilder';\n\n\tconstructor(name: string) {\n\t\tsuper(name, 'array point', 'PgPointTuple');\n\t}\n\n\t/** @internal */\n\toverride build(table: PgTable<any>) {\n\t\treturn new PgPointTuple(\n\t\t\ttable,\n\t\t\tthis.config as any,\n\t\t);\n\t}\n}\n\nexport class PgPointTuple extends PgColumn<'array point'> {\n\tstatic override readonly [entityKind]: string = 'PgPointTuple';\n\n\treadonly mode = 'tuple';\n\n\tgetSQLType(): string {\n\t\treturn 'point';\n\t}\n\n\toverride mapFromDriverValue(value: string | { x: number; y: number }): [number, number] {\n\t\tif (typeof value === 'string') {\n\t\t\tconst [x, y] = value.slice(1, -1).split(',');\n\t\t\treturn [Number.parseFloat(x!), Number.parseFloat(y!)];\n\t\t}\n\t\treturn [value.x, value.y];\n\t}\n\n\toverride mapToDriverValue(value: [number, number]): string {\n\t\treturn `(${value[0]},${value[1]})`;\n\t}\n}\n\nexport class PgPointObjectBuilder extends PgColumnBuilder<{\n\tdataType: 'object point';\n\tdata: { x: number; y: number };\n\tdriverParam: string;\n}> {\n\tstatic override readonly [entityKind]: string = 'PgPointObjectBuilder';\n\n\tconstructor(name: string) {\n\t\tsuper(name, 'object point', 'PgPointObject');\n\t}\n\n\t/** @internal */\n\toverride build(table: PgTable<any>) {\n\t\treturn new PgPointObject(\n\t\t\ttable,\n\t\t\tthis.config as any,\n\t\t);\n\t}\n}\n\nexport class PgPointObject extends PgColumn<'object point'> {\n\tstatic override readonly [entityKind]: string = 'PgPointObject';\n\n\treadonly mode = 'xy';\n\n\tgetSQLType(): string {\n\t\treturn 'point';\n\t}\n\n\toverride mapFromDriverValue(value: string | { x: number; y: number }): { x: number; y: number } {\n\t\tif (typeof value === 'string') {\n\t\t\tconst [x, y] = value.slice(1, -1).split(',');\n\t\t\treturn { x: Number.parseFloat(x!), y: Number.parseFloat(y!) };\n\t\t}\n\t\treturn value;\n\t}\n\n\toverride mapToDriverValue(value: { x: number; y: number }): string {\n\t\treturn `(${value.x},${value.y})`;\n\t}\n}\n\nexport interface PgPointConfig<T extends 'tuple' | 'xy' = 'tuple' | 'xy'> {\n\tmode?: T;\n}\n\nexport function point<TMode extends PgPointConfig['mode'] & {}>(\n\tconfig?: PgPointConfig<TMode>,\n): Equal<TMode, 'xy'> extends true ? PgPointObjectBuilder\n\t: PgPointTupleBuilder;\nexport function point<TMode extends PgPointConfig['mode'] & {}>(\n\tname: string,\n\tconfig?: PgPointConfig<TMode>,\n): Equal<TMode, 'xy'> extends true ? PgPointObjectBuilder\n\t: PgPointTupleBuilder;\nexport function point(a?: string | PgPointConfig, b?: PgPointConfig) {\n\tconst { name, config } = getColumnNameAndConfig<PgPointConfig>(a, b);\n\tif (!config?.mode || config.mode === 'tuple') {\n\t\treturn new PgPointTupleBuilder(name);\n\t}\n\treturn new PgPointObjectBuilder(name);\n}\n"],"mappings":";;;;;;AAKA,IAAa,sBAAb,cAAyCA,+CAItC;CACF,QAA0BC,0BAAsB;CAEhD,YAAY,MAAc;AACzB,QAAM,MAAM,eAAe,eAAe;;;CAI3C,AAAS,MAAM,OAAqB;AACnC,SAAO,IAAI,aACV,OACA,KAAK,OACL;;;AAIH,IAAa,eAAb,cAAkCC,wCAAwB;CACzD,QAA0BD,0BAAsB;CAEhD,AAAS,OAAO;CAEhB,aAAqB;AACpB,SAAO;;CAGR,AAAS,mBAAmB,OAA4D;AACvF,MAAI,OAAO,UAAU,UAAU;GAC9B,MAAM,CAAC,GAAG,KAAK,MAAM,MAAM,GAAG,GAAG,CAAC,MAAM,IAAI;AAC5C,UAAO,CAAC,OAAO,WAAW,EAAG,EAAE,OAAO,WAAW,EAAG,CAAC;;AAEtD,SAAO,CAAC,MAAM,GAAG,MAAM,EAAE;;CAG1B,AAAS,iBAAiB,OAAiC;AAC1D,SAAO,IAAI,MAAM,GAAG,GAAG,MAAM,GAAG;;;AAIlC,IAAa,uBAAb,cAA0CD,+CAIvC;CACF,QAA0BC,0BAAsB;CAEhD,YAAY,MAAc;AACzB,QAAM,MAAM,gBAAgB,gBAAgB;;;CAI7C,AAAS,MAAM,OAAqB;AACnC,SAAO,IAAI,cACV,OACA,KAAK,OACL;;;AAIH,IAAa,gBAAb,cAAmCC,wCAAyB;CAC3D,QAA0BD,0BAAsB;CAEhD,AAAS,OAAO;CAEhB,aAAqB;AACpB,SAAO;;CAGR,AAAS,mBAAmB,OAAoE;AAC/F,MAAI,OAAO,UAAU,UAAU;GAC9B,MAAM,CAAC,GAAG,KAAK,MAAM,MAAM,GAAG,GAAG,CAAC,MAAM,IAAI;AAC5C,UAAO;IAAE,GAAG,OAAO,WAAW,EAAG;IAAE,GAAG,OAAO,WAAW,EAAG;IAAE;;AAE9D,SAAO;;CAGR,AAAS,iBAAiB,OAAyC;AAClE,SAAO,IAAI,MAAM,EAAE,GAAG,MAAM,EAAE;;;AAiBhC,SAAgB,MAAM,GAA4B,GAAmB;CACpE,MAAM,EAAE,MAAM,kDAAiD,GAAG,EAAE;AACpE,KAAI,CAAC,QAAQ,QAAQ,OAAO,SAAS,QACpC,QAAO,IAAI,oBAAoB,KAAK;AAErC,QAAO,IAAI,qBAAqB,KAAK"}