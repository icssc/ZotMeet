{"version":3,"file":"count.cjs","names":["PgCountBuilder","entityKind","QueryPromise"],"sources":["../../../src/pg-core/async/count.ts"],"sourcesContent":["import { entityKind } from '~/entity.ts';\nimport { QueryPromise } from '~/query-promise.ts';\nimport type { SQL, SQLWrapper } from '~/sql/sql.ts';\nimport { applyMixins, type NeonAuthToken } from '~/utils.ts';\nimport type { PgDialect } from '../dialect.ts';\nimport { PgCountBuilder } from '../query-builders/count.ts';\nimport type { PgTable } from '../table.ts';\nimport type { PgViewBase } from '../view-base.ts';\nimport type { PgAsyncSession } from './session.ts';\n\nexport interface PgAsyncCountBuilder extends PgCountBuilder, QueryPromise<number> {}\n\nexport class PgAsyncCountBuilder extends PgCountBuilder {\n\tstatic override readonly [entityKind]: string = 'PgAsyncCountBuilder';\n\n\tprotected session: PgAsyncSession;\n\n\tconstructor(\n\t\t{ source, dialect, filters, session }: {\n\t\t\tsource: PgTable | PgViewBase | SQL | SQLWrapper;\n\t\t\tfilters?: SQL<unknown>;\n\t\t\tdialect: PgDialect;\n\t\t\tsession: PgAsyncSession;\n\t\t},\n\t) {\n\t\tsuper({ source, dialect, filters });\n\t\tthis.session = session;\n\t}\n\n\t/** @internal */\n\tprivate authToken?: NeonAuthToken;\n\t/** @internal */\n\tsetToken(token?: NeonAuthToken) {\n\t\tthis.authToken = token;\n\t\treturn this;\n\t}\n\n\texecute(placeholderValues?: Record<string, unknown>): Promise<number> {\n\t\treturn this.session.prepareQuery<{\n\t\t\texecute: number;\n\t\t\tall: unknown;\n\t\t\tvalues: unknown;\n\t\t}>(\n\t\t\tthis.build(),\n\t\t\tundefined,\n\t\t\tundefined,\n\t\t\ttrue,\n\t\t\t(rows) => {\n\t\t\t\tconst v = rows[0]?.[0];\n\t\t\t\tif (typeof v === 'number') return v;\n\t\t\t\treturn v ? Number(v) : 0;\n\t\t\t},\n\t\t).setToken(this.authToken).execute(placeholderValues);\n\t}\n}\n\napplyMixins(PgAsyncCountBuilder, [QueryPromise]);\n"],"mappings":";;;;;;;AAYA,IAAa,sBAAb,cAAyCA,oDAAe;CACvD,QAA0BC,0BAAsB;CAEhD,AAAU;CAEV,YACC,EAAE,QAAQ,SAAS,SAAS,WAM3B;AACD,QAAM;GAAE;GAAQ;GAAS;GAAS,CAAC;AACnC,OAAK,UAAU;;;CAIhB,AAAQ;;CAER,SAAS,OAAuB;AAC/B,OAAK,YAAY;AACjB,SAAO;;CAGR,QAAQ,mBAA8D;AACrE,SAAO,KAAK,QAAQ,aAKnB,KAAK,OAAO,EACZ,QACA,QACA,OACC,SAAS;GACT,MAAM,IAAI,KAAK,KAAK;AACpB,OAAI,OAAO,MAAM,SAAU,QAAO;AAClC,UAAO,IAAI,OAAO,EAAE,GAAG;IAExB,CAAC,SAAS,KAAK,UAAU,CAAC,QAAQ,kBAAkB;;;4BAI3C,qBAAqB,CAACC,gCAAa,CAAC"}