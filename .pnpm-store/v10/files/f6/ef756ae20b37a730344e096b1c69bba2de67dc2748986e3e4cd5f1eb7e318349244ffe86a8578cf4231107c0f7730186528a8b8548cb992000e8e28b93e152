{"version":3,"file":"session.js","names":["prisma: PrismaClient","logger: Logger","options: PrismaPgSessionOptions"],"sources":["../../../src/prisma/pg/session.ts"],"sourcesContent":["import type { PrismaClient } from '@prisma/client/extension';\n\nimport { entityKind } from '~/entity.ts';\nimport { type Logger, NoopLogger } from '~/logger.ts';\nimport type { PgAsyncTransaction } from '~/pg-core/async/session.ts';\nimport { PgAsyncPreparedQuery, PgAsyncSession } from '~/pg-core/async/session.ts';\nimport type { PgDialect } from '~/pg-core/index.ts';\nimport type { PgQueryResultHKT, PgTransactionConfig, PreparedQueryConfig } from '~/pg-core/session.ts';\nimport type { EmptyRelations } from '~/relations.ts';\nimport type { Query, SQL } from '~/sql/sql.ts';\nimport { fillPlaceholders } from '~/sql/sql.ts';\n\nexport class PrismaPgPreparedQuery<T> extends PgAsyncPreparedQuery<PreparedQueryConfig & { execute: T }> {\n\tstatic override readonly [entityKind]: string = 'PrismaPgPreparedQuery';\n\n\tconstructor(\n\t\tprivate readonly prisma: PrismaClient,\n\t\tquery: Query,\n\t\tprivate readonly logger: Logger,\n\t) {\n\t\tsuper(query, undefined, undefined, undefined);\n\t}\n\n\toverride execute(placeholderValues?: Record<string, unknown>): Promise<T> {\n\t\tconst params = fillPlaceholders(this.query.params, placeholderValues ?? {});\n\t\tthis.logger.logQuery(this.query.sql, params);\n\t\treturn this.prisma.$queryRawUnsafe(this.query.sql, ...params);\n\t}\n\n\toverride all(): Promise<unknown> {\n\t\tthrow new Error('Method not implemented.');\n\t}\n\n\toverride isResponseInArrayMode(): boolean {\n\t\treturn false;\n\t}\n}\n\nexport interface PrismaPgSessionOptions {\n\tlogger?: Logger;\n}\n\nexport class PrismaPgSession extends PgAsyncSession {\n\tstatic override readonly [entityKind]: string = 'PrismaPgSession';\n\n\tprivate readonly logger: Logger;\n\n\tconstructor(\n\t\tdialect: PgDialect,\n\t\tprivate readonly prisma: PrismaClient,\n\t\tprivate readonly options: PrismaPgSessionOptions,\n\t) {\n\t\tsuper(dialect);\n\t\tthis.logger = options.logger ?? new NoopLogger();\n\t}\n\n\toverride execute<T>(query: SQL): Promise<T> {\n\t\treturn this.prepareQuery<PreparedQueryConfig & { execute: T }>(this.dialect.sqlToQuery(query)).execute();\n\t}\n\n\toverride prepareQuery<T extends PreparedQueryConfig = PreparedQueryConfig>(query: Query): PgAsyncPreparedQuery<T> {\n\t\treturn new PrismaPgPreparedQuery(this.prisma, query, this.logger);\n\t}\n\n\toverride prepareRelationalQuery<T extends PreparedQueryConfig = PreparedQueryConfig>(\n\t\t// query: Query,\n\t): PgAsyncPreparedQuery<T> {\n\t\tthrow new Error('Method not implemented.');\n\t\t// return new PrismaPgPreparedQuery(this.prisma, query, this.logger);\n\t}\n\n\toverride transaction<T>(\n\t\t_transaction: (\n\t\t\ttx: PgAsyncTransaction<\n\t\t\t\tPgQueryResultHKT,\n\t\t\t\tRecord<string, never>,\n\t\t\t\tEmptyRelations,\n\t\t\t\tRecord<string, never>\n\t\t\t>,\n\t\t) => Promise<T>,\n\t\t_config?: PgTransactionConfig,\n\t): Promise<T> {\n\t\tthrow new Error('Method not implemented.');\n\t}\n}\n\nexport interface PrismaPgQueryResultHKT extends PgQueryResultHKT {\n\ttype: [];\n}\n"],"mappings":";;;;;;AAYA,IAAa,wBAAb,cAA8C,qBAA2D;CACxG,QAA0B,cAAsB;CAEhD,YACC,AAAiBA,QACjB,OACA,AAAiBC,QAChB;AACD,QAAM,OAAO,QAAW,QAAW,OAAU;EAJ5B;EAEA;;CAKlB,AAAS,QAAQ,mBAAyD;EACzE,MAAM,SAAS,iBAAiB,KAAK,MAAM,QAAQ,qBAAqB,EAAE,CAAC;AAC3E,OAAK,OAAO,SAAS,KAAK,MAAM,KAAK,OAAO;AAC5C,SAAO,KAAK,OAAO,gBAAgB,KAAK,MAAM,KAAK,GAAG,OAAO;;CAG9D,AAAS,MAAwB;AAChC,QAAM,IAAI,MAAM,0BAA0B;;CAG3C,AAAS,wBAAiC;AACzC,SAAO;;;AAQT,IAAa,kBAAb,cAAqC,eAAe;CACnD,QAA0B,cAAsB;CAEhD,AAAiB;CAEjB,YACC,SACA,AAAiBD,QACjB,AAAiBE,SAChB;AACD,QAAM,QAAQ;EAHG;EACA;AAGjB,OAAK,SAAS,QAAQ,UAAU,IAAI,YAAY;;CAGjD,AAAS,QAAW,OAAwB;AAC3C,SAAO,KAAK,aAAmD,KAAK,QAAQ,WAAW,MAAM,CAAC,CAAC,SAAS;;CAGzG,AAAS,aAAkE,OAAuC;AACjH,SAAO,IAAI,sBAAsB,KAAK,QAAQ,OAAO,KAAK,OAAO;;CAGlE,AAAS,yBAEkB;AAC1B,QAAM,IAAI,MAAM,0BAA0B;;CAI3C,AAAS,YACR,cAQA,SACa;AACb,QAAM,IAAI,MAAM,0BAA0B"}