{"version":3,"sources":["../../src/lib/static-env.ts"],"sourcesContent":["import type {\n  NextConfigComplete,\n  NextConfigRuntime,\n} from '../server/config-shared'\n\nfunction errorIfEnvConflicted(\n  config: NextConfigComplete | NextConfigRuntime,\n  key: string\n) {\n  const isPrivateKey = /^(?:NODE_.+)|^(?:__.+)$/i.test(key)\n  const hasNextRuntimeKey = key === 'NEXT_RUNTIME'\n\n  if (isPrivateKey || hasNextRuntimeKey) {\n    throw new Error(\n      `The key \"${key}\" under \"env\" in ${config.configFileName || 'config'} is not allowed. https://nextjs.org/docs/messages/env-key-not-allowed`\n    )\n  }\n}\n\n/**\n * Collects all environment variables that are using the `NEXT_PUBLIC_` prefix.\n */\nexport function getNextPublicEnvironmentVariables() {\n  const defineEnv: [string, string | undefined][] = []\n  for (const key in process.env) {\n    if (key.startsWith('NEXT_PUBLIC_')) {\n      const value = process.env[key]\n      if (value != null) {\n        defineEnv.push([`process.env.${key}`, value])\n      }\n    }\n  }\n  defineEnv.sort((a, b) => a[0].localeCompare(b[0]))\n  return Object.fromEntries(defineEnv)\n}\n\n/**\n * Collects the `env` config value from the Next.js config.\n */\nexport function getNextConfigEnv(\n  config: NextConfigComplete | NextConfigRuntime\n) {\n  // Refactored code below to use for-of\n  const defineEnv: Record<string, string | undefined> = {}\n  const env = config.env\n  for (const key in env) {\n    const value = env[key]\n    if (value != null) {\n      errorIfEnvConflicted(config, key)\n      defineEnv[`process.env.${key}`] = value\n    }\n  }\n  return defineEnv\n}\n\nexport function getStaticEnv(\n  config: NextConfigComplete | NextConfigRuntime,\n  deploymentId: string\n) {\n  const staticEnv: Record<string, string | undefined> = {\n    ...getNextPublicEnvironmentVariables(),\n    ...getNextConfigEnv(config),\n    'process.env.NEXT_DEPLOYMENT_ID': deploymentId,\n  }\n  return staticEnv\n}\n\nexport function populateStaticEnv(\n  config: NextConfigComplete | NextConfigRuntime,\n  deploymentId: string\n) {\n  // since inlining comes after static generation we need\n  // to ensure this value is assigned to process env so it\n  // can still be accessed\n  const staticEnv = getStaticEnv(config, deploymentId)\n  for (const key in staticEnv) {\n    const innerKey = key.split('.').pop() || ''\n    if (!process.env[innerKey]) {\n      process.env[innerKey] = staticEnv[key] || ''\n    }\n  }\n}\n"],"names":["getNextConfigEnv","getNextPublicEnvironmentVariables","getStaticEnv","populateStaticEnv","errorIfEnvConflicted","config","key","isPrivateKey","test","hasNextRuntimeKey","Error","configFileName","defineEnv","process","env","startsWith","value","push","sort","a","b","localeCompare","Object","fromEntries","deploymentId","staticEnv","innerKey","split","pop"],"mappings":";;;;;;;;;;;;;;;;;IAuCgBA,gBAAgB;eAAhBA;;IAjBAC,iCAAiC;eAAjCA;;IAiCAC,YAAY;eAAZA;;IAYAC,iBAAiB;eAAjBA;;;AA9DhB,SAASC,qBACPC,MAA8C,EAC9CC,GAAW;IAEX,MAAMC,eAAe,2BAA2BC,IAAI,CAACF;IACrD,MAAMG,oBAAoBH,QAAQ;IAElC,IAAIC,gBAAgBE,mBAAmB;QACrC,MAAM,qBAEL,CAFK,IAAIC,MACR,CAAC,SAAS,EAAEJ,IAAI,iBAAiB,EAAED,OAAOM,cAAc,IAAI,SAAS,qEAAqE,CAAC,GADvI,qBAAA;mBAAA;wBAAA;0BAAA;QAEN;IACF;AACF;AAKO,SAASV;IACd,MAAMW,YAA4C,EAAE;IACpD,IAAK,MAAMN,OAAOO,QAAQC,GAAG,CAAE;QAC7B,IAAIR,IAAIS,UAAU,CAAC,iBAAiB;YAClC,MAAMC,QAAQH,QAAQC,GAAG,CAACR,IAAI;YAC9B,IAAIU,SAAS,MAAM;gBACjBJ,UAAUK,IAAI,CAAC;oBAAC,CAAC,YAAY,EAAEX,KAAK;oBAAEU;iBAAM;YAC9C;QACF;IACF;IACAJ,UAAUM,IAAI,CAAC,CAACC,GAAGC,IAAMD,CAAC,CAAC,EAAE,CAACE,aAAa,CAACD,CAAC,CAAC,EAAE;IAChD,OAAOE,OAAOC,WAAW,CAACX;AAC5B;AAKO,SAASZ,iBACdK,MAA8C;IAE9C,sCAAsC;IACtC,MAAMO,YAAgD,CAAC;IACvD,MAAME,MAAMT,OAAOS,GAAG;IACtB,IAAK,MAAMR,OAAOQ,IAAK;QACrB,MAAME,QAAQF,GAAG,CAACR,IAAI;QACtB,IAAIU,SAAS,MAAM;YACjBZ,qBAAqBC,QAAQC;YAC7BM,SAAS,CAAC,CAAC,YAAY,EAAEN,KAAK,CAAC,GAAGU;QACpC;IACF;IACA,OAAOJ;AACT;AAEO,SAASV,aACdG,MAA8C,EAC9CmB,YAAoB;IAEpB,MAAMC,YAAgD;QACpD,GAAGxB,mCAAmC;QACtC,GAAGD,iBAAiBK,OAAO;QAC3B,kCAAkCmB;IACpC;IACA,OAAOC;AACT;AAEO,SAAStB,kBACdE,MAA8C,EAC9CmB,YAAoB;IAEpB,uDAAuD;IACvD,wDAAwD;IACxD,wBAAwB;IACxB,MAAMC,YAAYvB,aAAaG,QAAQmB;IACvC,IAAK,MAAMlB,OAAOmB,UAAW;QAC3B,MAAMC,WAAWpB,IAAIqB,KAAK,CAAC,KAAKC,GAAG,MAAM;QACzC,IAAI,CAACf,QAAQC,GAAG,CAACY,SAAS,EAAE;YAC1Bb,QAAQC,GAAG,CAACY,SAAS,GAAGD,SAAS,CAACnB,IAAI,IAAI;QAC5C;IACF;AACF","ignoreList":[0]}