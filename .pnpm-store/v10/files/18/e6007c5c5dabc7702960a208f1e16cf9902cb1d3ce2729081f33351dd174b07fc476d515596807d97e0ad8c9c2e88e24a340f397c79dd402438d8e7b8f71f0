{"version":3,"sources":["../../../src/server/dev/messages.ts"],"sourcesContent":["import { InvariantError } from '../../shared/lib/invariant-error'\nimport {\n  HMR_MESSAGE_SENT_TO_BROWSER,\n  type BinaryHmrMessageSentToBrowser,\n} from './hot-reloader-types'\n\nexport const FAST_REFRESH_RUNTIME_RELOAD =\n  'Fast Refresh had to perform a full reload due to a runtime error.'\n\nconst textEncoder = new TextEncoder()\n\nexport function createBinaryHmrMessageData(\n  message: BinaryHmrMessageSentToBrowser\n): Uint8Array {\n  switch (message.type) {\n    case HMR_MESSAGE_SENT_TO_BROWSER.ERRORS_TO_SHOW_IN_BROWSER: {\n      const { serializedErrors } = message\n      const totalLength = 1 + serializedErrors.length\n      const data = new Uint8Array(totalLength)\n      const view = new DataView(data.buffer)\n\n      view.setUint8(0, HMR_MESSAGE_SENT_TO_BROWSER.ERRORS_TO_SHOW_IN_BROWSER)\n      data.set(serializedErrors, 1)\n\n      return data\n    }\n    case HMR_MESSAGE_SENT_TO_BROWSER.REACT_DEBUG_CHUNK: {\n      const { requestId, chunk } = message\n      const requestIdBytes = textEncoder.encode(requestId)\n      const requestIdLength = requestIdBytes.length\n\n      if (requestIdLength > 255) {\n        throw new InvariantError(\n          'Request ID is too long for the binary HMR message.'\n        )\n      }\n\n      const chunkLength = chunk ? chunk.length : 0\n      const totalLength = 2 + requestIdLength + chunkLength\n      const data = new Uint8Array(totalLength)\n      const view = new DataView(data.buffer)\n\n      view.setUint8(0, HMR_MESSAGE_SENT_TO_BROWSER.REACT_DEBUG_CHUNK)\n      view.setUint8(1, requestIdLength)\n      textEncoder.encodeInto(requestId, data.subarray(2, 2 + requestIdLength))\n\n      if (chunk) {\n        data.set(chunk, 2 + requestIdLength)\n      }\n\n      return data\n    }\n    default: {\n      throw new InvariantError(\n        `Invalid binary HMR message of type ${(message as any).type}`\n      )\n    }\n  }\n}\n"],"names":["FAST_REFRESH_RUNTIME_RELOAD","createBinaryHmrMessageData","textEncoder","TextEncoder","message","type","HMR_MESSAGE_SENT_TO_BROWSER","ERRORS_TO_SHOW_IN_BROWSER","serializedErrors","totalLength","length","data","Uint8Array","view","DataView","buffer","setUint8","set","REACT_DEBUG_CHUNK","requestId","chunk","requestIdBytes","encode","requestIdLength","InvariantError","chunkLength","encodeInto","subarray"],"mappings":";;;;;;;;;;;;;;;IAMaA,2BAA2B;eAA3BA;;IAKGC,0BAA0B;eAA1BA;;;gCAXe;kCAIxB;AAEA,MAAMD,8BACX;AAEF,MAAME,cAAc,IAAIC;AAEjB,SAASF,2BACdG,OAAsC;IAEtC,OAAQA,QAAQC,IAAI;QAClB,KAAKC,6CAA2B,CAACC,yBAAyB;YAAE;gBAC1D,MAAM,EAAEC,gBAAgB,EAAE,GAAGJ;gBAC7B,MAAMK,cAAc,IAAID,iBAAiBE,MAAM;gBAC/C,MAAMC,OAAO,IAAIC,WAAWH;gBAC5B,MAAMI,OAAO,IAAIC,SAASH,KAAKI,MAAM;gBAErCF,KAAKG,QAAQ,CAAC,GAAGV,6CAA2B,CAACC,yBAAyB;gBACtEI,KAAKM,GAAG,CAACT,kBAAkB;gBAE3B,OAAOG;YACT;QACA,KAAKL,6CAA2B,CAACY,iBAAiB;YAAE;gBAClD,MAAM,EAAEC,SAAS,EAAEC,KAAK,EAAE,GAAGhB;gBAC7B,MAAMiB,iBAAiBnB,YAAYoB,MAAM,CAACH;gBAC1C,MAAMI,kBAAkBF,eAAeX,MAAM;gBAE7C,IAAIa,kBAAkB,KAAK;oBACzB,MAAM,qBAEL,CAFK,IAAIC,8BAAc,CACtB,uDADI,qBAAA;+BAAA;oCAAA;sCAAA;oBAEN;gBACF;gBAEA,MAAMC,cAAcL,QAAQA,MAAMV,MAAM,GAAG;gBAC3C,MAAMD,cAAc,IAAIc,kBAAkBE;gBAC1C,MAAMd,OAAO,IAAIC,WAAWH;gBAC5B,MAAMI,OAAO,IAAIC,SAASH,KAAKI,MAAM;gBAErCF,KAAKG,QAAQ,CAAC,GAAGV,6CAA2B,CAACY,iBAAiB;gBAC9DL,KAAKG,QAAQ,CAAC,GAAGO;gBACjBrB,YAAYwB,UAAU,CAACP,WAAWR,KAAKgB,QAAQ,CAAC,GAAG,IAAIJ;gBAEvD,IAAIH,OAAO;oBACTT,KAAKM,GAAG,CAACG,OAAO,IAAIG;gBACtB;gBAEA,OAAOZ;YACT;QACA;YAAS;gBACP,MAAM,qBAEL,CAFK,IAAIa,8BAAc,CACtB,CAAC,mCAAmC,EAAE,AAACpB,QAAgBC,IAAI,EAAE,GADzD,qBAAA;2BAAA;gCAAA;kCAAA;gBAEN;YACF;IACF;AACF","ignoreList":[0]}