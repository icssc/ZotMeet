{"version":3,"sources":["../../../src/lib/find-root.ts"],"sourcesContent":["import { dirname } from 'path'\nimport findUp from 'next/dist/compiled/find-up'\nimport * as Log from '../build/output/log'\n\nexport function findRootLockFile(cwd: string) {\n  return findUp.sync(\n    [\n      'pnpm-lock.yaml',\n      'package-lock.json',\n      'yarn.lock',\n      'bun.lock',\n      'bun.lockb',\n    ],\n    {\n      cwd,\n    }\n  )\n}\n\nexport function findRootDirAndLockFiles(cwd: string): {\n  lockFiles: string[]\n  rootDir: string\n} {\n  const lockFile = findRootLockFile(cwd)\n  if (!lockFile)\n    return {\n      lockFiles: [],\n      rootDir: cwd,\n    }\n\n  const lockFiles = [lockFile]\n  while (true) {\n    const lastLockFile = lockFiles[lockFiles.length - 1]\n    const currentDir = dirname(lastLockFile)\n    const parentDir = dirname(currentDir)\n\n    // dirname('/')==='/' so if we happen to reach the FS root (as might happen in a container we need to quit to avoid looping forever\n    if (parentDir === currentDir) break\n\n    const newLockFile = findRootLockFile(parentDir)\n\n    if (!newLockFile) break\n\n    lockFiles.push(newLockFile)\n  }\n\n  return {\n    lockFiles,\n    rootDir: dirname(lockFiles[lockFiles.length - 1]),\n  }\n}\n\nexport function warnDuplicatedLockFiles(lockFiles: string[]) {\n  if (lockFiles.length > 1) {\n    const additionalLockFiles = lockFiles\n      .slice(0, -1)\n      .map((str) => `\\n   * ${str}`)\n      .join('')\n\n    if (process.env.TURBOPACK) {\n      Log.warnOnce(\n        `Warning: Next.js inferred your workspace root, but it may not be correct.\\n` +\n          ` We detected multiple lockfiles and selected the directory of ${lockFiles[lockFiles.length - 1]} as the root directory.\\n` +\n          ` To silence this warning, set \\`turbopack.root\\` in your Next.js config, or consider ` +\n          `removing one of the lockfiles if it's not needed.\\n` +\n          `   See https://nextjs.org/docs/app/api-reference/config/next-config-js/turbopack#root-directory for more information.\\n` +\n          ` Detected additional lockfiles: ${additionalLockFiles}\\n`\n      )\n    } else {\n      Log.warnOnce(\n        `Warning: Next.js inferred your workspace root, but it may not be correct.\\n` +\n          ` We detected multiple lockfiles and selected the directory of ${lockFiles[lockFiles.length - 1]} as the root directory.\\n` +\n          ` To silence this warning, set \\`outputFileTracingRoot\\` in your Next.js config, or consider ` +\n          `removing one of the lockfiles if it's not needed.\\n` +\n          `   See https://nextjs.org/docs/app/api-reference/config/next-config-js/output#caveats for more information.\\n` +\n          ` Detected additional lockfiles: ${additionalLockFiles}\\n`\n      )\n    }\n  }\n}\n"],"names":["dirname","findUp","Log","findRootLockFile","cwd","sync","findRootDirAndLockFiles","lockFile","lockFiles","rootDir","lastLockFile","length","currentDir","parentDir","newLockFile","push","warnDuplicatedLockFiles","additionalLockFiles","slice","map","str","join","process","env","TURBOPACK","warnOnce"],"mappings":"AAAA,SAASA,OAAO,QAAQ,OAAM;AAC9B,OAAOC,YAAY,6BAA4B;AAC/C,YAAYC,SAAS,sBAAqB;AAE1C,OAAO,SAASC,iBAAiBC,GAAW;IAC1C,OAAOH,OAAOI,IAAI,CAChB;QACE;QACA;QACA;QACA;QACA;KACD,EACD;QACED;IACF;AAEJ;AAEA,OAAO,SAASE,wBAAwBF,GAAW;IAIjD,MAAMG,WAAWJ,iBAAiBC;IAClC,IAAI,CAACG,UACH,OAAO;QACLC,WAAW,EAAE;QACbC,SAASL;IACX;IAEF,MAAMI,YAAY;QAACD;KAAS;IAC5B,MAAO,KAAM;QACX,MAAMG,eAAeF,SAAS,CAACA,UAAUG,MAAM,GAAG,EAAE;QACpD,MAAMC,aAAaZ,QAAQU;QAC3B,MAAMG,YAAYb,QAAQY;QAE1B,mIAAmI;QACnI,IAAIC,cAAcD,YAAY;QAE9B,MAAME,cAAcX,iBAAiBU;QAErC,IAAI,CAACC,aAAa;QAElBN,UAAUO,IAAI,CAACD;IACjB;IAEA,OAAO;QACLN;QACAC,SAAST,QAAQQ,SAAS,CAACA,UAAUG,MAAM,GAAG,EAAE;IAClD;AACF;AAEA,OAAO,SAASK,wBAAwBR,SAAmB;IACzD,IAAIA,UAAUG,MAAM,GAAG,GAAG;QACxB,MAAMM,sBAAsBT,UACzBU,KAAK,CAAC,GAAG,CAAC,GACVC,GAAG,CAAC,CAACC,MAAQ,CAAC,OAAO,EAAEA,KAAK,EAC5BC,IAAI,CAAC;QAER,IAAIC,QAAQC,GAAG,CAACC,SAAS,EAAE;YACzBtB,IAAIuB,QAAQ,CACV,CAAC,2EAA2E,CAAC,GAC3E,CAAC,8DAA8D,EAAEjB,SAAS,CAACA,UAAUG,MAAM,GAAG,EAAE,CAAC,yBAAyB,CAAC,GAC3H,CAAC,qFAAqF,CAAC,GACvF,CAAC,mDAAmD,CAAC,GACrD,CAAC,uHAAuH,CAAC,GACzH,CAAC,gCAAgC,EAAEM,oBAAoB,EAAE,CAAC;QAEhE,OAAO;YACLf,IAAIuB,QAAQ,CACV,CAAC,2EAA2E,CAAC,GAC3E,CAAC,8DAA8D,EAAEjB,SAAS,CAACA,UAAUG,MAAM,GAAG,EAAE,CAAC,yBAAyB,CAAC,GAC3H,CAAC,4FAA4F,CAAC,GAC9F,CAAC,mDAAmD,CAAC,GACrD,CAAC,6GAA6G,CAAC,GAC/G,CAAC,gCAAgC,EAAEM,oBAAoB,EAAE,CAAC;QAEhE;IACF;AACF","ignoreList":[0]}