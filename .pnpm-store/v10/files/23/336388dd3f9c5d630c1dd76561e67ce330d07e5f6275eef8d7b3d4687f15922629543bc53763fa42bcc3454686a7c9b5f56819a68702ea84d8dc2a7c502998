{"version":3,"sources":["../../src/lib/build-custom-route.ts"],"sourcesContent":["import { pathToRegexp } from 'next/dist/compiled/path-to-regexp'\nimport type {\n  ManifestHeaderRoute,\n  ManifestRedirectRoute,\n  ManifestRewriteRoute,\n} from '../build'\nimport {\n  normalizeRouteRegex,\n  type Header,\n  type Redirect,\n  type Rewrite,\n  type RouteType,\n} from './load-custom-routes'\nimport { getRedirectStatus, modifyRouteRegex } from './redirect-status'\n\nexport function buildCustomRoute(\n  type: 'header',\n  route: Header\n): ManifestHeaderRoute\nexport function buildCustomRoute(\n  type: 'rewrite',\n  route: Rewrite\n): ManifestRewriteRoute\nexport function buildCustomRoute(\n  type: 'redirect',\n  route: Redirect,\n  restrictedRedirectPaths: string[]\n): ManifestRedirectRoute\nexport function buildCustomRoute(\n  type: RouteType,\n  route: Redirect | Rewrite | Header,\n  restrictedRedirectPaths?: string[]\n): ManifestHeaderRoute | ManifestRewriteRoute | ManifestRedirectRoute {\n  const compiled = pathToRegexp(route.source, [], {\n    strict: true,\n    sensitive: false,\n    delimiter: '/', // default is `/#?`, but Next does not pass query info\n  })\n\n  // If this is an internal rewrite and it already provides a regex, use it\n  // otherwise, normalize the source to a regex.\n  let regex: string\n  if (\n    !route.internal ||\n    type !== 'rewrite' ||\n    !('regex' in route) ||\n    typeof route.regex !== 'string'\n  ) {\n    let source = compiled.source\n    if (!route.internal) {\n      source = modifyRouteRegex(\n        source,\n        type === 'redirect' ? restrictedRedirectPaths : undefined\n      )\n    }\n\n    regex = normalizeRouteRegex(source)\n  } else {\n    regex = route.regex\n  }\n\n  if (type !== 'redirect') {\n    return { ...route, regex }\n  }\n\n  return {\n    ...route,\n    statusCode: getRedirectStatus(route as Redirect),\n    permanent: undefined,\n    regex,\n  }\n}\n"],"names":["buildCustomRoute","type","route","restrictedRedirectPaths","compiled","pathToRegexp","source","strict","sensitive","delimiter","regex","internal","modifyRouteRegex","undefined","normalizeRouteRegex","statusCode","getRedirectStatus","permanent"],"mappings":";;;;+BA4BgBA;;;eAAAA;;;8BA5Ba;kCAYtB;gCAC6C;AAe7C,SAASA,iBACdC,IAAe,EACfC,KAAkC,EAClCC,uBAAkC;IAElC,MAAMC,WAAWC,IAAAA,0BAAY,EAACH,MAAMI,MAAM,EAAE,EAAE,EAAE;QAC9CC,QAAQ;QACRC,WAAW;QACXC,WAAW;IACb;IAEA,yEAAyE;IACzE,8CAA8C;IAC9C,IAAIC;IACJ,IACE,CAACR,MAAMS,QAAQ,IACfV,SAAS,aACT,CAAE,CAAA,WAAWC,KAAI,KACjB,OAAOA,MAAMQ,KAAK,KAAK,UACvB;QACA,IAAIJ,SAASF,SAASE,MAAM;QAC5B,IAAI,CAACJ,MAAMS,QAAQ,EAAE;YACnBL,SAASM,IAAAA,gCAAgB,EACvBN,QACAL,SAAS,aAAaE,0BAA0BU;QAEpD;QAEAH,QAAQI,IAAAA,qCAAmB,EAACR;IAC9B,OAAO;QACLI,QAAQR,MAAMQ,KAAK;IACrB;IAEA,IAAIT,SAAS,YAAY;QACvB,OAAO;YAAE,GAAGC,KAAK;YAAEQ;QAAM;IAC3B;IAEA,OAAO;QACL,GAAGR,KAAK;QACRa,YAAYC,IAAAA,iCAAiB,EAACd;QAC9Be,WAAWJ;QACXH;IACF;AACF","ignoreList":[0]}