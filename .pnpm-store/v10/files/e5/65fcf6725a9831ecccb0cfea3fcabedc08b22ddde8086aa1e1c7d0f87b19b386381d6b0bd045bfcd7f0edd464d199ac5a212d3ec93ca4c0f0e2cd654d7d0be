{"version":3,"file":"update.cjs","names":["PgUpdateBase","entityKind","extractUsedTable"],"sources":["../../../src/pg-core/effect/update.ts"],"sourcesContent":["import { applyEffectWrapper, type QueryEffect } from '~/effect-core/query-effect.ts';\nimport { entityKind } from '~/entity.ts';\nimport type { PgQueryResultHKT, PgQueryResultKind, PreparedQueryConfig } from '~/pg-core/session.ts';\nimport type { PgTable } from '~/pg-core/table.ts';\nimport type { JoinNullability } from '~/query-builders/select.types.ts';\nimport type { RunnableQuery } from '~/runnable-query.ts';\nimport type { ColumnsSelection, SQL } from '~/sql/sql.ts';\nimport type { Subquery } from '~/subquery.ts';\nimport type { Assume } from '~/utils.ts';\nimport { type Join, PgUpdateBase, type PgUpdateHKTBase } from '../query-builders/update.ts';\nimport { extractUsedTable } from '../utils.ts';\nimport type { PgViewBase } from '../view-base.ts';\nimport type { PgEffectPreparedQuery, PgEffectSession } from './session.ts';\n\nexport type PgEffectUpdatePrepare<T extends AnyPgEffectUpdate> = PgEffectPreparedQuery<\n\tPreparedQueryConfig & {\n\t\texecute: T['_']['returning'] extends undefined ? PgQueryResultKind<T['_']['queryResult'], never>\n\t\t\t: T['_']['returning'][];\n\t}\n>;\n\nexport type PgEffectUpdate<\n\tTTable extends PgTable = PgTable,\n\tTQueryResult extends PgQueryResultHKT = PgQueryResultHKT,\n\tTFrom extends PgTable | Subquery | PgViewBase | SQL | undefined = undefined,\n\tTSelectedFields extends ColumnsSelection | undefined = undefined,\n\tTReturning extends Record<string, unknown> | undefined = Record<string, unknown> | undefined,\n\tTNullabilityMap extends Record<string, JoinNullability> = Record<TTable['_']['name'], 'not-null'>,\n\tTJoins extends Join[] = [],\n> = PgEffectUpdateBase<\n\tTTable,\n\tTQueryResult,\n\tTFrom,\n\tTSelectedFields,\n\tTReturning,\n\tTNullabilityMap,\n\tTJoins,\n\ttrue,\n\tnever\n>;\n\nexport interface PgEffectUpdateHKT extends PgUpdateHKTBase {\n\t_type: PgEffectUpdateBase<\n\t\tAssume<this['table'], PgTable>,\n\t\tAssume<this['queryResult'], PgQueryResultHKT>,\n\t\tAssume<this['from'], PgTable | Subquery | PgViewBase | SQL | undefined>,\n\t\tAssume<this['selectedFields'], ColumnsSelection | undefined>,\n\t\tAssume<this['returning'], Record<string, unknown> | undefined>,\n\t\tAssume<this['nullabilityMap'], Record<string, JoinNullability>>,\n\t\tAssume<this['joins'], Join[]>,\n\t\tthis['dynamic'],\n\t\tthis['excludedMethods']\n\t>;\n}\n\nexport type AnyPgEffectUpdate = PgEffectUpdateBase<any, any, any, any, any, any, any, any, any>;\n\nexport interface PgEffectUpdateBase<\n\tTTable extends PgTable,\n\tTQueryResult extends PgQueryResultHKT,\n\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\n\tTFrom extends PgTable | Subquery | PgViewBase | SQL | undefined = undefined,\n\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\n\tTSelectedFields extends ColumnsSelection | undefined = undefined,\n\tTReturning extends Record<string, unknown> | undefined = undefined,\n\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\n\tTNullabilityMap extends Record<string, JoinNullability> = Record<TTable['_']['name'], 'not-null'>,\n\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\n\tTJoins extends Join[] = [],\n\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\n\tTDynamic extends boolean = false,\n\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\n\tTExcludedMethods extends string = never,\n> extends QueryEffect<TReturning extends undefined ? PgQueryResultKind<TQueryResult, never> : TReturning[]> {}\n\nexport class PgEffectUpdateBase<\n\tTTable extends PgTable,\n\tTQueryResult extends PgQueryResultHKT,\n\tTFrom extends PgTable | Subquery | PgViewBase | SQL | undefined = undefined,\n\tTSelectedFields extends ColumnsSelection | undefined = undefined,\n\tTReturning extends Record<string, unknown> | undefined = undefined,\n\tTNullabilityMap extends Record<string, JoinNullability> = Record<TTable['_']['name'], 'not-null'>,\n\tTJoins extends Join[] = [],\n\tTDynamic extends boolean = false,\n\tTExcludedMethods extends string = never,\n> extends PgUpdateBase<\n\tPgEffectUpdateHKT,\n\tTTable,\n\tTQueryResult,\n\tTFrom,\n\tTSelectedFields,\n\tTReturning,\n\tTNullabilityMap,\n\tTJoins,\n\tTDynamic,\n\tTExcludedMethods\n> implements RunnableQuery<TReturning extends undefined ? PgQueryResultKind<TQueryResult, never> : TReturning[], 'pg'> {\n\tstatic override readonly [entityKind]: string = 'PgEffectUpdate';\n\n\tdeclare protected session: PgEffectSession;\n\n\t/** @internal */\n\t_prepare(name?: string): PgEffectUpdatePrepare<this> {\n\t\tconst query = this.session.prepareQuery<\n\t\t\tPreparedQueryConfig & { execute: TReturning[] }\n\t\t>(this.dialect.sqlToQuery(this.getSQL()), this.config.returning, name, true, undefined, {\n\t\t\ttype: 'insert',\n\t\t\ttables: extractUsedTable(this.config.table),\n\t\t}, this.cacheConfig);\n\t\tquery.joinsNotNullableMap = this.joinsNotNullableMap;\n\t\treturn query;\n\t}\n\n\tprepare(name: string): PgEffectUpdatePrepare<this> {\n\t\treturn this._prepare(name);\n\t}\n\n\texecute: ReturnType<this['prepare']>['execute'] = (placeholderValues: Record<string, unknown> = {}) => {\n\t\treturn this._prepare().execute(placeholderValues);\n\t};\n}\n\napplyEffectWrapper(PgEffectUpdateBase);\n"],"mappings":";;;;;;;AA2EA,IAAa,qBAAb,cAUUA,mDAW6G;CACtH,QAA0BC,0BAAsB;;CAKhD,SAAS,MAA4C;EACpD,MAAM,QAAQ,KAAK,QAAQ,aAEzB,KAAK,QAAQ,WAAW,KAAK,QAAQ,CAAC,EAAE,KAAK,OAAO,WAAW,MAAM,MAAM,QAAW;GACvF,MAAM;GACN,QAAQC,uCAAiB,KAAK,OAAO,MAAM;GAC3C,EAAE,KAAK,YAAY;AACpB,QAAM,sBAAsB,KAAK;AACjC,SAAO;;CAGR,QAAQ,MAA2C;AAClD,SAAO,KAAK,SAAS,KAAK;;CAG3B,WAAmD,oBAA6C,EAAE,KAAK;AACtG,SAAO,KAAK,UAAU,CAAC,QAAQ,kBAAkB;;;sDAIhC,mBAAmB"}