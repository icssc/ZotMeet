{"version":3,"file":"vector.cjs","names":["PgColumnBuilder","entityKind","PgColumn"],"sources":["../../../../src/pg-core/columns/vector_extension/vector.ts"],"sourcesContent":["import { entityKind } from '~/entity.ts';\nimport type { PgTable } from '~/pg-core/table.ts';\nimport { getColumnNameAndConfig } from '~/utils.ts';\nimport { PgColumn, PgColumnBuilder } from '../common.ts';\n\nexport class PgVectorBuilder extends PgColumnBuilder<\n\t{\n\t\tdataType: 'array vector';\n\t\tdata: number[];\n\t\tdriverParam: string;\n\t},\n\t{ length: number; isLengthExact: true }\n> {\n\tstatic override readonly [entityKind]: string = 'PgVectorBuilder';\n\n\tconstructor(name: string, config: PgVectorConfig) {\n\t\tsuper(name, 'array vector', 'PgVector');\n\t\tthis.config.length = config.dimensions;\n\t\tthis.config.isLengthExact = true;\n\t}\n\n\t/** @internal */\n\toverride build(table: PgTable<any>) {\n\t\treturn new PgVector(\n\t\t\ttable,\n\t\t\tthis.config as any,\n\t\t);\n\t}\n}\n\nexport class PgVector extends PgColumn<'array vector'> {\n\tstatic override readonly [entityKind]: string = 'PgVector';\n\n\tgetSQLType(): string {\n\t\treturn `vector(${this.length})`;\n\t}\n\n\toverride mapToDriverValue(value: unknown): unknown {\n\t\treturn JSON.stringify(value);\n\t}\n\n\toverride mapFromDriverValue(value: string): unknown {\n\t\treturn value\n\t\t\t.slice(1, -1)\n\t\t\t.split(',')\n\t\t\t.map((v) => Number.parseFloat(v));\n\t}\n}\n\nexport interface PgVectorConfig {\n\tdimensions: number;\n}\n\nexport function vector(\n\tconfig: PgVectorConfig,\n): PgVectorBuilder;\nexport function vector(\n\tname: string,\n\tconfig: PgVectorConfig,\n): PgVectorBuilder;\nexport function vector(a: string | PgVectorConfig, b?: PgVectorConfig) {\n\tconst { name, config } = getColumnNameAndConfig<PgVectorConfig>(a, b);\n\treturn new PgVectorBuilder(name, config);\n}\n"],"mappings":";;;;;;AAKA,IAAa,kBAAb,cAAqCA,+CAOnC;CACD,QAA0BC,0BAAsB;CAEhD,YAAY,MAAc,QAAwB;AACjD,QAAM,MAAM,gBAAgB,WAAW;AACvC,OAAK,OAAO,SAAS,OAAO;AAC5B,OAAK,OAAO,gBAAgB;;;CAI7B,AAAS,MAAM,OAAqB;AACnC,SAAO,IAAI,SACV,OACA,KAAK,OACL;;;AAIH,IAAa,WAAb,cAA8BC,wCAAyB;CACtD,QAA0BD,0BAAsB;CAEhD,aAAqB;AACpB,SAAO,UAAU,KAAK,OAAO;;CAG9B,AAAS,iBAAiB,OAAyB;AAClD,SAAO,KAAK,UAAU,MAAM;;CAG7B,AAAS,mBAAmB,OAAwB;AACnD,SAAO,MACL,MAAM,GAAG,GAAG,CACZ,MAAM,IAAI,CACV,KAAK,MAAM,OAAO,WAAW,EAAE,CAAC;;;AAepC,SAAgB,OAAO,GAA4B,GAAoB;CACtE,MAAM,EAAE,MAAM,kDAAkD,GAAG,EAAE;AACrE,QAAO,IAAI,gBAAgB,MAAM,OAAO"}