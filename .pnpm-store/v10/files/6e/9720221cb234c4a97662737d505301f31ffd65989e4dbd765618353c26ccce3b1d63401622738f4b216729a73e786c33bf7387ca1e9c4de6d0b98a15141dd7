{"version":3,"sources":["../../src/cli/next-upgrade.ts"],"sourcesContent":["import { spawn } from 'child_process'\nimport { getProjectDir } from '../lib/get-project-dir'\nimport { getNpxCommand } from '../lib/helpers/get-npx-command'\n\ninterface NextUpgradeOptions {\n  revision: string\n  verbose: boolean\n}\n\nexport function spawnNextUpgrade(\n  directory: string | undefined,\n  options: NextUpgradeOptions\n) {\n  const baseDir = getProjectDir(directory)\n  const [upgradeProcessCommand, ...upgradeProcessDefaultArgs] =\n    getNpxCommand(baseDir).split(' ')\n\n  const upgradeProcessCommandArgs = [\n    ...upgradeProcessDefaultArgs,\n    // Needs to be bleeding edge (canary) to pick up latest codemods.\n    '@next/codemod@canary',\n    'upgrade',\n    options.revision,\n  ]\n  if (options.verbose) {\n    upgradeProcessCommandArgs.push('--verbose')\n  }\n\n  const upgradeProcess = spawn(\n    upgradeProcessCommand,\n    upgradeProcessCommandArgs,\n    {\n      stdio: 'inherit',\n      cwd: baseDir,\n    }\n  )\n\n  upgradeProcess.on('close', (code) => {\n    process.exitCode = code ?? 0\n  })\n}\n"],"names":["spawnNextUpgrade","directory","options","baseDir","getProjectDir","upgradeProcessCommand","upgradeProcessDefaultArgs","getNpxCommand","split","upgradeProcessCommandArgs","revision","verbose","push","upgradeProcess","spawn","stdio","cwd","on","code","process","exitCode"],"mappings":";;;;+BASgBA;;;eAAAA;;;+BATM;+BACQ;+BACA;AAOvB,SAASA,iBACdC,SAA6B,EAC7BC,OAA2B;IAE3B,MAAMC,UAAUC,IAAAA,4BAAa,EAACH;IAC9B,MAAM,CAACI,uBAAuB,GAAGC,0BAA0B,GACzDC,IAAAA,4BAAa,EAACJ,SAASK,KAAK,CAAC;IAE/B,MAAMC,4BAA4B;WAC7BH;QACH,iEAAiE;QACjE;QACA;QACAJ,QAAQQ,QAAQ;KACjB;IACD,IAAIR,QAAQS,OAAO,EAAE;QACnBF,0BAA0BG,IAAI,CAAC;IACjC;IAEA,MAAMC,iBAAiBC,IAAAA,oBAAK,EAC1BT,uBACAI,2BACA;QACEM,OAAO;QACPC,KAAKb;IACP;IAGFU,eAAeI,EAAE,CAAC,SAAS,CAACC;QAC1BC,QAAQC,QAAQ,GAAGF,QAAQ;IAC7B;AACF","ignoreList":[0]}