{"version":3,"file":"timestamp.js","names":[],"sources":["../../../src/mysql-core/columns/timestamp.ts"],"sourcesContent":["import type { ColumnBaseConfig } from '~/column.ts';\nimport { entityKind } from '~/entity.ts';\nimport type { MySqlTable } from '~/mysql-core/table.ts';\nimport { type Equal, getColumnNameAndConfig } from '~/utils.ts';\nimport { MySqlDateBaseColumn, MySqlDateColumnBaseBuilder } from './date.common.ts';\n\nexport class MySqlTimestampBuilder extends MySqlDateColumnBaseBuilder<{\n\tdataType: 'object date';\n\tdata: Date;\n\tdriverParam: string | number;\n}, MySqlTimestampConfig> {\n\tstatic override readonly [entityKind]: string = 'MySqlTimestampBuilder';\n\n\tconstructor(name: string, config: MySqlTimestampConfig | undefined) {\n\t\tsuper(name, 'object date', 'MySqlTimestamp');\n\t\tthis.config.fsp = config?.fsp;\n\t}\n\n\t/** @internal */\n\toverride build(table: MySqlTable) {\n\t\treturn new MySqlTimestamp(\n\t\t\ttable,\n\t\t\tthis.config as any,\n\t\t);\n\t}\n}\n\nexport class MySqlTimestamp<T extends ColumnBaseConfig<'object date'>>\n\textends MySqlDateBaseColumn<T, MySqlTimestampConfig>\n{\n\tstatic override readonly [entityKind]: string = 'MySqlTimestamp';\n\n\treadonly fsp: number | undefined = this.config.fsp;\n\n\tgetSQLType(): string {\n\t\tconst precision = this.fsp === undefined ? '' : `(${this.fsp})`;\n\t\treturn `timestamp${precision}`;\n\t}\n\n\toverride mapFromDriverValue(value: Date | string): Date {\n\t\tif (typeof value === 'string') return new Date(value + '+0000');\n\n\t\treturn value;\n\t}\n\n\toverride mapToDriverValue(value: Date | string): string {\n\t\tif (typeof value === 'string') return value;\n\t\treturn value.toISOString().slice(0, -1).replace('T', ' ');\n\t}\n}\n\nexport class MySqlTimestampStringBuilder extends MySqlDateColumnBaseBuilder<{\n\tdataType: 'string timestamp';\n\tdata: string;\n\tdriverParam: string | number;\n}, MySqlTimestampConfig> {\n\tstatic override readonly [entityKind]: string = 'MySqlTimestampStringBuilder';\n\n\tconstructor(name: string, config: MySqlTimestampConfig | undefined) {\n\t\tsuper(name, 'string timestamp', 'MySqlTimestampString');\n\t\tthis.config.fsp = config?.fsp;\n\t}\n\n\t/** @internal */\n\toverride build(table: MySqlTable) {\n\t\treturn new MySqlTimestampString(\n\t\t\ttable,\n\t\t\tthis.config as any,\n\t\t);\n\t}\n}\n\nexport class MySqlTimestampString<T extends ColumnBaseConfig<'string timestamp'>>\n\textends MySqlDateBaseColumn<T, MySqlTimestampConfig>\n{\n\tstatic override readonly [entityKind]: string = 'MySqlTimestampString';\n\n\treadonly fsp: number | undefined = this.config.fsp;\n\n\tgetSQLType(): string {\n\t\tconst precision = this.fsp === undefined ? '' : `(${this.fsp})`;\n\t\treturn `timestamp${precision}`;\n\t}\n\n\toverride mapFromDriverValue(value: Date | string): string {\n\t\tif (typeof value === 'string') return value;\n\n\t\tconst shortened = value.toISOString().slice(0, -1).replace('T', ' ');\n\t\tif (shortened.endsWith('.000')) return shortened.slice(0, -4);\n\n\t\treturn shortened;\n\t}\n\n\toverride mapToDriverValue(value: Date | string): string {\n\t\tif (typeof value === 'string') return value;\n\t\treturn value.toISOString().slice(0, -1).replace('T', ' ');\n\t}\n}\n\nexport type TimestampFsp = 0 | 1 | 2 | 3 | 4 | 5 | 6;\n\nexport interface MySqlTimestampConfig<TMode extends 'string' | 'date' = 'string' | 'date'> {\n\tmode?: TMode;\n\tfsp?: TimestampFsp;\n}\n\nexport function timestamp<TMode extends MySqlTimestampConfig['mode'] & {}>(\n\tconfig?: MySqlTimestampConfig<TMode>,\n): Equal<TMode, 'string'> extends true ? MySqlTimestampStringBuilder\n\t: MySqlTimestampBuilder;\nexport function timestamp<TMode extends MySqlTimestampConfig['mode'] & {}>(\n\tname: string,\n\tconfig?: MySqlTimestampConfig<TMode>,\n): Equal<TMode, 'string'> extends true ? MySqlTimestampStringBuilder\n\t: MySqlTimestampBuilder;\nexport function timestamp(a?: string | MySqlTimestampConfig, b: MySqlTimestampConfig = {}) {\n\tconst { name, config } = getColumnNameAndConfig<MySqlTimestampConfig | undefined>(a, b);\n\tif (config?.mode === 'string') {\n\t\treturn new MySqlTimestampStringBuilder(name, config);\n\t}\n\treturn new MySqlTimestampBuilder(name, config);\n}\n"],"mappings":";;;;;AAMA,IAAa,wBAAb,cAA2C,2BAIlB;CACxB,QAA0B,cAAsB;CAEhD,YAAY,MAAc,QAA0C;AACnE,QAAM,MAAM,eAAe,iBAAiB;AAC5C,OAAK,OAAO,MAAM,QAAQ;;;CAI3B,AAAS,MAAM,OAAmB;AACjC,SAAO,IAAI,eACV,OACA,KAAK,OACL;;;AAIH,IAAa,iBAAb,cACS,oBACT;CACC,QAA0B,cAAsB;CAEhD,AAAS,MAA0B,KAAK,OAAO;CAE/C,aAAqB;AAEpB,SAAO,YADW,KAAK,QAAQ,SAAY,KAAK,IAAI,KAAK,IAAI;;CAI9D,AAAS,mBAAmB,OAA4B;AACvD,MAAI,OAAO,UAAU,SAAU,wBAAO,IAAI,KAAK,QAAQ,QAAQ;AAE/D,SAAO;;CAGR,AAAS,iBAAiB,OAA8B;AACvD,MAAI,OAAO,UAAU,SAAU,QAAO;AACtC,SAAO,MAAM,aAAa,CAAC,MAAM,GAAG,GAAG,CAAC,QAAQ,KAAK,IAAI;;;AAI3D,IAAa,8BAAb,cAAiD,2BAIxB;CACxB,QAA0B,cAAsB;CAEhD,YAAY,MAAc,QAA0C;AACnE,QAAM,MAAM,oBAAoB,uBAAuB;AACvD,OAAK,OAAO,MAAM,QAAQ;;;CAI3B,AAAS,MAAM,OAAmB;AACjC,SAAO,IAAI,qBACV,OACA,KAAK,OACL;;;AAIH,IAAa,uBAAb,cACS,oBACT;CACC,QAA0B,cAAsB;CAEhD,AAAS,MAA0B,KAAK,OAAO;CAE/C,aAAqB;AAEpB,SAAO,YADW,KAAK,QAAQ,SAAY,KAAK,IAAI,KAAK,IAAI;;CAI9D,AAAS,mBAAmB,OAA8B;AACzD,MAAI,OAAO,UAAU,SAAU,QAAO;EAEtC,MAAM,YAAY,MAAM,aAAa,CAAC,MAAM,GAAG,GAAG,CAAC,QAAQ,KAAK,IAAI;AACpE,MAAI,UAAU,SAAS,OAAO,CAAE,QAAO,UAAU,MAAM,GAAG,GAAG;AAE7D,SAAO;;CAGR,AAAS,iBAAiB,OAA8B;AACvD,MAAI,OAAO,UAAU,SAAU,QAAO;AACtC,SAAO,MAAM,aAAa,CAAC,MAAM,GAAG,GAAG,CAAC,QAAQ,KAAK,IAAI;;;AAoB3D,SAAgB,UAAU,GAAmC,IAA0B,EAAE,EAAE;CAC1F,MAAM,EAAE,MAAM,WAAW,uBAAyD,GAAG,EAAE;AACvF,KAAI,QAAQ,SAAS,SACpB,QAAO,IAAI,4BAA4B,MAAM,OAAO;AAErD,QAAO,IAAI,sBAAsB,MAAM,OAAO"}