{"version":3,"file":"vector.js","names":[],"sources":["../../../src/cockroach-core/columns/vector.ts"],"sourcesContent":["import type { AnyCockroachTable } from '~/cockroach-core/table.ts';\nimport type { ColumnBaseConfig } from '~/column.ts';\nimport { entityKind } from '~/entity.ts';\nimport { getColumnNameAndConfig } from '~/utils.ts';\nimport { CockroachColumn, CockroachColumnBuilder } from './common.ts';\n\nexport class CockroachVectorBuilder extends CockroachColumnBuilder<\n\t{\n\t\tdataType: 'array vector';\n\t\tdata: number[];\n\t\tdriverParam: string;\n\t},\n\t{ length: number }\n> {\n\tstatic override readonly [entityKind]: string = 'CockroachVectorBuilder';\n\n\tconstructor(name: string, config: CockroachVectorConfig) {\n\t\tsuper(name, 'array vector', 'CockroachVector');\n\t\tthis.config.length = config.dimensions;\n\t}\n\n\t/** @internal */\n\toverride build<TTableName extends string>(\n\t\ttable: AnyCockroachTable<{ name: TTableName }>,\n\t) {\n\t\treturn new CockroachVector(\n\t\t\ttable,\n\t\t\tthis.config,\n\t\t);\n\t}\n}\n\nexport class CockroachVector<\n\tT extends ColumnBaseConfig<'array vector'>,\n> extends CockroachColumn<T, { length: number }> {\n\tstatic override readonly [entityKind]: string = 'CockroachVector';\n\n\tgetSQLType(): string {\n\t\treturn `vector(${this.config.length})`;\n\t}\n\n\toverride mapToDriverValue(value: unknown): unknown {\n\t\treturn JSON.stringify(value);\n\t}\n\n\toverride mapFromDriverValue(value: string): unknown {\n\t\treturn value\n\t\t\t.slice(1, -1)\n\t\t\t.split(',')\n\t\t\t.map((v) => Number.parseFloat(v));\n\t}\n}\n\nexport interface CockroachVectorConfig {\n\tdimensions: number;\n}\n\nexport function vector(\n\tconfig: CockroachVectorConfig,\n): CockroachVectorBuilder;\nexport function vector(\n\tname: string,\n\tconfig: CockroachVectorConfig,\n): CockroachVectorBuilder;\nexport function vector(a: string | CockroachVectorConfig, b?: CockroachVectorConfig) {\n\tconst { name, config } = getColumnNameAndConfig<CockroachVectorConfig>(a, b);\n\treturn new CockroachVectorBuilder(name, config);\n}\n"],"mappings":";;;;;AAMA,IAAa,yBAAb,cAA4C,uBAO1C;CACD,QAA0B,cAAsB;CAEhD,YAAY,MAAc,QAA+B;AACxD,QAAM,MAAM,gBAAgB,kBAAkB;AAC9C,OAAK,OAAO,SAAS,OAAO;;;CAI7B,AAAS,MACR,OACC;AACD,SAAO,IAAI,gBACV,OACA,KAAK,OACL;;;AAIH,IAAa,kBAAb,cAEU,gBAAuC;CAChD,QAA0B,cAAsB;CAEhD,aAAqB;AACpB,SAAO,UAAU,KAAK,OAAO,OAAO;;CAGrC,AAAS,iBAAiB,OAAyB;AAClD,SAAO,KAAK,UAAU,MAAM;;CAG7B,AAAS,mBAAmB,OAAwB;AACnD,SAAO,MACL,MAAM,GAAG,GAAG,CACZ,MAAM,IAAI,CACV,KAAK,MAAM,OAAO,WAAW,EAAE,CAAC;;;AAepC,SAAgB,OAAO,GAAmC,GAA2B;CACpF,MAAM,EAAE,MAAM,WAAW,uBAA8C,GAAG,EAAE;AAC5E,QAAO,IAAI,uBAAuB,MAAM,OAAO"}