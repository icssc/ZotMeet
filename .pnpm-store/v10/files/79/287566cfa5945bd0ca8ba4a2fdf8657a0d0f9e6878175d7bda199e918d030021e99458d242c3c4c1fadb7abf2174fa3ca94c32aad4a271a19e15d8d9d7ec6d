{"version":3,"file":"utils.js","names":["indexes: Index[]","checks: Check[]","primaryKeys: PrimaryKey[]","uniqueConstraints: UniqueConstraint[]","foreignKeys: ForeignKey[]"],"sources":["../../src/mysql-core/utils.ts"],"sourcesContent":["import { is } from '~/entity.ts';\nimport { SQL } from '~/sql/sql.ts';\nimport { Subquery } from '~/subquery.ts';\nimport { Table } from '~/table.ts';\nimport { ViewBaseConfig } from '~/view-common.ts';\nimport type { Check } from './checks.ts';\nimport { CheckBuilder } from './checks.ts';\nimport type { ForeignKey } from './foreign-keys.ts';\nimport { ForeignKeyBuilder } from './foreign-keys.ts';\nimport type { Index } from './indexes.ts';\nimport { IndexBuilder } from './indexes.ts';\nimport type { PrimaryKey } from './primary-keys.ts';\nimport { PrimaryKeyBuilder } from './primary-keys.ts';\nimport type { IndexForHint } from './query-builders/select.ts';\nimport { MySqlTable } from './table.ts';\nimport { type UniqueConstraint, UniqueConstraintBuilder } from './unique-constraint.ts';\nimport type { MySqlViewBase } from './view-base.ts';\nimport { MySqlViewConfig } from './view-common.ts';\nimport type { MySqlView } from './view.ts';\n\nexport function extractUsedTable(table: MySqlTable | Subquery | MySqlViewBase | SQL): string[] {\n\tif (is(table, MySqlTable)) {\n\t\treturn [`${table[Table.Symbol.BaseName]}`];\n\t}\n\tif (is(table, Subquery)) {\n\t\treturn table._.usedTables ?? [];\n\t}\n\tif (is(table, SQL)) {\n\t\treturn table.usedTables ?? [];\n\t}\n\treturn [];\n}\n\nexport function getTableConfig(table: MySqlTable) {\n\tconst columns = Object.values(table[MySqlTable.Symbol.Columns]);\n\tconst indexes: Index[] = [];\n\tconst checks: Check[] = [];\n\tconst primaryKeys: PrimaryKey[] = [];\n\tconst uniqueConstraints: UniqueConstraint[] = [];\n\tconst foreignKeys: ForeignKey[] = Object.values(table[MySqlTable.Symbol.InlineForeignKeys]);\n\tconst name = table[Table.Symbol.Name];\n\tconst schema = table[Table.Symbol.Schema];\n\tconst baseName = table[Table.Symbol.BaseName];\n\n\tconst extraConfigBuilder = table[MySqlTable.Symbol.ExtraConfigBuilder];\n\n\tif (extraConfigBuilder !== undefined) {\n\t\tconst extraConfig = extraConfigBuilder(table[MySqlTable.Symbol.Columns]);\n\t\tconst extraValues = Array.isArray(extraConfig) ? extraConfig.flat(1) as any[] : Object.values(extraConfig);\n\t\tfor (const builder of Object.values(extraValues)) {\n\t\t\tif (is(builder, IndexBuilder)) {\n\t\t\t\tindexes.push(builder.build(table));\n\t\t\t} else if (is(builder, CheckBuilder)) {\n\t\t\t\tchecks.push(builder.build(table));\n\t\t\t} else if (is(builder, UniqueConstraintBuilder)) {\n\t\t\t\tuniqueConstraints.push(builder.build(table));\n\t\t\t} else if (is(builder, PrimaryKeyBuilder)) {\n\t\t\t\tprimaryKeys.push(builder.build(table));\n\t\t\t} else if (is(builder, ForeignKeyBuilder)) {\n\t\t\t\tforeignKeys.push(builder.build(table));\n\t\t\t}\n\t\t}\n\t}\n\n\treturn {\n\t\tcolumns,\n\t\tindexes,\n\t\tforeignKeys,\n\t\tchecks,\n\t\tprimaryKeys,\n\t\tuniqueConstraints,\n\t\tname,\n\t\tschema,\n\t\tbaseName,\n\t};\n}\n\nexport function getViewConfig<\n\tTName extends string = string,\n\tTExisting extends boolean = boolean,\n>(view: MySqlView<TName, TExisting>) {\n\treturn {\n\t\t...view[ViewBaseConfig],\n\t\t...view[MySqlViewConfig],\n\t};\n}\n\nexport function convertIndexToString(indexes: IndexForHint[]) {\n\treturn indexes.map((idx) => {\n\t\treturn typeof idx === 'object' ? is(idx, IndexBuilder) ? idx.config.name : idx.name! : idx;\n\t});\n}\n\nexport function toArray<T>(value: T | T[]): T[] {\n\treturn Array.isArray(value) ? value : [value];\n}\n"],"mappings":";;;;;;;;;;;;;;AAoBA,SAAgB,iBAAiB,OAA8D;AAC9F,KAAI,GAAG,OAAO,WAAW,CACxB,QAAO,CAAC,GAAG,MAAM,MAAM,OAAO,YAAY;AAE3C,KAAI,GAAG,OAAO,SAAS,CACtB,QAAO,MAAM,EAAE,cAAc,EAAE;AAEhC,KAAI,GAAG,OAAO,IAAI,CACjB,QAAO,MAAM,cAAc,EAAE;AAE9B,QAAO,EAAE;;AAGV,SAAgB,eAAe,OAAmB;CACjD,MAAM,UAAU,OAAO,OAAO,MAAM,WAAW,OAAO,SAAS;CAC/D,MAAMA,UAAmB,EAAE;CAC3B,MAAMC,SAAkB,EAAE;CAC1B,MAAMC,cAA4B,EAAE;CACpC,MAAMC,oBAAwC,EAAE;CAChD,MAAMC,cAA4B,OAAO,OAAO,MAAM,WAAW,OAAO,mBAAmB;CAC3F,MAAM,OAAO,MAAM,MAAM,OAAO;CAChC,MAAM,SAAS,MAAM,MAAM,OAAO;CAClC,MAAM,WAAW,MAAM,MAAM,OAAO;CAEpC,MAAM,qBAAqB,MAAM,WAAW,OAAO;AAEnD,KAAI,uBAAuB,QAAW;EACrC,MAAM,cAAc,mBAAmB,MAAM,WAAW,OAAO,SAAS;EACxE,MAAM,cAAc,MAAM,QAAQ,YAAY,GAAG,YAAY,KAAK,EAAE,GAAY,OAAO,OAAO,YAAY;AAC1G,OAAK,MAAM,WAAW,OAAO,OAAO,YAAY,CAC/C,KAAI,GAAG,SAAS,aAAa,CAC5B,SAAQ,KAAK,QAAQ,MAAM,MAAM,CAAC;WACxB,GAAG,SAAS,aAAa,CACnC,QAAO,KAAK,QAAQ,MAAM,MAAM,CAAC;WACvB,GAAG,SAAS,wBAAwB,CAC9C,mBAAkB,KAAK,QAAQ,MAAM,MAAM,CAAC;WAClC,GAAG,SAAS,kBAAkB,CACxC,aAAY,KAAK,QAAQ,MAAM,MAAM,CAAC;WAC5B,GAAG,SAAS,kBAAkB,CACxC,aAAY,KAAK,QAAQ,MAAM,MAAM,CAAC;;AAKzC,QAAO;EACN;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;AAGF,SAAgB,cAGd,MAAmC;AACpC,QAAO;EACN,GAAG,KAAK;EACR,GAAG,KAAK;EACR;;AAGF,SAAgB,qBAAqB,SAAyB;AAC7D,QAAO,QAAQ,KAAK,QAAQ;AAC3B,SAAO,OAAO,QAAQ,WAAW,GAAG,KAAK,aAAa,GAAG,IAAI,OAAO,OAAO,IAAI,OAAQ;GACtF;;AAGH,SAAgB,QAAW,OAAqB;AAC/C,QAAO,MAAM,QAAQ,MAAM,GAAG,QAAQ,CAAC,MAAM"}