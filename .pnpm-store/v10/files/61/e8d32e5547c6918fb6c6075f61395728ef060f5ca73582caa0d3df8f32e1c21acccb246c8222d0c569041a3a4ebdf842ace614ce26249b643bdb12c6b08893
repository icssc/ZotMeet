{"version":3,"file":"context-DRdo5A2P.js","names":["debugEnabled: boolean","query: string[]","context: Context<AdapterContext>"],"sources":["../src/lib/debug.ts","../src/lib/errors.ts","../src/lib/url-encoding.ts","../src/adapters/lib/context.ts"],"sourcesContent":["export const debugEnabled: boolean = isDebugEnabled()\n\nexport function debug(message: string, ...args: any[]): void {\n  if (!debugEnabled) {\n    return\n  }\n  const msg = sprintf(message, ...args)\n  performance.mark(msg)\n  try {\n    // Handle React Devtools not being able to console.log('%s', null)\n    console.log(message, ...args)\n  } catch {\n    console.log(msg)\n  }\n}\n\nexport function warn(message: string, ...args: any[]): void {\n  if (!debugEnabled) {\n    return\n  }\n  console.warn(message, ...args)\n}\n\nexport function sprintf(base: string, ...args: any[]): string {\n  return base.replace(/%[sfdO]/g, match => {\n    const arg = args.shift()\n    return match === '%O' && arg\n      ? JSON.stringify(arg).replace(/\"([^\"]+)\":/g, '$1:')\n      : String(arg)\n  })\n}\n\nfunction isDebugEnabled(): boolean {\n  // Check if localStorage is available.\n  // It may be unavailable in some environments,\n  // like Safari in private browsing mode.\n  // See https://github.com/47ng/nuqs/pull/588\n  try {\n    const test = 'nuqs-localStorage-test'\n    if (typeof localStorage === 'undefined') {\n      return false\n    }\n    localStorage.setItem(test, test)\n    const isStorageAvailable = localStorage.getItem(test) === test\n    localStorage.removeItem(test)\n    return (\n      isStorageAvailable &&\n      (localStorage.getItem('debug') || '').includes('nuqs')\n    )\n  } catch {\n    return false\n  }\n}\n","export const errors = {\n  303: 'Multiple adapter contexts detected. This might happen in monorepos.',\n  404: 'nuqs requires an adapter to work with your framework.',\n  409: 'Multiple versions of the library are loaded. This may lead to unexpected behavior. Currently using `%s`, but `%s` (via the %s adapter) was about to load on top.',\n  414: 'Max safe URL length exceeded. Some browsers may not be able to accept this URL. Consider limiting the amount of state stored in the URL.',\n  422: 'Invalid options combination: `limitUrlUpdates: debounce` should be used in SSR scenarios, with `shallow: false`',\n  429: 'URL update rate-limited by the browser. Consider increasing `throttleMs` for key(s) `%s`. %O',\n  500: \"Empty search params cache. Search params can't be accessed in Layouts.\",\n  501: 'Search params cache already populated. Have you called `parse` twice?'\n} as const\n\nexport function error(code: keyof typeof errors) {\n  return `[nuqs] ${errors[code]}\n  See https://nuqs.dev/NUQS-${code}`\n}\n","import { error } from './errors'\n\nexport function renderQueryString(search: URLSearchParams): string {\n  if (search.size === 0) {\n    return ''\n  }\n  const query: string[] = []\n  for (const [key, value] of search.entries()) {\n    // Replace disallowed characters in keys,\n    // see https://github.com/47ng/nuqs/issues/599\n    const safeKey = key\n      .replace(/#/g, '%23')\n      .replace(/&/g, '%26')\n      .replace(/\\+/g, '%2B')\n      .replace(/=/g, '%3D')\n      .replace(/\\?/g, '%3F')\n    query.push(`${safeKey}=${encodeQueryValue(value)}`)\n  }\n  const queryString = '?' + query.join('&')\n  warnIfURLIsTooLong(queryString)\n  return queryString\n}\n\nexport function encodeQueryValue(input: string): string {\n  return (\n    input\n      // Encode existing % signs first to avoid appearing\n      // as an incomplete escape sequence:\n      .replace(/%/g, '%25')\n      // Note: spaces are encoded as + in RFC 3986,\n      // so we pre-encode existing + signs to avoid confusion\n      // before converting spaces to + signs.\n      .replace(/\\+/g, '%2B')\n      .replace(/ /g, '+')\n      // Encode other URI-reserved characters\n      .replace(/#/g, '%23')\n      .replace(/&/g, '%26')\n      // Encode characters that break URL detection on some platforms\n      // and would drop the tail end of the querystring:\n      .replace(/\"/g, '%22')\n      .replace(/'/g, '%27')\n      .replace(/`/g, '%60')\n      .replace(/</g, '%3C')\n      .replace(/>/g, '%3E')\n      // Encode invisible ASCII control characters\n      .replace(/[\\x00-\\x1F]/g, char => encodeURIComponent(char))\n  )\n}\n\n// Note: change error documentation (NUQS-414) when changing this value.\nexport const URL_MAX_LENGTH = 2000\n\nexport function warnIfURLIsTooLong(queryString: string): void {\n  if (process.env.NODE_ENV === 'production') {\n    return\n  }\n  if (typeof location === 'undefined') {\n    return\n  }\n  const url = new URL(location.href)\n  url.search = queryString\n  if (url.href.length > URL_MAX_LENGTH) {\n    console.warn(error(414))\n  }\n}\n","import {\n  createContext,\n  createElement,\n  useContext,\n  type Context,\n  type ProviderProps,\n  type ReactElement,\n  type ReactNode\n} from 'react'\nimport type { Options } from '../../defs'\nimport { debugEnabled } from '../../lib/debug'\nimport { error } from '../../lib/errors'\nimport type { AdapterInterface, UseAdapterHook } from './defs'\n\nexport type AdapterProps = {\n  defaultOptions?: Partial<\n    Pick<Options, 'shallow' | 'clearOnDefault' | 'scroll' | 'limitUrlUpdates'>\n  >\n  processUrlSearchParams?: (search: URLSearchParams) => URLSearchParams\n}\n\nexport type AdapterContext = AdapterProps & {\n  useAdapter: UseAdapterHook\n}\n\nexport const context: Context<AdapterContext> = createContext<AdapterContext>({\n  useAdapter() {\n    throw new Error(error(404))\n  }\n})\ncontext.displayName = 'NuqsAdapterContext'\n\ndeclare global {\n  interface Window {\n    __NuqsAdapterContext?: typeof context\n  }\n}\n\nif (debugEnabled && typeof window !== 'undefined') {\n  if (window.__NuqsAdapterContext && window.__NuqsAdapterContext !== context) {\n    console.error(error(303))\n  }\n  window.__NuqsAdapterContext = context\n}\n\nexport type AdapterProvider = (\n  props: AdapterProps & {\n    children: ReactNode\n  }\n) => ReactElement<ProviderProps<AdapterContext>>\n\n/**\n * Create a custom adapter (context provider) for nuqs to work with your framework / router.\n *\n * Adapters are based on React Context,\n *\n * @param useAdapter\n * @returns\n */\nexport function createAdapterProvider(\n  useAdapter: UseAdapterHook\n): AdapterProvider {\n  return ({ children, defaultOptions, processUrlSearchParams, ...props }) =>\n    createElement(\n      context.Provider,\n      {\n        ...props,\n        value: { useAdapter, defaultOptions, processUrlSearchParams }\n      },\n      children\n    )\n}\n\nexport function useAdapter(watchKeys: string[]): AdapterInterface {\n  const value = useContext(context)\n  if (!('useAdapter' in value)) {\n    throw new Error(error(404))\n  }\n  return value.useAdapter(watchKeys)\n}\n\nexport const useAdapterDefaultOptions = (): AdapterProps['defaultOptions'] =>\n  useContext(context).defaultOptions\n\nexport const useAdapterProcessUrlSearchParams =\n  (): AdapterProps['processUrlSearchParams'] =>\n    useContext(context).processUrlSearchParams\n"],"mappings":"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"}