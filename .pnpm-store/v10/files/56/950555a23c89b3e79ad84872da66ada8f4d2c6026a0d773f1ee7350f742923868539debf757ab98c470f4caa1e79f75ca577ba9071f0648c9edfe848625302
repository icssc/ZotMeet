{"version":3,"file":"enum.js","names":[],"sources":["../../../src/mysql-core/columns/enum.ts"],"sourcesContent":["import type { ColumnBaseConfig } from '~/column.ts';\nimport { entityKind } from '~/entity.ts';\nimport type { MySqlTable } from '~/mysql-core/table.ts';\nimport type { NonArray, Writable } from '~/utils.ts';\nimport { MySqlStringBaseColumn, MySqlStringColumnBaseBuilder } from './string.common.ts';\n\nexport class MySqlEnumColumnBuilder<TEnum extends [string, ...string[]]> extends MySqlStringColumnBaseBuilder<{\n\tdataType: 'string enum';\n\tdata: TEnum[number];\n\tdriverParam: string;\n\tenumValues: TEnum;\n}, { enumValues: TEnum }> {\n\tstatic override readonly [entityKind]: string = 'MySqlEnumColumnBuilder';\n\n\tconstructor(name: string, values: TEnum) {\n\t\tsuper(name, 'string enum', 'MySqlEnumColumn');\n\t\tthis.config.enumValues = values;\n\t}\n\n\t/** @internal */\n\toverride build(table: MySqlTable) {\n\t\treturn new MySqlEnumColumn(\n\t\t\ttable,\n\t\t\tthis.config as any,\n\t\t);\n\t}\n}\n\nexport class MySqlEnumColumn<T extends ColumnBaseConfig<'string enum'>>\n\textends MySqlStringBaseColumn<T, { enumValues: T['enumValues'] }>\n{\n\tstatic override readonly [entityKind]: string = 'MySqlEnumColumn';\n\n\toverride readonly enumValues = this.config.enumValues;\n\n\tgetSQLType(): string {\n\t\treturn `enum(${this.enumValues!.map((value) => `'${value}'`).join(',')})`;\n\t}\n}\n\n// enum as ts enum\nexport class MySqlEnumObjectColumnBuilder<TEnum extends object> extends MySqlStringColumnBaseBuilder<{\n\tdataType: 'string enum';\n\tdata: TEnum[keyof TEnum];\n\tdriverParam: string;\n\tenumValues: string[];\n}, { enumValues: TEnum }> {\n\tstatic override readonly [entityKind]: string = 'MySqlEnumObjectColumnBuilder';\n\n\tconstructor(name: string, values: TEnum) {\n\t\tsuper(name, 'string enum', 'MySqlEnumObjectColumn');\n\t\tthis.config.enumValues = values;\n\t}\n\n\t/** @internal */\n\toverride build(table: MySqlTable) {\n\t\treturn new MySqlEnumObjectColumn(\n\t\t\ttable,\n\t\t\tthis.config as any,\n\t\t);\n\t}\n}\n\nexport class MySqlEnumObjectColumn<T extends ColumnBaseConfig<'string enum'>>\n\textends MySqlStringBaseColumn<T, { enumValues: T['enumValues'] }>\n{\n\tstatic override readonly [entityKind]: string = 'MySqlEnumObjectColumn';\n\n\toverride readonly enumValues = this.config.enumValues;\n\n\tgetSQLType(): string {\n\t\treturn `enum(${this.enumValues!.map((value) => `'${value}'`).join(',')})`;\n\t}\n}\n\nexport function mysqlEnum<U extends string, T extends Readonly<[U, ...U[]]>>(\n\tvalues: T | Writable<T>,\n): MySqlEnumColumnBuilder<Writable<T>>;\nexport function mysqlEnum<U extends string, T extends Readonly<[U, ...U[]]>>(\n\tname: string,\n\tvalues: T | Writable<T>,\n): MySqlEnumColumnBuilder<Writable<T>>;\nexport function mysqlEnum<E extends Record<string, string>>(\n\tenumObj: NonArray<E>,\n): MySqlEnumObjectColumnBuilder<E>;\nexport function mysqlEnum<E extends Record<string, string>>(\n\tname: string,\n\tvalues: NonArray<E>,\n): MySqlEnumObjectColumnBuilder<E>;\nexport function mysqlEnum(\n\ta?: string | readonly [string, ...string[]] | [string, ...string[]] | Record<string, string>,\n\tb?: readonly [string, ...string[]] | [string, ...string[]] | Record<string, string>,\n): any {\n\t// if name + array or just array - it means we have string union passed\n\tif (typeof a === 'string' && Array.isArray(b) || Array.isArray(a)) {\n\t\tconst name = typeof a === 'string' && a.length > 0 ? a : '';\n\t\tconst values = (typeof a === 'string' ? b : a) ?? [];\n\n\t\tif (values.length === 0) {\n\t\t\tthrow new Error(`You have an empty array for \"${name}\" enum values`);\n\t\t}\n\n\t\treturn new MySqlEnumColumnBuilder(name, values as any);\n\t}\n\n\tif (typeof a === 'string' && typeof b === 'object' || typeof a === 'object') {\n\t\tconst name = typeof a === 'object' ? '' : a;\n\t\tconst values = typeof a === 'object' ? Object.values(a) : typeof b === 'object' ? Object.values(b) : [];\n\n\t\tif (values.length === 0) {\n\t\t\tthrow new Error(`You have an empty array for \"${name}\" enum values`);\n\t\t}\n\n\t\treturn new MySqlEnumObjectColumnBuilder(name, values as any);\n\t}\n}\n"],"mappings":";;;;AAMA,IAAa,yBAAb,cAAiF,6BAKvD;CACzB,QAA0B,cAAsB;CAEhD,YAAY,MAAc,QAAe;AACxC,QAAM,MAAM,eAAe,kBAAkB;AAC7C,OAAK,OAAO,aAAa;;;CAI1B,AAAS,MAAM,OAAmB;AACjC,SAAO,IAAI,gBACV,OACA,KAAK,OACL;;;AAIH,IAAa,kBAAb,cACS,sBACT;CACC,QAA0B,cAAsB;CAEhD,AAAkB,aAAa,KAAK,OAAO;CAE3C,aAAqB;AACpB,SAAO,QAAQ,KAAK,WAAY,KAAK,UAAU,IAAI,MAAM,GAAG,CAAC,KAAK,IAAI,CAAC;;;AAKzE,IAAa,+BAAb,cAAwE,6BAK9C;CACzB,QAA0B,cAAsB;CAEhD,YAAY,MAAc,QAAe;AACxC,QAAM,MAAM,eAAe,wBAAwB;AACnD,OAAK,OAAO,aAAa;;;CAI1B,AAAS,MAAM,OAAmB;AACjC,SAAO,IAAI,sBACV,OACA,KAAK,OACL;;;AAIH,IAAa,wBAAb,cACS,sBACT;CACC,QAA0B,cAAsB;CAEhD,AAAkB,aAAa,KAAK,OAAO;CAE3C,aAAqB;AACpB,SAAO,QAAQ,KAAK,WAAY,KAAK,UAAU,IAAI,MAAM,GAAG,CAAC,KAAK,IAAI,CAAC;;;AAkBzE,SAAgB,UACf,GACA,GACM;AAEN,KAAI,OAAO,MAAM,YAAY,MAAM,QAAQ,EAAE,IAAI,MAAM,QAAQ,EAAE,EAAE;EAClE,MAAM,OAAO,OAAO,MAAM,YAAY,EAAE,SAAS,IAAI,IAAI;EACzD,MAAM,UAAU,OAAO,MAAM,WAAW,IAAI,MAAM,EAAE;AAEpD,MAAI,OAAO,WAAW,EACrB,OAAM,IAAI,MAAM,gCAAgC,KAAK,eAAe;AAGrE,SAAO,IAAI,uBAAuB,MAAM,OAAc;;AAGvD,KAAI,OAAO,MAAM,YAAY,OAAO,MAAM,YAAY,OAAO,MAAM,UAAU;EAC5E,MAAM,OAAO,OAAO,MAAM,WAAW,KAAK;EAC1C,MAAM,SAAS,OAAO,MAAM,WAAW,OAAO,OAAO,EAAE,GAAG,OAAO,MAAM,WAAW,OAAO,OAAO,EAAE,GAAG,EAAE;AAEvG,MAAI,OAAO,WAAW,EACrB,OAAM,IAAI,MAAM,gCAAgC,KAAK,eAAe;AAGrE,SAAO,IAAI,6BAA6B,MAAM,OAAc"}