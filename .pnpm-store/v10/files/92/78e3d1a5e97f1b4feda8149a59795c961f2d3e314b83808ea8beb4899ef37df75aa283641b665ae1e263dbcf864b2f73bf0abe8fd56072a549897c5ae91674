{"version":3,"file":"decimal.cjs","names":["MsSqlColumnBuilderWithIdentity","entityKind","MsSqlColumnWithIdentity"],"sources":["../../../src/mssql-core/columns/decimal.ts"],"sourcesContent":["import type { ColumnBaseConfig } from '~/column.ts';\nimport { entityKind } from '~/entity.ts';\nimport type { AnyMsSqlTable } from '~/mssql-core/table.ts';\nimport { type Equal, getColumnNameAndConfig } from '~/utils.ts';\nimport { MsSqlColumnBuilderWithIdentity, MsSqlColumnWithIdentity } from './common.ts';\n\nexport class MsSqlDecimalBuilder extends MsSqlColumnBuilderWithIdentity<{\n\tdataType: 'string numeric';\n\tdata: string;\n\tdriverParam: string;\n}, MsSqlDecimalConfig> {\n\tstatic override readonly [entityKind]: string = 'MsSqlDecimalBuilder';\n\n\tconstructor(name: string, config: MsSqlDecimalConfig | undefined) {\n\t\tsuper(name, 'string numeric', 'MsSqlDecimal');\n\t\tthis.config.precision = config?.precision;\n\t\tthis.config.scale = config?.scale;\n\t}\n\n\t/** @internal */\n\toverride build<TTableName extends string>(\n\t\ttable: AnyMsSqlTable<{ name: TTableName }>,\n\t) {\n\t\treturn new MsSqlDecimal(\n\t\t\ttable,\n\t\t\tthis.config,\n\t\t);\n\t}\n}\n\nexport class MsSqlDecimal<T extends ColumnBaseConfig<'string numeric'>>\n\textends MsSqlColumnWithIdentity<T, MsSqlDecimalConfig>\n{\n\tstatic override readonly [entityKind]: string = 'MsSqlDecimal';\n\n\treadonly precision: number | undefined = this.config.precision;\n\treadonly scale: number | undefined = this.config.scale;\n\n\toverride mapFromDriverValue(value: unknown): string {\n\t\tif (typeof value === 'string') return value;\n\n\t\treturn String(value);\n\t}\n\n\tgetSQLType(): string {\n\t\tif (this.precision !== undefined && this.scale !== undefined) {\n\t\t\treturn `decimal(${this.precision},${this.scale})`;\n\t\t} else if (this.precision === undefined) {\n\t\t\treturn 'decimal';\n\t\t} else {\n\t\t\treturn `decimal(${this.precision})`;\n\t\t}\n\t}\n}\n\nexport class MsSqlDecimalNumberBuilder extends MsSqlColumnBuilderWithIdentity<{\n\tdataType: 'number';\n\tdata: number;\n\tdriverParam: string;\n}, MsSqlDecimalConfig> {\n\tstatic override readonly [entityKind]: string = 'MsSqlDecimalNumberBuilder';\n\n\tconstructor(name: string, config: MsSqlDecimalConfig | undefined) {\n\t\tsuper(name, 'number', 'MsSqlDecimalNumber');\n\t\tthis.config.precision = config?.precision;\n\t\tthis.config.scale = config?.scale;\n\t}\n\n\t/** @internal */\n\toverride build<TTableName extends string>(\n\t\ttable: AnyMsSqlTable<{ name: TTableName }>,\n\t) {\n\t\treturn new MsSqlDecimalNumber(\n\t\t\ttable,\n\t\t\tthis.config,\n\t\t);\n\t}\n}\n\nexport class MsSqlDecimalNumber<T extends ColumnBaseConfig<'number'>>\n\textends MsSqlColumnWithIdentity<T, MsSqlDecimalConfig>\n{\n\tstatic override readonly [entityKind]: string = 'MsSqlDecimalNumber';\n\n\treadonly precision: number | undefined = this.config.precision;\n\treadonly scale: number | undefined = this.config.scale;\n\n\toverride mapFromDriverValue(value: unknown): number {\n\t\tif (typeof value === 'number') return value;\n\n\t\treturn Number(value);\n\t}\n\n\toverride mapToDriverValue = String;\n\n\tgetSQLType(): string {\n\t\tif (this.precision !== undefined && this.scale !== undefined) {\n\t\t\treturn `decimal(${this.precision},${this.scale})`;\n\t\t} else if (this.precision === undefined) {\n\t\t\treturn 'decimal';\n\t\t} else {\n\t\t\treturn `decimal(${this.precision})`;\n\t\t}\n\t}\n}\n\nexport class MsSqlDecimalBigIntBuilder extends MsSqlColumnBuilderWithIdentity<\n\t{\n\t\tdataType: 'bigint int64';\n\t\tdata: bigint;\n\t\tdriverParam: string;\n\t},\n\tMsSqlDecimalConfig\n> {\n\tstatic override readonly [entityKind]: string = 'MsSqlDecimalBigIntBuilder';\n\n\tconstructor(name: string, config: MsSqlDecimalConfig | undefined) {\n\t\tsuper(name, 'bigint int64', 'MsSqlDecimalBigInt');\n\t\tthis.config.precision = config?.precision ?? 18;\n\t\tthis.config.scale = config?.scale ?? 0;\n\t}\n\n\t/** @internal */\n\toverride build<TTableName extends string>(\n\t\ttable: AnyMsSqlTable<{ name: TTableName }>,\n\t) {\n\t\treturn new MsSqlDecimalBigInt(\n\t\t\ttable,\n\t\t\tthis.config,\n\t\t);\n\t}\n}\n\nexport class MsSqlDecimalBigInt<T extends ColumnBaseConfig<'bigint int64'>>\n\textends MsSqlColumnWithIdentity<T, MsSqlDecimalConfig>\n{\n\tstatic override readonly [entityKind]: string = 'MsSqlDecimalBigInt';\n\n\treadonly precision: number | undefined = this.config.precision;\n\treadonly scale: number | undefined = this.config.scale;\n\n\toverride mapFromDriverValue = BigInt;\n\n\toverride mapToDriverValue = String;\n\n\tgetSQLType(): string {\n\t\tif (this.precision !== undefined && this.scale !== undefined) {\n\t\t\treturn `decimal(${this.precision},${this.scale})`;\n\t\t} else if (this.precision === undefined) {\n\t\t\treturn 'decimal';\n\t\t} else {\n\t\t\treturn `decimal(${this.precision})`;\n\t\t}\n\t}\n}\n\nexport interface MsSqlDecimalConfig<\n\tT extends 'string' | 'number' | 'bigint' = 'string' | 'number' | 'bigint',\n> {\n\tprecision?: number;\n\tscale?: number;\n\tmode?: T;\n}\n\nexport function decimal<TMode extends 'string' | 'number' | 'bigint'>(\n\tconfig?: MsSqlDecimalConfig<TMode>,\n): Equal<TMode, 'number'> extends true ? MsSqlDecimalNumberBuilder\n\t: Equal<TMode, 'bigint'> extends true ? MsSqlDecimalBigIntBuilder\n\t: MsSqlDecimalBuilder;\nexport function decimal<TMode extends 'string' | 'number' | 'bigint'>(\n\tname: string,\n\tconfig?: MsSqlDecimalConfig<TMode>,\n): Equal<TMode, 'number'> extends true ? MsSqlDecimalNumberBuilder\n\t: Equal<TMode, 'bigint'> extends true ? MsSqlDecimalBigIntBuilder\n\t: MsSqlDecimalBuilder;\nexport function decimal(a?: string | MsSqlDecimalConfig, b?: MsSqlDecimalConfig) {\n\tconst { name, config } = getColumnNameAndConfig<MsSqlDecimalConfig>(a, b);\n\tconst mode = config?.mode;\n\treturn mode === 'number'\n\t\t? new MsSqlDecimalNumberBuilder(name, config)\n\t\t: mode === 'bigint'\n\t\t? new MsSqlDecimalBigIntBuilder(name, config)\n\t\t: new MsSqlDecimalBuilder(name, config);\n}\n"],"mappings":";;;;;;AAMA,IAAa,sBAAb,cAAyCA,iEAIlB;CACtB,QAA0BC,0BAAsB;CAEhD,YAAY,MAAc,QAAwC;AACjE,QAAM,MAAM,kBAAkB,eAAe;AAC7C,OAAK,OAAO,YAAY,QAAQ;AAChC,OAAK,OAAO,QAAQ,QAAQ;;;CAI7B,AAAS,MACR,OACC;AACD,SAAO,IAAI,aACV,OACA,KAAK,OACL;;;AAIH,IAAa,eAAb,cACSC,0DACT;CACC,QAA0BD,0BAAsB;CAEhD,AAAS,YAAgC,KAAK,OAAO;CACrD,AAAS,QAA4B,KAAK,OAAO;CAEjD,AAAS,mBAAmB,OAAwB;AACnD,MAAI,OAAO,UAAU,SAAU,QAAO;AAEtC,SAAO,OAAO,MAAM;;CAGrB,aAAqB;AACpB,MAAI,KAAK,cAAc,UAAa,KAAK,UAAU,OAClD,QAAO,WAAW,KAAK,UAAU,GAAG,KAAK,MAAM;WACrC,KAAK,cAAc,OAC7B,QAAO;MAEP,QAAO,WAAW,KAAK,UAAU;;;AAKpC,IAAa,4BAAb,cAA+CD,iEAIxB;CACtB,QAA0BC,0BAAsB;CAEhD,YAAY,MAAc,QAAwC;AACjE,QAAM,MAAM,UAAU,qBAAqB;AAC3C,OAAK,OAAO,YAAY,QAAQ;AAChC,OAAK,OAAO,QAAQ,QAAQ;;;CAI7B,AAAS,MACR,OACC;AACD,SAAO,IAAI,mBACV,OACA,KAAK,OACL;;;AAIH,IAAa,qBAAb,cACSC,0DACT;CACC,QAA0BD,0BAAsB;CAEhD,AAAS,YAAgC,KAAK,OAAO;CACrD,AAAS,QAA4B,KAAK,OAAO;CAEjD,AAAS,mBAAmB,OAAwB;AACnD,MAAI,OAAO,UAAU,SAAU,QAAO;AAEtC,SAAO,OAAO,MAAM;;CAGrB,AAAS,mBAAmB;CAE5B,aAAqB;AACpB,MAAI,KAAK,cAAc,UAAa,KAAK,UAAU,OAClD,QAAO,WAAW,KAAK,UAAU,GAAG,KAAK,MAAM;WACrC,KAAK,cAAc,OAC7B,QAAO;MAEP,QAAO,WAAW,KAAK,UAAU;;;AAKpC,IAAa,4BAAb,cAA+CD,iEAO7C;CACD,QAA0BC,0BAAsB;CAEhD,YAAY,MAAc,QAAwC;AACjE,QAAM,MAAM,gBAAgB,qBAAqB;AACjD,OAAK,OAAO,YAAY,QAAQ,aAAa;AAC7C,OAAK,OAAO,QAAQ,QAAQ,SAAS;;;CAItC,AAAS,MACR,OACC;AACD,SAAO,IAAI,mBACV,OACA,KAAK,OACL;;;AAIH,IAAa,qBAAb,cACSC,0DACT;CACC,QAA0BD,0BAAsB;CAEhD,AAAS,YAAgC,KAAK,OAAO;CACrD,AAAS,QAA4B,KAAK,OAAO;CAEjD,AAAS,qBAAqB;CAE9B,AAAS,mBAAmB;CAE5B,aAAqB;AACpB,MAAI,KAAK,cAAc,UAAa,KAAK,UAAU,OAClD,QAAO,WAAW,KAAK,UAAU,GAAG,KAAK,MAAM;WACrC,KAAK,cAAc,OAC7B,QAAO;MAEP,QAAO,WAAW,KAAK,UAAU;;;AAwBpC,SAAgB,QAAQ,GAAiC,GAAwB;CAChF,MAAM,EAAE,MAAM,kDAAsD,GAAG,EAAE;CACzE,MAAM,OAAO,QAAQ;AACrB,QAAO,SAAS,WACb,IAAI,0BAA0B,MAAM,OAAO,GAC3C,SAAS,WACT,IAAI,0BAA0B,MAAM,OAAO,GAC3C,IAAI,oBAAoB,MAAM,OAAO"}