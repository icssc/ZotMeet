{"version":3,"file":"migrator.cjs","names":["migrations: MigrationMeta[]","migrations"],"sources":["../../src/bun-sqlite/migrator.ts"],"sourcesContent":["import type {\n\tMigrationConfig,\n\tMigrationFromJournalConfig,\n\tMigrationMeta,\n\tMigrationsJournal,\n\tMigratorInitFailResponse,\n} from '~/migrator.ts';\nimport { readMigrationFiles } from '~/migrator.ts';\nimport type { AnyRelations, EmptyRelations } from '~/relations.ts';\nimport type { SQLiteBunDatabase } from './driver.ts';\n\nexport function migrate<TSchema extends Record<string, unknown>, TRelations extends AnyRelations = EmptyRelations>(\n\tdb: SQLiteBunDatabase<TSchema, TRelations>,\n\tconfig: MigrationConfig,\n): void | MigratorInitFailResponse;\nexport function migrate<\n\tTSchema extends Record<string, unknown>,\n\tTRelations extends AnyRelations = EmptyRelations,\n>(\n\tdb: SQLiteBunDatabase<TSchema, TRelations>,\n\tconfig: MigrationFromJournalConfig | MigrationsJournal,\n): void;\nexport function migrate<TSchema extends Record<string, unknown>, TRelations extends AnyRelations = EmptyRelations>(\n\tdb: SQLiteBunDatabase<TSchema, TRelations>,\n\tconfig: MigrationConfig | MigrationFromJournalConfig | MigrationsJournal,\n): void | MigratorInitFailResponse {\n\tif (Array.isArray(config) || 'migrationsJournal' in config) {\n\t\tconst journal = Array.isArray(config) ? config : config.migrationsJournal;\n\t\tconst migrationsTable = Array.isArray(config) ? undefined : config.migrationsTable;\n\n\t\tconst migrations: MigrationMeta[] = journal.map((d) => ({\n\t\t\tsql: d.sql.split('--> statement-breakpoint'),\n\t\t\tfolderMillis: d.timestamp,\n\t\t\thash: '',\n\t\t\tbps: true,\n\t\t}));\n\n\t\treturn db.dialect.migrate(migrations, db.session, {\n\t\t\tmigrationsTable,\n\t\t});\n\t}\n\n\tconst migrations = readMigrationFiles(config as MigrationConfig);\n\treturn db.dialect.migrate(migrations, db.session, config as MigrationConfig);\n}\n"],"mappings":";;;;AAsBA,SAAgB,QACf,IACA,QACkC;AAClC,KAAI,MAAM,QAAQ,OAAO,IAAI,uBAAuB,QAAQ;EAC3D,MAAM,UAAU,MAAM,QAAQ,OAAO,GAAG,SAAS,OAAO;EACxD,MAAM,kBAAkB,MAAM,QAAQ,OAAO,GAAG,SAAY,OAAO;EAEnE,MAAMA,eAA8B,QAAQ,KAAK,OAAO;GACvD,KAAK,EAAE,IAAI,MAAM,2BAA2B;GAC5C,cAAc,EAAE;GAChB,MAAM;GACN,KAAK;GACL,EAAE;AAEH,SAAO,GAAG,QAAQ,QAAQC,cAAY,GAAG,SAAS,EACjD,iBACA,CAAC;;CAGH,MAAM,mDAAgC,OAA0B;AAChE,QAAO,GAAG,QAAQ,QAAQ,YAAY,GAAG,SAAS,OAA0B"}