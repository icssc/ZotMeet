const require_rolldown_runtime = require('../../_virtual/rolldown_runtime.cjs');
const require_singlestore_core_query_builders_select = require('./select.cjs');
let __entity_ts = require("../../entity.cjs");
let __subquery_ts = require("../../subquery.cjs");
let __singlestore_core_dialect_ts = require("../dialect.cjs");
let __selection_proxy_ts = require("../../selection-proxy.cjs");

//#region src/singlestore-core/query-builders/query-builder.ts
var QueryBuilder = class {
	static [__entity_ts.entityKind] = "SingleStoreQueryBuilder";
	dialect;
	dialectConfig;
	constructor(dialect) {
		this.dialect = (0, __entity_ts.is)(dialect, __singlestore_core_dialect_ts.SingleStoreDialect) ? dialect : void 0;
		this.dialectConfig = (0, __entity_ts.is)(dialect, __singlestore_core_dialect_ts.SingleStoreDialect) ? void 0 : dialect;
	}
	$with = (alias, selection) => {
		const queryBuilder = this;
		const as = (qb) => {
			if (typeof qb === "function") qb = qb(queryBuilder);
			return new Proxy(new __subquery_ts.WithSubquery(qb.getSQL(), selection ?? ("getSelectedFields" in qb ? qb.getSelectedFields() ?? {} : {}), alias, true), new __selection_proxy_ts.SelectionProxyHandler({
				alias,
				sqlAliasedBehavior: "alias",
				sqlBehavior: "error"
			}));
		};
		return { as };
	};
	with(...queries) {
		const self = this;
		function select(fields) {
			return new require_singlestore_core_query_builders_select.SingleStoreSelectBuilder({
				fields: fields ?? void 0,
				session: void 0,
				dialect: self.getDialect(),
				withList: queries
			});
		}
		function selectDistinct(fields) {
			return new require_singlestore_core_query_builders_select.SingleStoreSelectBuilder({
				fields: fields ?? void 0,
				session: void 0,
				dialect: self.getDialect(),
				withList: queries,
				distinct: true
			});
		}
		return {
			select,
			selectDistinct
		};
	}
	select(fields) {
		return new require_singlestore_core_query_builders_select.SingleStoreSelectBuilder({
			fields: fields ?? void 0,
			session: void 0,
			dialect: this.getDialect()
		});
	}
	selectDistinct(fields) {
		return new require_singlestore_core_query_builders_select.SingleStoreSelectBuilder({
			fields: fields ?? void 0,
			session: void 0,
			dialect: this.getDialect(),
			distinct: true
		});
	}
	getDialect() {
		if (!this.dialect) this.dialect = new __singlestore_core_dialect_ts.SingleStoreDialect(this.dialectConfig);
		return this.dialect;
	}
};

//#endregion
exports.QueryBuilder = QueryBuilder;
//# sourceMappingURL=query-builder.cjs.map