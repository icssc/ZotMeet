{"version":3,"file":"session.cjs","names":["SQLitePreparedQuery","entityKind","prisma: PrismaClient","logger: Logger","SQLiteSession","NoopLogger"],"sources":["../../../src/prisma/sqlite/session.ts"],"sourcesContent":["import type { PrismaClient } from '@prisma/client/extension';\n\nimport { entityKind } from '~/entity.ts';\nimport { type Logger, NoopLogger } from '~/logger.ts';\nimport type { EmptyRelations } from '~/relations.ts';\nimport type { Query } from '~/sql/sql.ts';\nimport { fillPlaceholders } from '~/sql/sql.ts';\nimport type {\n\tPreparedQueryConfig as PreparedQueryConfigBase,\n\tSelectedFieldsOrdered,\n\tSQLiteAsyncDialect,\n\tSQLiteExecuteMethod,\n\tSQLiteTransaction,\n\tSQLiteTransactionConfig,\n} from '~/sqlite-core/index.ts';\nimport { SQLitePreparedQuery, SQLiteSession } from '~/sqlite-core/index.ts';\n\ntype PreparedQueryConfig = Omit<PreparedQueryConfigBase, 'statement' | 'run'>;\n\nexport class PrismaSQLitePreparedQuery<T extends PreparedQueryConfig = PreparedQueryConfig> extends SQLitePreparedQuery<\n\t{ type: 'async'; run: []; all: T['all']; get: T['get']; values: never; execute: T['execute'] }\n> {\n\tstatic override readonly [entityKind]: string = 'PrismaSQLitePreparedQuery';\n\n\tconstructor(\n\t\tprivate readonly prisma: PrismaClient,\n\t\tquery: Query,\n\t\tprivate readonly logger: Logger,\n\t\texecuteMethod: SQLiteExecuteMethod,\n\t) {\n\t\tsuper('async', executeMethod, query);\n\t}\n\n\toverride all(placeholderValues?: Record<string, unknown>): Promise<T['all']> {\n\t\tconst params = fillPlaceholders(this.query.params, placeholderValues ?? {});\n\t\tthis.logger.logQuery(this.query.sql, params);\n\t\treturn this.prisma.$queryRawUnsafe(this.query.sql, ...params);\n\t}\n\n\toverride async run(placeholderValues?: Record<string, unknown> | undefined): Promise<[]> {\n\t\tawait this.all(placeholderValues);\n\t\treturn [];\n\t}\n\n\toverride async get(placeholderValues?: Record<string, unknown> | undefined): Promise<T['get']> {\n\t\tconst all = await this.all(placeholderValues) as unknown[];\n\t\treturn all[0];\n\t}\n\n\toverride values(_placeholderValues?: Record<string, unknown> | undefined): Promise<never> {\n\t\tthrow new Error('Method not implemented.');\n\t}\n\n\toverride isResponseInArrayMode(): boolean {\n\t\treturn false;\n\t}\n}\n\nexport interface PrismaSQLiteSessionOptions {\n\tlogger?: Logger;\n}\n\nexport class PrismaSQLiteSession extends SQLiteSession<\n\t'async',\n\tunknown,\n\tRecord<string, never>,\n\tEmptyRelations,\n\tRecord<string, never>\n> {\n\tstatic override readonly [entityKind]: string = 'PrismaSQLiteSession';\n\n\tprivate readonly logger: Logger;\n\n\tconstructor(\n\t\tprivate readonly prisma: PrismaClient,\n\t\tdialect: SQLiteAsyncDialect,\n\t\toptions: PrismaSQLiteSessionOptions,\n\t) {\n\t\tsuper(dialect);\n\t\tthis.logger = options.logger ?? new NoopLogger();\n\t}\n\n\toverride prepareQuery<T extends Omit<PreparedQueryConfig, 'run'>>(\n\t\tquery: Query,\n\t\tfields: SelectedFieldsOrdered | undefined,\n\t\texecuteMethod: SQLiteExecuteMethod,\n\t): PrismaSQLitePreparedQuery<T> {\n\t\treturn new PrismaSQLitePreparedQuery(this.prisma, query, this.logger, executeMethod);\n\t}\n\n\toverride prepareRelationalQuery<T extends Omit<PreparedQueryConfig, 'run'>>(\n\t\t// query: Query,\n\t\t// fields: SelectedFieldsOrdered | undefined,\n\t\t// executeMethod: SQLiteExecuteMethod,\n\t): PrismaSQLitePreparedQuery<T> {\n\t\tthrow new Error('Method not implemented.');\n\t\t// return new PrismaSQLitePreparedQuery(this.prisma, query, this.logger, executeMethod);\n\t}\n\n\toverride transaction<T>(\n\t\t_transaction: (\n\t\t\ttx: SQLiteTransaction<\n\t\t\t\t'async',\n\t\t\t\tunknown,\n\t\t\t\tRecord<string, never>,\n\t\t\t\tEmptyRelations,\n\t\t\t\tRecord<string, never>\n\t\t\t>,\n\t\t) => Promise<T>,\n\t\t_config?: SQLiteTransactionConfig,\n\t): Promise<T> {\n\t\tthrow new Error('Method not implemented.');\n\t}\n}\n"],"mappings":";;;;;;;AAmBA,IAAa,4BAAb,cAAoGA,2CAElG;CACD,QAA0BC,0BAAsB;CAEhD,YACC,AAAiBC,QACjB,OACA,AAAiBC,QACjB,eACC;AACD,QAAM,SAAS,eAAe,MAAM;EALnB;EAEA;;CAMlB,AAAS,IAAI,mBAAgE;EAC5E,MAAM,4CAA0B,KAAK,MAAM,QAAQ,qBAAqB,EAAE,CAAC;AAC3E,OAAK,OAAO,SAAS,KAAK,MAAM,KAAK,OAAO;AAC5C,SAAO,KAAK,OAAO,gBAAgB,KAAK,MAAM,KAAK,GAAG,OAAO;;CAG9D,MAAe,IAAI,mBAAsE;AACxF,QAAM,KAAK,IAAI,kBAAkB;AACjC,SAAO,EAAE;;CAGV,MAAe,IAAI,mBAA4E;AAE9F,UADY,MAAM,KAAK,IAAI,kBAAkB,EAClC;;CAGZ,AAAS,OAAO,oBAA0E;AACzF,QAAM,IAAI,MAAM,0BAA0B;;CAG3C,AAAS,wBAAiC;AACzC,SAAO;;;AAQT,IAAa,sBAAb,cAAyCC,qCAMvC;CACD,QAA0BH,0BAAsB;CAEhD,AAAiB;CAEjB,YACC,AAAiBC,QACjB,SACA,SACC;AACD,QAAM,QAAQ;EAJG;AAKjB,OAAK,SAAS,QAAQ,UAAU,IAAIG,wBAAY;;CAGjD,AAAS,aACR,OACA,QACA,eAC+B;AAC/B,SAAO,IAAI,0BAA0B,KAAK,QAAQ,OAAO,KAAK,QAAQ,cAAc;;CAGrF,AAAS,yBAIuB;AAC/B,QAAM,IAAI,MAAM,0BAA0B;;CAI3C,AAAS,YACR,cASA,SACa;AACb,QAAM,IAAI,MAAM,0BAA0B"}