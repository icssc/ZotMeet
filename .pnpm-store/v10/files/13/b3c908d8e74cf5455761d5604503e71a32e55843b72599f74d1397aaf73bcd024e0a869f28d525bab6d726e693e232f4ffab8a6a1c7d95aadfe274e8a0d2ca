{"version":3,"file":"policies.js","names":["name: string"],"sources":["../../src/cockroach-core/policies.ts"],"sourcesContent":["import { entityKind } from '~/entity.ts';\nimport type { SQL } from '~/sql/sql.ts';\nimport type { CockroachRole } from './roles.ts';\nimport type { CockroachTable } from './table.ts';\n\nexport type CockroachPolicyToOption =\n\t| 'public'\n\t| 'current_user'\n\t| 'session_user'\n\t| (string & {})\n\t| CockroachPolicyToOption[]\n\t| CockroachRole;\n\nexport interface CockroachPolicyConfig {\n\tas?: 'permissive' | 'restrictive';\n\tfor?: 'all' | 'select' | 'insert' | 'update' | 'delete';\n\tto?: CockroachPolicyToOption;\n\tusing?: SQL;\n\twithCheck?: SQL;\n}\n\nexport class CockroachPolicy implements CockroachPolicyConfig {\n\tstatic readonly [entityKind]: string = 'CockroachPolicy';\n\n\treadonly as: CockroachPolicyConfig['as'];\n\treadonly for: CockroachPolicyConfig['for'];\n\treadonly to: CockroachPolicyConfig['to'];\n\treadonly using: CockroachPolicyConfig['using'];\n\treadonly withCheck: CockroachPolicyConfig['withCheck'];\n\n\t/** @internal */\n\t_linkedTable?: CockroachTable;\n\n\tconstructor(\n\t\treadonly name: string,\n\t\tconfig?: CockroachPolicyConfig,\n\t) {\n\t\tif (config) {\n\t\t\tthis.as = config.as;\n\t\t\tthis.for = config.for;\n\t\t\tthis.to = config.to;\n\t\t\tthis.using = config.using;\n\t\t\tthis.withCheck = config.withCheck;\n\t\t}\n\t}\n\n\tlink(table: CockroachTable): this {\n\t\tthis._linkedTable = table;\n\t\treturn this;\n\t}\n}\n\nexport function cockroachPolicy(name: string, config?: CockroachPolicyConfig) {\n\treturn new CockroachPolicy(name, config);\n}\n"],"mappings":";;;AAqBA,IAAa,kBAAb,MAA8D;CAC7D,QAAiB,cAAsB;CAEvC,AAAS;CACT,AAAS;CACT,AAAS;CACT,AAAS;CACT,AAAS;;CAGT;CAEA,YACC,AAASA,MACT,QACC;EAFQ;AAGT,MAAI,QAAQ;AACX,QAAK,KAAK,OAAO;AACjB,QAAK,MAAM,OAAO;AAClB,QAAK,KAAK,OAAO;AACjB,QAAK,QAAQ,OAAO;AACpB,QAAK,YAAY,OAAO;;;CAI1B,KAAK,OAA6B;AACjC,OAAK,eAAe;AACpB,SAAO;;;AAIT,SAAgB,gBAAgB,MAAc,QAAgC;AAC7E,QAAO,IAAI,gBAAgB,MAAM,OAAO"}