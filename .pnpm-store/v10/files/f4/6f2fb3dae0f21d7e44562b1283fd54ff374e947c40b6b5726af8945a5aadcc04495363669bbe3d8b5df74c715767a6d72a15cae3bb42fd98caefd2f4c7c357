{"version":3,"file":"enum.cjs","names":["CockroachColumnWithArrayBuilder","entityKind","CockroachColumn","enumInstance: CockroachEnum<Writable<T>>","enumInstance: CockroachEnumObject<T>"],"sources":["../../../src/cockroach-core/columns/enum.ts"],"sourcesContent":["import type { AnyCockroachTable, CockroachTable } from '~/cockroach-core/table.ts';\nimport type { ColumnBaseConfig } from '~/column.ts';\nimport { entityKind } from '~/entity.ts';\nimport type { NonArray, Writable } from '~/utils.ts';\nimport { CockroachColumn, CockroachColumnWithArrayBuilder } from './common.ts';\n\n// Enum as ts enum\nexport interface CockroachEnumObject<TValues extends object> {\n\t(name?: string): CockroachEnumObjectColumnBuilder<TValues>;\n\n\treadonly enumName: string;\n\treadonly enumValues: string[];\n\treadonly schema: string | undefined;\n\t/** @internal */\n\t[isCockroachEnumSym]: true;\n}\n\nexport class CockroachEnumObjectColumnBuilder<TValues extends object> extends CockroachColumnWithArrayBuilder<\n\t{\n\t\tdataType: 'string enum';\n\t\tdata: TValues[keyof TValues];\n\t\tenumValues: string[];\n\t\tdriverParam: string;\n\t},\n\t{ enum: CockroachEnumObject<any> }\n> {\n\tstatic override readonly [entityKind]: string = 'CockroachEnumObjectColumnBuilder';\n\n\tconstructor(name: string, enumInstance: CockroachEnumObject<any>) {\n\t\tsuper(name, 'string enum', 'CockroachEnumObjectColumn');\n\t\tthis.config.enum = enumInstance;\n\t}\n\n\t/** @internal */\n\toverride build<TTableName extends string>(\n\t\ttable: AnyCockroachTable<{ name: TTableName }>,\n\t) {\n\t\treturn new CockroachEnumObjectColumn(\n\t\t\ttable,\n\t\t\tthis.config,\n\t\t);\n\t}\n}\n\nexport class CockroachEnumObjectColumn<\n\tT extends ColumnBaseConfig<'string enum'> & { enumValues: object },\n> extends CockroachColumn<T, { enum: CockroachEnumObject<object> }> {\n\tstatic override readonly [entityKind]: string = 'CockroachEnumObjectColumn';\n\n\treadonly enum;\n\toverride readonly enumValues = this.config.enum.enumValues;\n\n\tconstructor(\n\t\ttable: CockroachTable<any>,\n\t\tconfig: CockroachEnumObjectColumnBuilder<T>['config'],\n\t) {\n\t\tsuper(table, config);\n\t\tthis.enum = config.enum;\n\t}\n\n\tgetSQLType(): string {\n\t\treturn this.enum.enumName;\n\t}\n}\n\n// Enum as string union\nconst isCockroachEnumSym = Symbol.for('drizzle:isCockroachEnum');\nexport interface CockroachEnum<TValues extends [string, ...string[]]> {\n\t(name?: string): CockroachEnumColumnBuilder<TValues>;\n\n\treadonly enumName: string;\n\treadonly enumValues: TValues;\n\treadonly schema: string | undefined;\n\t/** @internal */\n\t[isCockroachEnumSym]: true;\n}\n\nexport function isCockroachEnum(obj: unknown): obj is CockroachEnum<[string, ...string[]]> {\n\treturn !!obj && typeof obj === 'function' && isCockroachEnumSym in obj && obj[isCockroachEnumSym] === true;\n}\n\nexport class CockroachEnumColumnBuilder<TValues extends [string, ...string[]]> extends CockroachColumnWithArrayBuilder<{\n\tdataType: 'string';\n\tdata: TValues[number];\n\tenumValues: TValues;\n\tdriverParam: string;\n}, { enum: CockroachEnum<TValues> }> {\n\tstatic override readonly [entityKind]: string = 'CockroachEnumColumnBuilder';\n\n\tconstructor(name: string, enumInstance: CockroachEnum<TValues>) {\n\t\tsuper(name, 'string enum', 'CockroachEnumColumn');\n\t\tthis.config.enum = enumInstance;\n\t}\n\n\t/** @internal */\n\toverride build<TTableName extends string>(\n\t\ttable: AnyCockroachTable<{ name: TTableName }>,\n\t) {\n\t\treturn new CockroachEnumColumn(\n\t\t\ttable,\n\t\t\tthis.config,\n\t\t);\n\t}\n}\n\nexport class CockroachEnumColumn<\n\tT extends ColumnBaseConfig<'string enum'> & { enumValues: [string, ...string[]] },\n> extends CockroachColumn<T, { enum: CockroachEnum<T['enumValues']> }> {\n\tstatic override readonly [entityKind]: string = 'CockroachEnumColumn';\n\n\treadonly enum = this.config.enum;\n\toverride readonly enumValues = this.config.enum.enumValues;\n\n\tconstructor(\n\t\ttable: CockroachTable<any>,\n\t\tconfig: CockroachEnumColumnBuilder<T['enumValues']>['config'],\n\t) {\n\t\tsuper(table, config);\n\t\tthis.enum = config.enum;\n\t}\n\n\tgetSQLType(): string {\n\t\treturn this.enum.enumName;\n\t}\n}\n\nexport function cockroachEnum<U extends string, T extends Readonly<[U, ...U[]]>>(\n\tenumName: string,\n\tvalues: T | Writable<T>,\n): CockroachEnum<Writable<T>>;\n\nexport function cockroachEnum<E extends Record<string, string>>(\n\tenumName: string,\n\tenumObj: NonArray<E>,\n): CockroachEnumObject<E>;\n\nexport function cockroachEnum(\n\tenumName: any,\n\tinput: any,\n): any {\n\treturn Array.isArray(input)\n\t\t? cockroachEnumWithSchema(enumName, [...input] as [string, ...string[]], undefined)\n\t\t: cockroachEnumObjectWithSchema(enumName, input, undefined);\n}\n\n/** @internal */\nexport function cockroachEnumWithSchema<U extends string, T extends Readonly<[U, ...U[]]>>(\n\tenumName: string,\n\tvalues: T | Writable<T>,\n\tschema?: string,\n): CockroachEnum<Writable<T>> {\n\tconst enumInstance: CockroachEnum<Writable<T>> = Object.assign(\n\t\t(name?: string): CockroachEnumColumnBuilder<Writable<T>> =>\n\t\t\tnew CockroachEnumColumnBuilder(name ?? '', enumInstance),\n\t\t{\n\t\t\tenumName,\n\t\t\tenumValues: values,\n\t\t\tschema,\n\t\t\t[isCockroachEnumSym]: true,\n\t\t} as const,\n\t);\n\n\treturn enumInstance;\n}\n\n/** @internal */\nexport function cockroachEnumObjectWithSchema<T extends object>(\n\tenumName: string,\n\tvalues: T,\n\tschema?: string,\n): CockroachEnumObject<T> {\n\tconst enumInstance: CockroachEnumObject<T> = Object.assign(\n\t\t(name?: string): CockroachEnumObjectColumnBuilder<T> =>\n\t\t\tnew CockroachEnumObjectColumnBuilder(name ?? '', enumInstance),\n\t\t{\n\t\t\tenumName,\n\t\t\tenumValues: Object.values(values),\n\t\t\tschema,\n\t\t\t[isCockroachEnumSym]: true,\n\t\t} as const,\n\t);\n\n\treturn enumInstance;\n}\n"],"mappings":";;;;;AAiBA,IAAa,mCAAb,cAA8EA,sEAQ5E;CACD,QAA0BC,0BAAsB;CAEhD,YAAY,MAAc,cAAwC;AACjE,QAAM,MAAM,eAAe,4BAA4B;AACvD,OAAK,OAAO,OAAO;;;CAIpB,AAAS,MACR,OACC;AACD,SAAO,IAAI,0BACV,OACA,KAAK,OACL;;;AAIH,IAAa,4BAAb,cAEUC,sDAA0D;CACnE,QAA0BD,0BAAsB;CAEhD,AAAS;CACT,AAAkB,aAAa,KAAK,OAAO,KAAK;CAEhD,YACC,OACA,QACC;AACD,QAAM,OAAO,OAAO;AACpB,OAAK,OAAO,OAAO;;CAGpB,aAAqB;AACpB,SAAO,KAAK,KAAK;;;AAKnB,MAAM,qBAAqB,OAAO,IAAI,0BAA0B;AAWhE,SAAgB,gBAAgB,KAA2D;AAC1F,QAAO,CAAC,CAAC,OAAO,OAAO,QAAQ,cAAc,sBAAsB,OAAO,IAAI,wBAAwB;;AAGvG,IAAa,6BAAb,cAAuFD,sEAKlD;CACpC,QAA0BC,0BAAsB;CAEhD,YAAY,MAAc,cAAsC;AAC/D,QAAM,MAAM,eAAe,sBAAsB;AACjD,OAAK,OAAO,OAAO;;;CAIpB,AAAS,MACR,OACC;AACD,SAAO,IAAI,oBACV,OACA,KAAK,OACL;;;AAIH,IAAa,sBAAb,cAEUC,sDAA6D;CACtE,QAA0BD,0BAAsB;CAEhD,AAAS,OAAO,KAAK,OAAO;CAC5B,AAAkB,aAAa,KAAK,OAAO,KAAK;CAEhD,YACC,OACA,QACC;AACD,QAAM,OAAO,OAAO;AACpB,OAAK,OAAO,OAAO;;CAGpB,aAAqB;AACpB,SAAO,KAAK,KAAK;;;AAcnB,SAAgB,cACf,UACA,OACM;AACN,QAAO,MAAM,QAAQ,MAAM,GACxB,wBAAwB,UAAU,CAAC,GAAG,MAAM,EAA2B,OAAU,GACjF,8BAA8B,UAAU,OAAO,OAAU;;;AAI7D,SAAgB,wBACf,UACA,QACA,QAC6B;CAC7B,MAAME,eAA2C,OAAO,QACtD,SACA,IAAI,2BAA2B,QAAQ,IAAI,aAAa,EACzD;EACC;EACA,YAAY;EACZ;GACC,qBAAqB;EACtB,CACD;AAED,QAAO;;;AAIR,SAAgB,8BACf,UACA,QACA,QACyB;CACzB,MAAMC,eAAuC,OAAO,QAClD,SACA,IAAI,iCAAiC,QAAQ,IAAI,aAAa,EAC/D;EACC;EACA,YAAY,OAAO,OAAO,OAAO;EACjC;GACC,qBAAqB;EACtB,CACD;AAED,QAAO"}