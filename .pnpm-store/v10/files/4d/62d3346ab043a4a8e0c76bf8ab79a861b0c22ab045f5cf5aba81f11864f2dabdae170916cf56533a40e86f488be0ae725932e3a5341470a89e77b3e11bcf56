{"version":3,"file":"enum.js","names":["enumInstance: PgEnum<Writable<T>>","enumInstance: PgEnumObject<T>"],"sources":["../../../src/pg-core/columns/enum.ts"],"sourcesContent":["import { entityKind } from '~/entity.ts';\nimport type { PgTable } from '~/pg-core/table.ts';\nimport type { NonArray, Writable } from '~/utils.ts';\nimport { PgColumn, PgColumnBuilder } from './common.ts';\n\n// Enum as ts enum\nexport interface PgEnumObject<TValues extends object> {\n\t(name?: string): PgEnumObjectColumnBuilder<TValues>;\n\n\treadonly enumName: string;\n\treadonly enumValues: string[];\n\treadonly schema: string | undefined;\n\t/** @internal */\n\t[isPgEnumSym]: true;\n}\n\nexport class PgEnumObjectColumnBuilder<\n\tTValues extends object,\n> extends PgColumnBuilder<{\n\tdataType: 'string enum';\n\tdata: TValues[keyof TValues];\n\tenumValues: string[];\n\tdriverParam: string;\n}, { enum: PgEnumObject<any> }> {\n\tstatic override readonly [entityKind]: string = 'PgEnumObjectColumnBuilder';\n\n\tconstructor(name: string, enumInstance: PgEnumObject<any>) {\n\t\tsuper(name, 'string enum', 'PgEnumObjectColumn');\n\t\tthis.config.enum = enumInstance;\n\t}\n\n\t/** @internal */\n\toverride build(table: PgTable<any>) {\n\t\treturn new PgEnumObjectColumn(\n\t\t\ttable,\n\t\t\tthis.config as any,\n\t\t);\n\t}\n}\n\nexport class PgEnumObjectColumn<TValues extends object> extends PgColumn<'string enum'> {\n\tstatic override readonly [entityKind]: string = 'PgEnumObjectColumn';\n\n\treadonly enum: PgEnumObject<TValues>;\n\toverride readonly enumValues: string[];\n\n\tconstructor(\n\t\ttable: PgTable<any>,\n\t\tconfig: PgEnumObjectColumnBuilder<TValues>['config'],\n\t) {\n\t\tsuper(table, config as any);\n\t\tthis.enum = config.enum as PgEnumObject<TValues>;\n\t\tthis.enumValues = config.enum.enumValues;\n\t}\n\n\tgetSQLType(): string {\n\t\treturn this.enum.enumName;\n\t}\n}\n\n// Enum as string union\n\nconst isPgEnumSym = Symbol.for('drizzle:isPgEnum');\nexport interface PgEnum<TValues extends [string, ...string[]]> {\n\t(name?: string): PgEnumColumnBuilder<TValues>;\n\n\treadonly enumName: string;\n\treadonly enumValues: TValues;\n\treadonly schema: string | undefined;\n\t/** @internal */\n\t[isPgEnumSym]: true;\n}\n\nexport function isPgEnum(obj: unknown): obj is PgEnum<[string, ...string[]]> {\n\treturn !!obj && typeof obj === 'function' && isPgEnumSym in obj && obj[isPgEnumSym] === true;\n}\n\nexport class PgEnumColumnBuilder<\n\tTValues extends [string, ...string[]],\n> extends PgColumnBuilder<{\n\tdataType: 'string enum';\n\tdata: TValues[number];\n\tenumValues: TValues;\n\tdriverParam: string;\n}, { enum: PgEnum<TValues> }> {\n\tstatic override readonly [entityKind]: string = 'PgEnumColumnBuilder';\n\n\tconstructor(name: string, enumInstance: PgEnum<TValues>) {\n\t\tsuper(name, 'string enum', 'PgEnumColumn');\n\t\tthis.config.enum = enumInstance;\n\t}\n\n\t/** @internal */\n\toverride build(table: PgTable<any>) {\n\t\treturn new PgEnumColumn(\n\t\t\ttable,\n\t\t\tthis.config as any,\n\t\t);\n\t}\n}\n\nexport class PgEnumColumn<TValues extends [string, ...string[]]> extends PgColumn<'string enum'> {\n\tstatic override readonly [entityKind]: string = 'PgEnumColumn';\n\n\treadonly enum: PgEnum<TValues>;\n\toverride readonly enumValues: TValues;\n\n\tconstructor(\n\t\ttable: PgTable<any>,\n\t\tconfig: PgEnumColumnBuilder<TValues>['config'],\n\t) {\n\t\tsuper(table, config as any);\n\t\tthis.enum = config.enum;\n\t\tthis.enumValues = config.enum.enumValues;\n\t}\n\n\tgetSQLType(): string {\n\t\treturn this.enum.enumName;\n\t}\n}\n\nexport function pgEnum<U extends string, T extends Readonly<[U, ...U[]]>>(\n\tenumName: string,\n\tvalues: T | Writable<T>,\n): PgEnum<Writable<T>>;\n\nexport function pgEnum<E extends Record<string, string>>(\n\tenumName: string,\n\tenumObj: NonArray<E>,\n): PgEnumObject<E>;\n\nexport function pgEnum(\n\tenumName: any,\n\tinput: any,\n): any {\n\treturn Array.isArray(input)\n\t\t? pgEnumWithSchema(enumName, [...input] as [string, ...string[]], undefined)\n\t\t: pgEnumObjectWithSchema(enumName, input, undefined);\n}\n\n/** @internal */\nexport function pgEnumWithSchema<U extends string, T extends Readonly<[U, ...U[]]>>(\n\tenumName: string,\n\tvalues: T | Writable<T>,\n\tschema?: string,\n): PgEnum<Writable<T>> {\n\tconst enumInstance: PgEnum<Writable<T>> = Object.assign(\n\t\t(name?: string): PgEnumColumnBuilder<Writable<T>> => new PgEnumColumnBuilder(name ?? '', enumInstance),\n\t\t{\n\t\t\tenumName,\n\t\t\tenumValues: values,\n\t\t\tschema,\n\t\t\t[isPgEnumSym]: true,\n\t\t} as const,\n\t);\n\n\treturn enumInstance;\n}\n\n/** @internal */\nexport function pgEnumObjectWithSchema<T extends object>(\n\tenumName: string,\n\tvalues: T,\n\tschema?: string,\n): PgEnumObject<T> {\n\tconst enumInstance: PgEnumObject<T> = Object.assign(\n\t\t(name?: string): PgEnumObjectColumnBuilder<T> => new PgEnumObjectColumnBuilder(name ?? '', enumInstance),\n\t\t{\n\t\t\tenumName,\n\t\t\tenumValues: Object.values(values),\n\t\t\tschema,\n\t\t\t[isPgEnumSym]: true,\n\t\t} as const,\n\t);\n\n\treturn enumInstance;\n}\n"],"mappings":";;;;AAgBA,IAAa,4BAAb,cAEU,gBAKsB;CAC/B,QAA0B,cAAsB;CAEhD,YAAY,MAAc,cAAiC;AAC1D,QAAM,MAAM,eAAe,qBAAqB;AAChD,OAAK,OAAO,OAAO;;;CAIpB,AAAS,MAAM,OAAqB;AACnC,SAAO,IAAI,mBACV,OACA,KAAK,OACL;;;AAIH,IAAa,qBAAb,cAAgE,SAAwB;CACvF,QAA0B,cAAsB;CAEhD,AAAS;CACT,AAAkB;CAElB,YACC,OACA,QACC;AACD,QAAM,OAAO,OAAc;AAC3B,OAAK,OAAO,OAAO;AACnB,OAAK,aAAa,OAAO,KAAK;;CAG/B,aAAqB;AACpB,SAAO,KAAK,KAAK;;;AAMnB,MAAM,cAAc,OAAO,IAAI,mBAAmB;AAWlD,SAAgB,SAAS,KAAoD;AAC5E,QAAO,CAAC,CAAC,OAAO,OAAO,QAAQ,cAAc,eAAe,OAAO,IAAI,iBAAiB;;AAGzF,IAAa,sBAAb,cAEU,gBAKoB;CAC7B,QAA0B,cAAsB;CAEhD,YAAY,MAAc,cAA+B;AACxD,QAAM,MAAM,eAAe,eAAe;AAC1C,OAAK,OAAO,OAAO;;;CAIpB,AAAS,MAAM,OAAqB;AACnC,SAAO,IAAI,aACV,OACA,KAAK,OACL;;;AAIH,IAAa,eAAb,cAAyE,SAAwB;CAChG,QAA0B,cAAsB;CAEhD,AAAS;CACT,AAAkB;CAElB,YACC,OACA,QACC;AACD,QAAM,OAAO,OAAc;AAC3B,OAAK,OAAO,OAAO;AACnB,OAAK,aAAa,OAAO,KAAK;;CAG/B,aAAqB;AACpB,SAAO,KAAK,KAAK;;;AAcnB,SAAgB,OACf,UACA,OACM;AACN,QAAO,MAAM,QAAQ,MAAM,GACxB,iBAAiB,UAAU,CAAC,GAAG,MAAM,EAA2B,OAAU,GAC1E,uBAAuB,UAAU,OAAO,OAAU;;;AAItD,SAAgB,iBACf,UACA,QACA,QACsB;CACtB,MAAMA,eAAoC,OAAO,QAC/C,SAAoD,IAAI,oBAAoB,QAAQ,IAAI,aAAa,EACtG;EACC;EACA,YAAY;EACZ;GACC,cAAc;EACf,CACD;AAED,QAAO;;;AAIR,SAAgB,uBACf,UACA,QACA,QACkB;CAClB,MAAMC,eAAgC,OAAO,QAC3C,SAAgD,IAAI,0BAA0B,QAAQ,IAAI,aAAa,EACxG;EACC;EACA,YAAY,OAAO,OAAO,OAAO;EACjC;GACC,cAAc;EACf,CACD;AAED,QAAO"}