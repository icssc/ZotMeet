{"version":3,"file":"unique-constraint.js","names":["name?: string","table: GelTable"],"sources":["../../src/gel-core/unique-constraint.ts"],"sourcesContent":["import { entityKind } from '~/entity.ts';\nimport { TableName } from '~/table.utils.ts';\nimport type { GelColumn } from './columns/index.ts';\nimport type { GelTable } from './table.ts';\n\nexport function unique(name?: string): UniqueOnConstraintBuilder {\n\treturn new UniqueOnConstraintBuilder(name);\n}\n\nexport function uniqueKeyName(table: GelTable, columns: string[]) {\n\treturn `${table[TableName]}_${columns.join('_')}_unique`;\n}\n\nexport class UniqueConstraintBuilder {\n\tstatic readonly [entityKind]: string = 'GelUniqueConstraintBuilder';\n\n\t/** @internal */\n\tcolumns: GelColumn[];\n\t/** @internal */\n\tnullsNotDistinctConfig = false;\n\n\tconstructor(\n\t\tcolumns: GelColumn[],\n\t\tprivate name?: string,\n\t) {\n\t\tthis.columns = columns;\n\t}\n\n\tnullsNotDistinct() {\n\t\tthis.nullsNotDistinctConfig = true;\n\t\treturn this;\n\t}\n\n\t/** @internal */\n\tbuild(table: GelTable): UniqueConstraint {\n\t\treturn new UniqueConstraint(table, this.columns, this.nullsNotDistinctConfig, this.name);\n\t}\n}\n\nexport class UniqueOnConstraintBuilder {\n\tstatic readonly [entityKind]: string = 'GelUniqueOnConstraintBuilder';\n\n\t/** @internal */\n\tname?: string;\n\n\tconstructor(\n\t\tname?: string,\n\t) {\n\t\tthis.name = name;\n\t}\n\n\ton(...columns: [GelColumn, ...GelColumn[]]) {\n\t\treturn new UniqueConstraintBuilder(columns, this.name);\n\t}\n}\n\nexport class UniqueConstraint {\n\tstatic readonly [entityKind]: string = 'GelUniqueConstraint';\n\n\treadonly columns: GelColumn[];\n\treadonly name?: string;\n\treadonly nullsNotDistinct: boolean = false;\n\n\tconstructor(readonly table: GelTable, columns: GelColumn[], nullsNotDistinct: boolean, name?: string) {\n\t\tthis.columns = columns;\n\t\tthis.name = name ?? uniqueKeyName(this.table, this.columns.map((column) => column.name));\n\t\tthis.nullsNotDistinct = nullsNotDistinct;\n\t}\n\n\tgetName() {\n\t\treturn this.name;\n\t}\n}\n"],"mappings":";;;;AAKA,SAAgB,OAAO,MAA0C;AAChE,QAAO,IAAI,0BAA0B,KAAK;;AAG3C,SAAgB,cAAc,OAAiB,SAAmB;AACjE,QAAO,GAAG,MAAM,WAAW,GAAG,QAAQ,KAAK,IAAI,CAAC;;AAGjD,IAAa,0BAAb,MAAqC;CACpC,QAAiB,cAAsB;;CAGvC;;CAEA,yBAAyB;CAEzB,YACC,SACA,AAAQA,MACP;EADO;AAER,OAAK,UAAU;;CAGhB,mBAAmB;AAClB,OAAK,yBAAyB;AAC9B,SAAO;;;CAIR,MAAM,OAAmC;AACxC,SAAO,IAAI,iBAAiB,OAAO,KAAK,SAAS,KAAK,wBAAwB,KAAK,KAAK;;;AAI1F,IAAa,4BAAb,MAAuC;CACtC,QAAiB,cAAsB;;CAGvC;CAEA,YACC,MACC;AACD,OAAK,OAAO;;CAGb,GAAG,GAAG,SAAsC;AAC3C,SAAO,IAAI,wBAAwB,SAAS,KAAK,KAAK;;;AAIxD,IAAa,mBAAb,MAA8B;CAC7B,QAAiB,cAAsB;CAEvC,AAAS;CACT,AAAS;CACT,AAAS,mBAA4B;CAErC,YAAY,AAASC,OAAiB,SAAsB,kBAA2B,MAAe;EAAjF;AACpB,OAAK,UAAU;AACf,OAAK,OAAO,QAAQ,cAAc,KAAK,OAAO,KAAK,QAAQ,KAAK,WAAW,OAAO,KAAK,CAAC;AACxF,OAAK,mBAAmB;;CAGzB,UAAU;AACT,SAAO,KAAK"}