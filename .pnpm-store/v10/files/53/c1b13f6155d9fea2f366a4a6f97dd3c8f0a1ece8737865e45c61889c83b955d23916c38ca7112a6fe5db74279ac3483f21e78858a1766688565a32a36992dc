{"version":3,"sources":["../../../src/server/config.ts"],"sourcesContent":["import { existsSync } from 'fs'\nimport { basename, extname, join, relative, isAbsolute, resolve } from 'path'\nimport { pathToFileURL } from 'url'\nimport findUp from 'next/dist/compiled/find-up'\nimport * as Log from '../build/output/log'\nimport * as ciEnvironment from '../server/ci-info'\nimport {\n  CONFIG_FILES,\n  PHASE_DEVELOPMENT_SERVER,\n  PHASE_EXPORT,\n  PHASE_PRODUCTION_BUILD,\n  type PHASE_PRODUCTION_SERVER,\n  type PHASE_TYPE,\n} from '../shared/lib/constants'\nimport { defaultConfig, normalizeConfig } from './config-shared'\nimport type {\n  ExperimentalConfig,\n  NextConfigComplete,\n  NextConfig,\n  NextConfigRuntime,\n} from './config-shared'\n\nimport { loadWebpackHook } from './config-utils'\nimport { imageConfigDefault } from '../shared/lib/image-config'\nimport type { ImageConfig } from '../shared/lib/image-config'\nimport { loadEnvConfig, updateInitialEnv } from '@next/env'\nimport { flushTelemetry } from '../telemetry/flush-telemetry'\nimport {\n  findRootDirAndLockFiles,\n  warnDuplicatedLockFiles,\n} from '../lib/find-root'\nimport { setHttpClientAndAgentOptions } from './setup-http-agent-env'\nimport { pathHasPrefix } from '../shared/lib/router/utils/path-has-prefix'\nimport { matchRemotePattern } from '../shared/lib/match-remote-pattern'\n\nimport type { ZodError } from 'next/dist/compiled/zod'\nimport { hasNextSupport } from '../server/ci-info'\nimport { transpileConfig } from '../build/next-config-ts/transpile-config'\nimport { dset } from '../shared/lib/dset'\nimport { normalizeZodErrors } from '../shared/lib/zod'\nimport { HTML_LIMITED_BOT_UA_RE_STRING } from '../shared/lib/router/utils/is-bot'\nimport { findDir } from '../lib/find-pages-dir'\nimport { interopDefault } from '../lib/interop-default'\nimport { djb2Hash } from '../shared/lib/hash'\nimport type { NextAdapter } from '../build/adapter/build-complete'\nimport { HardDeprecatedConfigError } from '../shared/lib/errors/hard-deprecated-config-error'\nimport { NextInstanceErrorState } from './mcp/tools/next-instance-error-state'\n\nexport { normalizeConfig } from './config-shared'\nexport type { DomainLocale, NextConfig } from './config-shared'\n\nfunction normalizeNextConfigZodErrors(\n  error: ZodError<NextConfig>\n): [warnings: string[], fatalErrors: string[]] {\n  const warnings: string[] = []\n  const fatalErrors: string[] = []\n  const issues = normalizeZodErrors(error)\n\n  for (const { issue, message: originalMessage } of issues) {\n    let message = originalMessage\n    let shouldExit = false\n\n    if (issue.path[0] === 'images') {\n      // We exit the build when encountering an error in the images config\n      shouldExit = true\n    }\n    if (\n      issue.code === 'unrecognized_keys' &&\n      issue.path[0] === 'experimental'\n    ) {\n      if (message.includes('turbopackPersistentCachingForBuild')) {\n        // We exit the build when encountering an error in the turbopackPersistentCaching config\n        shouldExit = true\n        message +=\n          \"\\nUse 'experimental.turbopackFileSystemCacheForBuild' instead.\"\n        message +=\n          '\\nLearn more: https://nextjs.org/docs/app/api-reference/config/next-config-js/turbopackFileSystemCache'\n      } else if (message.includes('turbopackPersistentCaching')) {\n        // We exit the build when encountering an error in the turbopackPersistentCaching config\n        shouldExit = true\n        message +=\n          \"\\nUse 'experimental.turbopackFileSystemCacheForDev' instead.\"\n        message +=\n          '\\nLearn more: https://nextjs.org/docs/app/api-reference/config/next-config-js/turbopackFileSystemCache'\n      }\n    }\n\n    if (shouldExit) {\n      fatalErrors.push(message)\n    } else {\n      warnings.push(message)\n    }\n  }\n\n  return [warnings, fatalErrors]\n}\n\nexport function warnOptionHasBeenDeprecated(\n  config: NextConfig,\n  nestedPropertyKey: string,\n  reason: string,\n  silent: boolean\n): boolean {\n  let hasWarned = false\n  if (!silent) {\n    let current = config\n    let found = true\n    const nestedPropertyKeys = nestedPropertyKey.split('.')\n    for (const key of nestedPropertyKeys) {\n      if ((current as any)[key] !== undefined) {\n        current = (current as any)[key]\n      } else {\n        found = false\n        break\n      }\n    }\n    if (found) {\n      Log.warnOnce(reason)\n      hasWarned = true\n    }\n  }\n  return hasWarned\n}\n\nfunction checkDeprecations(\n  userConfig: NextConfig,\n  configFileName: string,\n  silent: boolean,\n  dir: string\n) {\n  warnOptionHasBeenDeprecated(\n    userConfig,\n    'experimental.middlewarePrefetch',\n    `\\`experimental.middlewarePrefetch\\` is deprecated. Please use \\`experimental.proxyPrefetch\\` instead in ${configFileName}.`,\n    silent\n  )\n  warnOptionHasBeenDeprecated(\n    userConfig,\n    'experimental.middlewareClientMaxBodySize',\n    `\\`experimental.middlewareClientMaxBodySize\\` is deprecated. Please use \\`experimental.proxyClientMaxBodySize\\` instead in ${configFileName}.`,\n    silent\n  )\n  warnOptionHasBeenDeprecated(\n    userConfig,\n    'experimental.externalMiddlewareRewritesResolve',\n    `\\`experimental.externalMiddlewareRewritesResolve\\` is deprecated. Please use \\`experimental.externalProxyRewritesResolve\\` instead in ${configFileName}.`,\n    silent\n  )\n  warnOptionHasBeenDeprecated(\n    userConfig,\n    'skipMiddlewareUrlNormalize',\n    `\\`skipMiddlewareUrlNormalize\\` is deprecated. Please use \\`skipProxyUrlNormalize\\` instead in ${configFileName}.`,\n    silent\n  )\n\n  warnOptionHasBeenDeprecated(\n    userConfig,\n    'experimental.instrumentationHook',\n    `\\`experimental.instrumentationHook\\` is no longer needed, because \\`instrumentation.js\\` is available by default. You can remove it from ${configFileName}.`,\n    silent\n  )\n\n  warnOptionHasBeenDeprecated(\n    userConfig,\n    'experimental.after',\n    `\\`experimental.after\\` is no longer needed, because \\`after\\` is available by default. You can remove it from ${configFileName}.`,\n    silent\n  )\n\n  warnOptionHasBeenDeprecated(\n    userConfig,\n    'eslint',\n    `\\`eslint\\` configuration in ${configFileName} is no longer supported. See more info here: https://nextjs.org/docs/app/api-reference/cli/next#next-lint-options`,\n    silent\n  )\n\n  if (userConfig.images?.domains?.length) {\n    warnOptionHasBeenDeprecated(\n      userConfig,\n      'images.domains',\n      `\\`images.domains\\` is deprecated in favor of \\`images.remotePatterns\\`. Please update ${configFileName} to protect your application from malicious users.`,\n      silent\n    )\n  }\n\n  // i18n deprecation for App Router\n  if (userConfig.i18n) {\n    const hasAppDir = Boolean(findDir(dir, 'app'))\n    if (hasAppDir) {\n      warnOptionHasBeenDeprecated(\n        userConfig,\n        'i18n',\n        `i18n configuration in ${configFileName} is unsupported in App Router.\\nLearn more about internationalization in App Router: https://nextjs.org/docs/app/building-your-application/routing/internationalization`,\n        silent\n      )\n    }\n  }\n}\n\nexport function warnOptionHasBeenMovedOutOfExperimental(\n  config: NextConfig,\n  oldExperimentalKey: string,\n  newKey: string,\n  configFileName: string,\n  silent: boolean\n) {\n  if (config.experimental && oldExperimentalKey in config.experimental) {\n    if (!silent) {\n      Log.warn(\n        `\\`experimental.${oldExperimentalKey}\\` has been moved to \\`${newKey}\\`. ` +\n          `Please update your ${configFileName} file accordingly.`\n      )\n    }\n\n    let current = config\n    const newKeys = newKey.split('.')\n    while (newKeys.length > 1) {\n      const key = newKeys.shift()!\n      ;(current as any)[key] = (current as any)[key] || {}\n      current = (current as any)[key]\n    }\n    ;(current as any)[newKeys.shift()!] = (config.experimental as any)[\n      oldExperimentalKey\n    ]\n  }\n\n  return config\n}\n\nfunction warnCustomizedOption(\n  config: NextConfig,\n  key: string,\n  defaultValue: any,\n  customMessage: string,\n  configFileName: string,\n  silent: boolean\n) {\n  const segs = key.split('.')\n  let current = config\n\n  while (segs.length >= 1) {\n    const seg = segs.shift()!\n    if (!(seg in current)) {\n      return\n    }\n    current = (current as any)[seg]\n  }\n\n  if (!silent && current !== defaultValue) {\n    Log.warn(\n      `The \"${key}\" option has been modified. ${customMessage ? customMessage + '. ' : ''}It should be removed from your ${configFileName}.`\n    )\n  }\n}\n\n/**\n * Assigns defaults to the user config and validates the config.\n *\n * @param dir - The directory of the project.\n * @param userConfig - The user config.\n * @param silent - Whether to suppress warnings.\n * @returns The complete config.\n */\nfunction assignDefaultsAndValidate(\n  dir: string,\n  userConfig: NextConfig & { configFileName: string },\n  silent: boolean,\n  phase: PHASE_TYPE\n): NextConfigComplete {\n  const configFileName = userConfig.configFileName\n  if (typeof (userConfig as any).exportTrailingSlash !== 'undefined') {\n    if (!silent) {\n      Log.warn(\n        `The \"exportTrailingSlash\" option has been renamed to \"trailingSlash\". Please update your ${configFileName}.`\n      )\n    }\n    if (typeof userConfig.trailingSlash === 'undefined') {\n      userConfig.trailingSlash = (userConfig as any).exportTrailingSlash\n    }\n    delete (userConfig as any).exportTrailingSlash\n  }\n\n  const config = Object.keys(userConfig).reduce<{ [key: string]: any }>(\n    (currentConfig, key) => {\n      const value = (userConfig as any)[key]\n\n      if (value === undefined || value === null) {\n        return currentConfig\n      }\n\n      if (key === 'distDir') {\n        if (typeof value !== 'string') {\n          throw new Error(\n            `Specified distDir is not a string, found type \"${typeof value}\"`\n          )\n        }\n        const userDistDir = value.trim()\n\n        // don't allow public as the distDir as this is a reserved folder for\n        // public files\n        if (userDistDir === 'public') {\n          throw new Error(\n            `The 'public' directory is reserved in Next.js and can not be set as the 'distDir'. https://nextjs.org/docs/messages/can-not-output-to-public`\n          )\n        }\n        // make sure distDir isn't an empty string as it can result in the provided\n        // directory being deleted in development mode\n        if (userDistDir.length === 0) {\n          throw new Error(\n            `Invalid distDir provided, distDir can not be an empty string. Please remove this config or set it to undefined`\n          )\n        }\n      }\n\n      if (key === 'pageExtensions') {\n        if (!Array.isArray(value)) {\n          throw new Error(\n            `Specified pageExtensions is not an array of strings, found \"${value}\". Please update this config or remove it.`\n          )\n        }\n\n        if (!value.length) {\n          throw new Error(\n            `Specified pageExtensions is an empty array. Please update it with the relevant extensions or remove it.`\n          )\n        }\n\n        value.forEach((ext) => {\n          if (typeof ext !== 'string') {\n            throw new Error(\n              `Specified pageExtensions is not an array of strings, found \"${ext}\" of type \"${typeof ext}\". Please update this config or remove it.`\n            )\n          }\n        })\n      }\n\n      const defaultValue = (defaultConfig as Record<string, unknown>)[key]\n\n      if (\n        !!value &&\n        value.constructor === Object &&\n        typeof defaultValue === 'object'\n      ) {\n        currentConfig[key] = {\n          ...defaultValue,\n          ...Object.keys(value).reduce<any>((c, k) => {\n            const v = value[k]\n            if (v !== undefined && v !== null) {\n              c[k] = v\n            }\n            return c\n          }, {}),\n        }\n      } else {\n        currentConfig[key] = value\n      }\n\n      return currentConfig\n    },\n    {}\n  ) as NextConfig & { configFileName: string }\n\n  const result = {\n    ...defaultConfig,\n    ...config,\n    experimental: {\n      ...defaultConfig.experimental,\n      ...config.experimental,\n    },\n  }\n\n  // ensure correct default is set for api-resolver revalidate handling\n  if (!result.experimental.trustHostHeader && ciEnvironment.hasNextSupport) {\n    result.experimental.trustHostHeader = true\n  }\n\n  if (\n    result.experimental?.allowDevelopmentBuild &&\n    process.env.NODE_ENV !== 'development'\n  ) {\n    throw new Error(\n      `The experimental.allowDevelopmentBuild option requires NODE_ENV to be explicitly set to 'development'.`\n    )\n  }\n\n  // Validate sassOptions.functions is not used with Turbopack\n  if (\n    process.env.TURBOPACK &&\n    result.sassOptions &&\n    'functions' in result.sassOptions\n  ) {\n    throw new Error(\n      `The \"sassOptions.functions\" option is not supported when using Turbopack. ` +\n        `Custom Sass functions are only available with webpack. ` +\n        `Please remove the \"functions\" property from your sassOptions in ${configFileName}.`\n    )\n  }\n\n  if (result.experimental.ppr) {\n    throw new HardDeprecatedConfigError(\n      `\\`experimental.ppr\\` has been merged into \\`cacheComponents\\`. The Partial Prerendering feature is still available, but is now enabled via \\`cacheComponents\\`. Please update your ${configFileName} accordingly.`\n    )\n  }\n\n  if (result.output === 'export') {\n    if (result.i18n) {\n      throw new Error(\n        'Specified \"i18n\" cannot be used with \"output: export\". See more info here: https://nextjs.org/docs/messages/export-no-i18n'\n      )\n    }\n\n    if (!hasNextSupport) {\n      if (result.rewrites) {\n        Log.warn(\n          'Specified \"rewrites\" will not automatically work with \"output: export\". See more info here: https://nextjs.org/docs/messages/export-no-custom-routes'\n        )\n      }\n      if (result.redirects) {\n        Log.warn(\n          'Specified \"redirects\" will not automatically work with \"output: export\". See more info here: https://nextjs.org/docs/messages/export-no-custom-routes'\n        )\n      }\n      if (result.headers) {\n        Log.warn(\n          'Specified \"headers\" will not automatically work with \"output: export\". See more info here: https://nextjs.org/docs/messages/export-no-custom-routes'\n        )\n      }\n    }\n  }\n\n  if (typeof result.assetPrefix !== 'string') {\n    throw new Error(\n      `Specified assetPrefix is not a string, found type \"${typeof result.assetPrefix}\" https://nextjs.org/docs/messages/invalid-assetprefix`\n    )\n  }\n\n  if (typeof result.basePath !== 'string') {\n    throw new Error(\n      `Specified basePath is not a string, found type \"${typeof result.basePath}\"`\n    )\n  }\n\n  if (result.basePath !== '') {\n    if (result.basePath === '/') {\n      throw new Error(\n        `Specified basePath /. basePath has to be either an empty string or a path prefix\"`\n      )\n    }\n\n    if (!result.basePath.startsWith('/')) {\n      throw new Error(\n        `Specified basePath has to start with a /, found \"${result.basePath}\"`\n      )\n    }\n\n    if (result.basePath !== '/') {\n      if (result.basePath.endsWith('/')) {\n        throw new Error(\n          `Specified basePath should not end with /, found \"${result.basePath}\"`\n        )\n      }\n\n      if (result.assetPrefix === '') {\n        result.assetPrefix = result.basePath\n      }\n    }\n  }\n\n  if (result?.images) {\n    const images: ImageConfig = result.images\n\n    if (typeof images !== 'object') {\n      throw new Error(\n        `Specified images should be an object received ${typeof images}.\\nSee more info here: https://nextjs.org/docs/messages/invalid-images-config`\n      )\n    }\n\n    if (images.localPatterns) {\n      if (!Array.isArray(images.localPatterns)) {\n        throw new Error(\n          `Specified images.localPatterns should be an Array received ${typeof images.localPatterns}.\\nSee more info here: https://nextjs.org/docs/messages/invalid-images-config`\n        )\n      }\n      // avoid double-pushing the same pattern if it already exists\n      const hasMatch = images.localPatterns.some(\n        (pattern) =>\n          pattern.pathname === '/_next/static/media/**' && pattern.search === ''\n      )\n      if (!hasMatch) {\n        // static import images are automatically allowed\n        images.localPatterns.push({\n          pathname: '/_next/static/media/**',\n          search: '',\n        })\n      }\n    } else {\n      // All paths are not allowed for a search query by default.\n      images.localPatterns = [\n        {\n          pathname: '**',\n          search: '',\n        },\n      ]\n    }\n\n    if (images.remotePatterns) {\n      if (!Array.isArray(images.remotePatterns)) {\n        throw new Error(\n          `Specified images.remotePatterns should be an Array received ${typeof images.remotePatterns}.\\nSee more info here: https://nextjs.org/docs/messages/invalid-images-config`\n        )\n      }\n\n      // We must convert URL to RemotePattern since URL has a colon in the protocol\n      // and also has additional properties we want to filter out. Also, new URL()\n      // accepts any protocol so we need manual validation here.\n      images.remotePatterns = images.remotePatterns.map(\n        ({ protocol, hostname, port, pathname, search }) => {\n          const proto = protocol?.replace(/:$/, '')\n          if (!['http', 'https', undefined].includes(proto)) {\n            throw new Error(\n              `Specified images.remotePatterns must have protocol \"http\" or \"https\" received \"${proto}\".`\n            )\n          }\n          return {\n            protocol: proto as 'http' | 'https' | undefined,\n            hostname,\n            port,\n            pathname,\n            search,\n          }\n        }\n      )\n\n      // static images are automatically prefixed with assetPrefix\n      // so we need to ensure _next/image allows downloading from\n      // this resource\n      if (config.assetPrefix?.startsWith('http')) {\n        try {\n          const url = new URL(config.assetPrefix)\n          const hasMatchForAssetPrefix = images.remotePatterns.some((pattern) =>\n            matchRemotePattern(pattern, url)\n          )\n\n          // avoid double-pushing the same pattern if it already can be matched\n          if (!hasMatchForAssetPrefix) {\n            images.remotePatterns.push({\n              hostname: url.hostname,\n              protocol: url.protocol.replace(/:$/, '') as 'http' | 'https',\n              port: url.port,\n            })\n          }\n        } catch (error) {\n          throw new Error(\n            `Invalid assetPrefix provided. Original error: ${error}`\n          )\n        }\n      }\n    }\n\n    if (images.domains) {\n      if (!Array.isArray(images.domains)) {\n        throw new Error(\n          `Specified images.domains should be an Array received ${typeof images.domains}.\\nSee more info here: https://nextjs.org/docs/messages/invalid-images-config`\n        )\n      }\n    }\n\n    if (!images.loader) {\n      images.loader = 'default'\n    }\n\n    if (\n      images.loader !== 'default' &&\n      images.loader !== 'custom' &&\n      images.path === imageConfigDefault.path\n    ) {\n      throw new Error(\n        `Specified images.loader property (${images.loader}) also requires images.path property to be assigned to a URL prefix.\\nSee more info here: https://nextjs.org/docs/api-reference/next/legacy/image#loader-configuration`\n      )\n    }\n\n    if (\n      images.path === imageConfigDefault.path &&\n      result.basePath &&\n      !pathHasPrefix(images.path, result.basePath)\n    ) {\n      images.path = `${result.basePath}${images.path}`\n    }\n\n    // Append trailing slash for non-default loaders and when trailingSlash is set\n    if (\n      images.path &&\n      !images.path.endsWith('/') &&\n      (images.loader !== 'default' || result.trailingSlash)\n    ) {\n      images.path += '/'\n    }\n\n    if (images.loaderFile) {\n      if (images.loader !== 'default' && images.loader !== 'custom') {\n        throw new Error(\n          `Specified images.loader property (${images.loader}) cannot be used with images.loaderFile property. Please set images.loader to \"custom\".`\n        )\n      }\n      const absolutePath = join(dir, images.loaderFile)\n      if (!existsSync(absolutePath)) {\n        throw new Error(\n          `Specified images.loaderFile does not exist at \"${absolutePath}\".`\n        )\n      }\n      images.loaderFile = absolutePath\n    }\n  }\n\n  warnCustomizedOption(\n    result,\n    'experimental.esmExternals',\n    true,\n    'experimental.esmExternals is not recommended to be modified as it may disrupt module resolution',\n    configFileName,\n    silent\n  )\n\n  warnOptionHasBeenMovedOutOfExperimental(\n    result,\n    'bundlePagesExternals',\n    'bundlePagesRouterDependencies',\n    configFileName,\n    silent\n  )\n  warnOptionHasBeenMovedOutOfExperimental(\n    result,\n    'serverComponentsExternalPackages',\n    'serverExternalPackages',\n    configFileName,\n    silent\n  )\n  warnOptionHasBeenMovedOutOfExperimental(\n    result,\n    'relay',\n    'compiler.relay',\n    configFileName,\n    silent\n  )\n  warnOptionHasBeenMovedOutOfExperimental(\n    result,\n    'styledComponents',\n    'compiler.styledComponents',\n    configFileName,\n    silent\n  )\n  warnOptionHasBeenMovedOutOfExperimental(\n    result,\n    'emotion',\n    'compiler.emotion',\n    configFileName,\n    silent\n  )\n  warnOptionHasBeenMovedOutOfExperimental(\n    result,\n    'reactRemoveProperties',\n    'compiler.reactRemoveProperties',\n    configFileName,\n    silent\n  )\n  warnOptionHasBeenMovedOutOfExperimental(\n    result,\n    'removeConsole',\n    'compiler.removeConsole',\n    configFileName,\n    silent\n  )\n  warnOptionHasBeenMovedOutOfExperimental(\n    result,\n    'swrDelta',\n    'expireTime',\n    configFileName,\n    silent\n  )\n  warnOptionHasBeenMovedOutOfExperimental(\n    result,\n    'typedRoutes',\n    'typedRoutes',\n    configFileName,\n    silent\n  )\n  warnOptionHasBeenMovedOutOfExperimental(\n    result,\n    'outputFileTracingRoot',\n    'outputFileTracingRoot',\n    configFileName,\n    silent\n  )\n  warnOptionHasBeenMovedOutOfExperimental(\n    result,\n    'outputFileTracingIncludes',\n    'outputFileTracingIncludes',\n    configFileName,\n    silent\n  )\n  warnOptionHasBeenMovedOutOfExperimental(\n    result,\n    'outputFileTracingExcludes',\n    'outputFileTracingExcludes',\n    configFileName,\n    silent\n  )\n  warnOptionHasBeenMovedOutOfExperimental(\n    result,\n    'reactCompiler',\n    'reactCompiler',\n    configFileName,\n    silent\n  )\n  warnOptionHasBeenMovedOutOfExperimental(\n    result,\n    'enablePrerenderSourceMaps',\n    'enablePrerenderSourceMaps',\n    configFileName,\n    silent\n  )\n  warnOptionHasBeenMovedOutOfExperimental(\n    result,\n    'cacheComponents',\n    'cacheComponents',\n    configFileName,\n    silent\n  )\n  warnOptionHasBeenMovedOutOfExperimental(\n    result,\n    'cacheLife',\n    'cacheLife',\n    configFileName,\n    silent\n  )\n  warnOptionHasBeenMovedOutOfExperimental(\n    result,\n    'cacheHandlers',\n    'cacheHandlers',\n    configFileName,\n    silent\n  )\n\n  if ((result.experimental as any).outputStandalone) {\n    if (!silent) {\n      Log.warn(\n        `experimental.outputStandalone has been renamed to \"output: 'standalone'\", please move the config.`\n      )\n    }\n    result.output = 'standalone'\n  }\n\n  if (\n    typeof result.experimental?.serverActions?.bodySizeLimit !== 'undefined'\n  ) {\n    const value = parseInt(\n      result.experimental.serverActions?.bodySizeLimit.toString()\n    )\n    if (isNaN(value) || value < 1) {\n      throw new Error(\n        'Server Actions Size Limit must be a valid number or filesize format larger than 1MB: https://nextjs.org/docs/app/api-reference/next-config-js/serverActions#bodysizelimit'\n      )\n    }\n  }\n\n  // Throw if both Middleware and Proxy config are set.\n  if (\n    userConfig.experimental?.proxyClientMaxBodySize !== undefined &&\n    userConfig.experimental?.middlewareClientMaxBodySize !== undefined\n  ) {\n    throw new Error(\n      'Config options `experimental.proxyClientMaxBodySize` and `experimental.middlewareClientMaxBodySize` cannot be set at the same time. Please use `experimental.proxyClientMaxBodySize` instead.'\n    )\n  }\n  if (\n    userConfig.experimental?.proxyPrefetch !== undefined &&\n    userConfig.experimental?.middlewarePrefetch !== undefined\n  ) {\n    throw new Error(\n      'Config options `experimental.proxyPrefetch` and `experimental.middlewarePrefetch` cannot be set at the same time. Please use `experimental.proxyPrefetch` instead.'\n    )\n  }\n  if (\n    userConfig.experimental?.externalProxyRewritesResolve !== undefined &&\n    userConfig.experimental?.externalMiddlewareRewritesResolve !== undefined\n  ) {\n    throw new Error(\n      'Config options `experimental.externalProxyRewritesResolve` and `experimental.externalMiddlewareRewritesResolve` cannot be set at the same time. Please use `experimental.externalProxyRewritesResolve` instead.'\n    )\n  }\n  if (\n    userConfig.skipProxyUrlNormalize !== undefined &&\n    userConfig.skipMiddlewareUrlNormalize !== undefined\n  ) {\n    throw new Error(\n      'Config options `skipProxyUrlNormalize` and `skipMiddlewareUrlNormalize` cannot be set at the same time. Please use `skipProxyUrlNormalize` instead.'\n    )\n  }\n\n  // Map Proxy config to Middleware config as it is currently an alias.\n  if (\n    userConfig.experimental?.proxyClientMaxBodySize === undefined &&\n    userConfig.experimental?.middlewareClientMaxBodySize !== undefined\n  ) {\n    result.experimental.proxyClientMaxBodySize =\n      userConfig.experimental.middlewareClientMaxBodySize\n  }\n  if (\n    userConfig.experimental?.proxyPrefetch === undefined &&\n    userConfig.experimental?.middlewarePrefetch !== undefined\n  ) {\n    result.experimental.proxyPrefetch =\n      userConfig.experimental.middlewarePrefetch\n  }\n  if (\n    userConfig.experimental?.externalProxyRewritesResolve === undefined &&\n    userConfig.experimental?.externalMiddlewareRewritesResolve !== undefined\n  ) {\n    result.experimental.externalProxyRewritesResolve =\n      userConfig.experimental.externalMiddlewareRewritesResolve\n  }\n  if (\n    userConfig.skipProxyUrlNormalize === undefined &&\n    userConfig.skipMiddlewareUrlNormalize !== undefined\n  ) {\n    result.skipProxyUrlNormalize = userConfig.skipMiddlewareUrlNormalize\n  }\n  // Inverse case: when new name is set but not the old name, copy the value to the old name\n  // to avoid breaking change on resolved config object written to `.next/`\n  if (\n    userConfig.experimental?.proxyPrefetch !== undefined &&\n    userConfig.experimental?.middlewarePrefetch === undefined\n  ) {\n    result.experimental.middlewarePrefetch =\n      userConfig.experimental.proxyPrefetch\n  }\n  if (\n    userConfig.experimental?.externalProxyRewritesResolve !== undefined &&\n    userConfig.experimental?.externalMiddlewareRewritesResolve === undefined\n  ) {\n    result.experimental.externalMiddlewareRewritesResolve =\n      userConfig.experimental.externalProxyRewritesResolve\n  }\n  if (\n    userConfig.skipProxyUrlNormalize !== undefined &&\n    userConfig.skipMiddlewareUrlNormalize === undefined\n  ) {\n    result.skipMiddlewareUrlNormalize = userConfig.skipProxyUrlNormalize\n  }\n\n  // Normalize & validate experimental.proxyClientMaxBodySize\n  if (typeof result.experimental?.proxyClientMaxBodySize !== 'undefined') {\n    const proxyClientMaxBodySize = result.experimental.proxyClientMaxBodySize\n    let normalizedValue: number\n\n    if (typeof proxyClientMaxBodySize === 'string') {\n      const bytes =\n        require('next/dist/compiled/bytes') as typeof import('next/dist/compiled/bytes')\n      normalizedValue = bytes.parse(proxyClientMaxBodySize)\n    } else if (typeof proxyClientMaxBodySize === 'number') {\n      normalizedValue = proxyClientMaxBodySize\n    } else {\n      throw new Error(\n        'Client Max Body Size must be a valid number (bytes) or filesize format string (e.g., \"5mb\")'\n      )\n    }\n\n    if (isNaN(normalizedValue) || normalizedValue < 1) {\n      throw new Error('Client Max Body Size must be larger than 0 bytes')\n    }\n\n    // Store the normalized value as a number\n    result.experimental.proxyClientMaxBodySize = normalizedValue\n  }\n\n  warnOptionHasBeenMovedOutOfExperimental(\n    result,\n    'transpilePackages',\n    'transpilePackages',\n    configFileName,\n    silent\n  )\n  warnOptionHasBeenMovedOutOfExperimental(\n    result,\n    'skipMiddlewareUrlNormalize',\n    'skipMiddlewareUrlNormalize',\n    configFileName,\n    silent\n  )\n  warnOptionHasBeenMovedOutOfExperimental(\n    result,\n    'skipTrailingSlashRedirect',\n    'skipTrailingSlashRedirect',\n    configFileName,\n    silent\n  )\n\n  if (\n    result?.outputFileTracingRoot &&\n    !isAbsolute(result.outputFileTracingRoot)\n  ) {\n    result.outputFileTracingRoot = resolve(result.outputFileTracingRoot)\n    if (!silent) {\n      Log.warn(\n        `outputFileTracingRoot should be absolute, using: ${result.outputFileTracingRoot}`\n      )\n    }\n  }\n\n  if (result?.turbopack?.root && !isAbsolute(result.turbopack.root)) {\n    result.turbopack.root = resolve(result.turbopack.root)\n    if (!silent) {\n      Log.warn(\n        `turbopack.root should be absolute, using: ${result.turbopack.root}`\n      )\n    }\n  }\n\n  if (\n    result.experimental.runtimeServerDeploymentId == null &&\n    phase === PHASE_PRODUCTION_BUILD &&\n    ciEnvironment.hasNextSupport &&\n    process.env.NEXT_DEPLOYMENT_ID\n  ) {\n    if (\n      result.deploymentId != null &&\n      result.deploymentId !== process.env.NEXT_DEPLOYMENT_ID\n    ) {\n      throw new Error(\n        `The NEXT_DEPLOYMENT_ID environment variable value \"${process.env.NEXT_DEPLOYMENT_ID}\" does not match the provided deploymentId \"${result.deploymentId}\" in the config.`\n      )\n    }\n    result.experimental.runtimeServerDeploymentId = true\n  }\n\n  // only leverage deploymentId\n  if (process.env.NEXT_DEPLOYMENT_ID) {\n    result.deploymentId = process.env.NEXT_DEPLOYMENT_ID\n  }\n\n  const tracingRoot = result?.outputFileTracingRoot\n  const turbopackRoot = result?.turbopack?.root\n\n  // If both provided, validate they match. If not, use outputFileTracingRoot.\n  if (tracingRoot && turbopackRoot && tracingRoot !== turbopackRoot) {\n    Log.warn(\n      `Both \\`outputFileTracingRoot\\` and \\`turbopack.root\\` are set, but they must have the same value.\\n` +\n        `Using \\`outputFileTracingRoot\\` value: ${tracingRoot}.`\n    )\n  }\n\n  let rootDir = tracingRoot || turbopackRoot\n  if (!rootDir) {\n    const { rootDir: foundRootDir, lockFiles } = findRootDirAndLockFiles(dir)\n    rootDir = foundRootDir\n    if (!silent) {\n      warnDuplicatedLockFiles(lockFiles)\n    }\n  }\n\n  if (!rootDir) {\n    throw new Error(\n      'Failed to find the root directory of the project. This is a bug in Next.js.'\n    )\n  }\n\n  // Ensure both properties are set to the same value\n  result.outputFileTracingRoot = rootDir\n  dset(result, ['turbopack', 'root'], rootDir)\n\n  setHttpClientAndAgentOptions(result || defaultConfig)\n\n  if (result.i18n) {\n    const { i18n } = result\n    const i18nType = typeof i18n\n\n    if (i18nType !== 'object') {\n      throw new Error(\n        `Specified i18n should be an object received ${i18nType}.\\nSee more info here: https://nextjs.org/docs/messages/invalid-i18n-config`\n      )\n    }\n\n    if (!Array.isArray(i18n.locales)) {\n      throw new Error(\n        `Specified i18n.locales should be an Array received ${typeof i18n.locales}.\\nSee more info here: https://nextjs.org/docs/messages/invalid-i18n-config`\n      )\n    }\n\n    if (i18n.locales.length > 100 && !silent) {\n      Log.warn(\n        `Received ${i18n.locales.length} i18n.locales items which exceeds the recommended max of 100.\\nSee more info here: https://nextjs.org/docs/advanced-features/i18n-routing#how-does-this-work-with-static-generation`\n      )\n    }\n\n    const defaultLocaleType = typeof i18n.defaultLocale\n\n    if (!i18n.defaultLocale || defaultLocaleType !== 'string') {\n      throw new Error(\n        `Specified i18n.defaultLocale should be a string.\\nSee more info here: https://nextjs.org/docs/messages/invalid-i18n-config`\n      )\n    }\n\n    if (typeof i18n.domains !== 'undefined' && !Array.isArray(i18n.domains)) {\n      throw new Error(\n        `Specified i18n.domains must be an array of domain objects e.g. [ { domain: 'example.fr', defaultLocale: 'fr', locales: ['fr'] } ] received ${typeof i18n.domains}.\\nSee more info here: https://nextjs.org/docs/messages/invalid-i18n-config`\n      )\n    }\n\n    if (i18n.domains) {\n      const invalidDomainItems = i18n.domains.filter((item) => {\n        if (!item || typeof item !== 'object') return true\n        if (!item.defaultLocale) return true\n        if (!item.domain || typeof item.domain !== 'string') return true\n\n        if (item.domain.includes(':')) {\n          console.warn(\n            `i18n domain: \"${item.domain}\" is invalid it should be a valid domain without protocol (https://) or port (:3000) e.g. example.vercel.sh`\n          )\n          return true\n        }\n\n        const defaultLocaleDuplicate = i18n.domains?.find(\n          (altItem) =>\n            altItem.defaultLocale === item.defaultLocale &&\n            altItem.domain !== item.domain\n        )\n\n        if (!silent && defaultLocaleDuplicate) {\n          console.warn(\n            `Both ${item.domain} and ${defaultLocaleDuplicate.domain} configured the defaultLocale ${item.defaultLocale} but only one can. Change one item's default locale to continue`\n          )\n          return true\n        }\n\n        let hasInvalidLocale = false\n\n        if (Array.isArray(item.locales)) {\n          for (const locale of item.locales) {\n            if (typeof locale !== 'string') hasInvalidLocale = true\n\n            for (const domainItem of i18n.domains || []) {\n              if (domainItem === item) continue\n              if (domainItem.locales && domainItem.locales.includes(locale)) {\n                console.warn(\n                  `Both ${item.domain} and ${domainItem.domain} configured the locale (${locale}) but only one can. Remove it from one i18n.domains config to continue`\n                )\n                hasInvalidLocale = true\n                break\n              }\n            }\n          }\n        }\n\n        return hasInvalidLocale\n      })\n\n      if (invalidDomainItems.length > 0) {\n        throw new Error(\n          `Invalid i18n.domains values:\\n${invalidDomainItems\n            .map((item: any) => JSON.stringify(item))\n            .join(\n              '\\n'\n            )}\\n\\ndomains value must follow format { domain: 'example.fr', defaultLocale: 'fr', locales: ['fr'] }.\\nSee more info here: https://nextjs.org/docs/messages/invalid-i18n-config`\n        )\n      }\n    }\n\n    if (!Array.isArray(i18n.locales)) {\n      throw new Error(\n        `Specified i18n.locales must be an array of locale strings e.g. [\"en-US\", \"nl-NL\"] received ${typeof i18n.locales}.\\nSee more info here: https://nextjs.org/docs/messages/invalid-i18n-config`\n      )\n    }\n\n    const invalidLocales = i18n.locales.filter(\n      (locale: any) => typeof locale !== 'string'\n    )\n\n    if (invalidLocales.length > 0) {\n      throw new Error(\n        `Specified i18n.locales contains invalid values (${invalidLocales\n          .map(String)\n          .join(\n            ', '\n          )}), locales must be valid locale tags provided as strings e.g. \"en-US\".\\n` +\n          `See here for list of valid language sub-tags: http://www.iana.org/assignments/language-subtag-registry/language-subtag-registry`\n      )\n    }\n\n    if (!i18n.locales.includes(i18n.defaultLocale)) {\n      throw new Error(\n        `Specified i18n.defaultLocale should be included in i18n.locales.\\nSee more info here: https://nextjs.org/docs/messages/invalid-i18n-config`\n      )\n    }\n\n    const normalizedLocales = new Set()\n    const duplicateLocales = new Set()\n\n    i18n.locales.forEach((locale) => {\n      const localeLower = locale.toLowerCase()\n      if (normalizedLocales.has(localeLower)) {\n        duplicateLocales.add(locale)\n      }\n      normalizedLocales.add(localeLower)\n    })\n\n    if (duplicateLocales.size > 0) {\n      throw new Error(\n        `Specified i18n.locales contains the following duplicate locales:\\n` +\n          `${[...duplicateLocales].join(', ')}\\n` +\n          `Each locale should be listed only once.\\n` +\n          `See more info here: https://nextjs.org/docs/messages/invalid-i18n-config`\n      )\n    }\n\n    // make sure default Locale is at the front\n    i18n.locales = [\n      i18n.defaultLocale,\n      ...i18n.locales.filter((locale) => locale !== i18n.defaultLocale),\n    ]\n\n    const localeDetectionType = typeof i18n.localeDetection\n\n    if (\n      localeDetectionType !== 'boolean' &&\n      localeDetectionType !== 'undefined'\n    ) {\n      throw new Error(\n        `Specified i18n.localeDetection should be undefined or a boolean received ${localeDetectionType}.\\nSee more info here: https://nextjs.org/docs/messages/invalid-i18n-config`\n      )\n    }\n  }\n\n  if (result.devIndicators !== false && result.devIndicators?.position) {\n    const { position } = result.devIndicators\n    const allowedValues = [\n      'top-left',\n      'top-right',\n      'bottom-left',\n      'bottom-right',\n    ]\n\n    if (!allowedValues.includes(position)) {\n      throw new Error(\n        `Invalid \"devIndicator.position\" provided, expected one of ${allowedValues.join(\n          ', '\n        )}, received ${position}`\n      )\n    }\n  }\n\n  if (result.cacheLife) {\n    result.cacheLife = {\n      ...defaultConfig.cacheLife,\n      ...result.cacheLife,\n    }\n    const defaultDefault = defaultConfig.cacheLife?.['default']\n    if (\n      !defaultDefault ||\n      defaultDefault.revalidate === undefined ||\n      defaultDefault.expire === undefined ||\n      !defaultConfig.experimental?.staleTimes?.static\n    ) {\n      throw new Error('No default cacheLife profile.')\n    }\n    const defaultCacheLifeProfile = result.cacheLife['default']\n    if (!defaultCacheLifeProfile) {\n      result.cacheLife['default'] = defaultDefault\n    } else {\n      if (defaultCacheLifeProfile.stale === undefined) {\n        const staticStaleTime = result.experimental.staleTimes?.static\n        defaultCacheLifeProfile.stale =\n          staticStaleTime ?? defaultConfig.experimental?.staleTimes?.static\n      }\n      if (defaultCacheLifeProfile.revalidate === undefined) {\n        defaultCacheLifeProfile.revalidate = defaultDefault.revalidate\n      }\n      if (defaultCacheLifeProfile.expire === undefined) {\n        defaultCacheLifeProfile.expire =\n          result.expireTime ?? defaultDefault.expire\n      }\n    }\n  }\n\n  if (result.cacheHandlers) {\n    const allowedHandlerNameRegex = /[a-z-]/\n\n    if (typeof result.cacheHandlers !== 'object') {\n      throw new Error(\n        `Invalid \"cacheHandlers\" provided, expected an object e.g. { default: '/my-handler.js' }, received ${JSON.stringify(result.cacheHandlers)}`\n      )\n    }\n\n    const handlerKeys = Object.keys(result.cacheHandlers)\n    const invalidHandlerItems: Array<{ key: string; reason: string }> = []\n\n    for (const key of handlerKeys) {\n      if (key === 'private') {\n        invalidHandlerItems.push({\n          key,\n          reason:\n            'The cache handler for \"use cache: private\" cannot be customized.',\n        })\n      } else if (!allowedHandlerNameRegex.test(key)) {\n        invalidHandlerItems.push({\n          key,\n          reason: 'key must only use characters a-z and -',\n        })\n      } else {\n        const handlerPath = (\n          result.cacheHandlers as {\n            [handlerName: string]: string | undefined\n          }\n        )[key]\n\n        if (handlerPath && !existsSync(handlerPath)) {\n          invalidHandlerItems.push({\n            key,\n            reason: `cache handler path provided does not exist, received ${handlerPath}`,\n          })\n        }\n      }\n      if (invalidHandlerItems.length) {\n        throw new Error(\n          `Invalid handler fields configured for \"cacheHandlers\":\\n${invalidHandlerItems.map((item) => `${key}: ${item.reason}`).join('\\n')}`\n        )\n      }\n    }\n  }\n\n  const userProvidedModularizeImports = result.modularizeImports\n  // Unfortunately these packages end up re-exporting 10600 modules, for example: https://unpkg.com/browse/@mui/icons-material@5.11.16/esm/index.js.\n  // Leveraging modularizeImports tremendously reduces compile times for these.\n  result.modularizeImports = {\n    ...(userProvidedModularizeImports || {}),\n    // This is intentionally added after the user-provided modularizeImports config.\n    '@mui/icons-material': {\n      transform: '@mui/icons-material/{{member}}',\n    },\n    lodash: {\n      transform: 'lodash/{{member}}',\n    },\n  }\n\n  const userProvidedOptimizePackageImports =\n    result.experimental?.optimizePackageImports || []\n\n  result.experimental.optimizePackageImports = [\n    ...new Set([\n      ...userProvidedOptimizePackageImports,\n      'lucide-react',\n      'date-fns',\n      'lodash-es',\n      'ramda',\n      'antd',\n      'react-bootstrap',\n      'ahooks',\n      '@ant-design/icons',\n      '@headlessui/react',\n      '@headlessui-float/react',\n      '@heroicons/react/20/solid',\n      '@heroicons/react/24/solid',\n      '@heroicons/react/24/outline',\n      '@visx/visx',\n      '@tremor/react',\n      'rxjs',\n      '@mui/material',\n      '@mui/icons-material',\n      'recharts',\n      'react-use',\n      'effect',\n      '@effect/schema',\n      '@effect/platform',\n      '@effect/platform-node',\n      '@effect/platform-browser',\n      '@effect/platform-bun',\n      '@effect/sql',\n      '@effect/sql-mssql',\n      '@effect/sql-mysql2',\n      '@effect/sql-pg',\n      '@effect/sql-sqlite-node',\n      '@effect/sql-sqlite-bun',\n      '@effect/sql-sqlite-wasm',\n      '@effect/sql-sqlite-react-native',\n      '@effect/rpc',\n      '@effect/rpc-http',\n      '@effect/typeclass',\n      '@effect/experimental',\n      '@effect/opentelemetry',\n      '@material-ui/core',\n      '@material-ui/icons',\n      '@tabler/icons-react',\n      'mui-core',\n      // We don't support wildcard imports for these configs, e.g. `react-icons/*`\n      // so we need to add them manually.\n      // In the future, we should consider automatically detecting packages that\n      // need to be optimized.\n      'react-icons/ai',\n      'react-icons/bi',\n      'react-icons/bs',\n      'react-icons/cg',\n      'react-icons/ci',\n      'react-icons/di',\n      'react-icons/fa',\n      'react-icons/fa6',\n      'react-icons/fc',\n      'react-icons/fi',\n      'react-icons/gi',\n      'react-icons/go',\n      'react-icons/gr',\n      'react-icons/hi',\n      'react-icons/hi2',\n      'react-icons/im',\n      'react-icons/io',\n      'react-icons/io5',\n      'react-icons/lia',\n      'react-icons/lib',\n      'react-icons/lu',\n      'react-icons/md',\n      'react-icons/pi',\n      'react-icons/ri',\n      'react-icons/rx',\n      'react-icons/si',\n      'react-icons/sl',\n      'react-icons/tb',\n      'react-icons/tfi',\n      'react-icons/ti',\n      'react-icons/vsc',\n      'react-icons/wi',\n    ]),\n  ]\n\n  if (!result.htmlLimitedBots) {\n    // @ts-expect-error: override the htmlLimitedBots with default string, type covert: RegExp -> string\n    result.htmlLimitedBots = HTML_LIMITED_BOT_UA_RE_STRING\n  }\n\n  if (\n    typeof result.experimental.mcpServer === 'undefined' &&\n    process.env.__NEXT_EXPERIMENTAL_MCP_SERVER === 'true'\n  ) {\n    result.experimental.mcpServer = true\n  }\n\n  if (result.cacheComponents) {\n    // TODO: remove once we've finished migrating internally to cacheComponents.\n    result.experimental.ppr = true\n\n    // Prerender sourcemaps are enabled by default when using cacheComponents, unless explicitly disabled.\n    if (result.enablePrerenderSourceMaps === undefined) {\n      result.enablePrerenderSourceMaps = true\n    }\n  }\n\n  // \"use cache\" was originally implicitly enabled with the cacheComponents flag, so\n  // we transfer the value for cacheComponents to the explicit useCache flag to ensure\n  // backwards compatibility.\n  if (result.experimental.useCache === undefined) {\n    result.experimental.useCache = result.cacheComponents\n  }\n\n  // Store the distDirRoot in the config before it is modified by the isolatedDevBuild flag\n  ;(result as NextConfigComplete).distDirRoot = result.distDir\n  if (\n    phase === PHASE_DEVELOPMENT_SERVER &&\n    result.experimental.isolatedDevBuild\n  ) {\n    result.distDir = join(result.distDir, 'dev')\n  }\n\n  return result as NextConfigComplete\n}\n\nasync function applyModifyConfig(\n  config: NextConfigComplete,\n  phase: PHASE_TYPE,\n  silent: boolean\n): Promise<NextConfigComplete> {\n  // we always call modify config  and phase can be used to only\n  // modify for specific times\n  if (config.experimental?.adapterPath) {\n    const adapterMod = interopDefault(\n      await import(\n        pathToFileURL(require.resolve(config.experimental.adapterPath)).href\n      )\n    ) as NextAdapter\n\n    if (typeof adapterMod.modifyConfig === 'function') {\n      if (!silent) {\n        Log.info(`Applying modifyConfig from ${adapterMod.name}`)\n      }\n\n      config = await adapterMod.modifyConfig(config, {\n        phase,\n      })\n    }\n  }\n  return config\n}\n\n// Cache config with keys to handle multiple configurations (e.g., multi-zone)\nconst configCache = new Map<\n  string,\n  {\n    rawConfig: any\n    config: NextConfigComplete\n    configuredExperimentalFeatures: ConfiguredExperimentalFeature[]\n  }\n>()\n\n// Generate cache key based on parameters that affect config output\n// We need a unique key for cache because there can be multiple values\nfunction getCacheKey(\n  phase: PHASE_TYPE,\n  dir: string,\n  customConfig?: object | null,\n  reactProductionProfiling?: boolean,\n  debugPrerender?: boolean,\n  pid?: number\n): string {\n  // The next.config.js is unique per project, so we can use the dir as the major key\n  // to generate the unique config key. Include PID to invalidate on server restart.\n  const keyData = JSON.stringify({\n    dir,\n    phase,\n    hasCustomConfig: Boolean(customConfig),\n    reactProductionProfiling: Boolean(reactProductionProfiling),\n    debugPrerender: Boolean(debugPrerender),\n    pid: pid || 0,\n  })\n\n  return djb2Hash(keyData).toString(36)\n}\n\ntype LoadConfigOptions = {\n  customConfig?: object | null\n  rawConfig?: boolean\n  silent?: boolean\n  reportExperimentalFeatures?: (\n    configuredExperimentalFeatures: ConfiguredExperimentalFeature[]\n  ) => void\n  reactProductionProfiling?: boolean\n  debugPrerender?: boolean\n}\n\nexport default async function loadConfig(\n  phase: typeof PHASE_DEVELOPMENT_SERVER,\n  dir: string,\n  opts?: LoadConfigOptions\n): Promise<NextConfigComplete>\nexport default async function loadConfig(\n  phase: typeof PHASE_PRODUCTION_SERVER | typeof PHASE_DEVELOPMENT_SERVER,\n  dir: string,\n  opts?: LoadConfigOptions\n): Promise<NextConfigRuntime | NextConfigComplete>\nexport default async function loadConfig(\n  phase: PHASE_TYPE,\n  dir: string,\n  opts?: LoadConfigOptions\n): Promise<NextConfigComplete>\n\nexport default async function loadConfig(\n  phase: PHASE_TYPE,\n  dir: string,\n  {\n    customConfig,\n    rawConfig,\n    silent = true,\n    reportExperimentalFeatures,\n    reactProductionProfiling,\n    debugPrerender,\n  }: LoadConfigOptions = {}\n): Promise<NextConfigComplete> {\n  // Generate cache key based on parameters that affect config output\n  // Include process.pid to invalidate cache on server restart\n  const cacheKey = getCacheKey(\n    phase,\n    dir,\n    customConfig,\n    reactProductionProfiling,\n    debugPrerender,\n    process.pid\n  )\n\n  // Check if we have a cached result\n  const cachedResult = configCache.get(cacheKey)\n  if (cachedResult) {\n    // Call the experimental features callback if provided\n    if (reportExperimentalFeatures) {\n      reportExperimentalFeatures(cachedResult.configuredExperimentalFeatures)\n    }\n\n    // Return raw config if requested and available\n    if (rawConfig && cachedResult.rawConfig) {\n      return cachedResult.rawConfig\n    }\n\n    return cachedResult.config\n  } else {\n    // Reset next.config errors before loading config\n    // This happens on every config load to ensure fresh validation\n    NextInstanceErrorState.nextConfig = []\n  }\n\n  // Original implementation continues below...\n  if (!process.env.__NEXT_PRIVATE_RENDER_WORKER) {\n    try {\n      loadWebpackHook()\n    } catch (err) {\n      // this can fail in standalone mode as the files\n      // aren't traced/included\n      if (!process.env.__NEXT_PRIVATE_STANDALONE_CONFIG) {\n        throw err\n      }\n    }\n  }\n\n  if (process.env.__NEXT_PRIVATE_STANDALONE_CONFIG) {\n    // we don't apply assignDefaults or modifyConfig here as it\n    // has already been applied\n    const standaloneConfig = JSON.parse(\n      process.env.__NEXT_PRIVATE_STANDALONE_CONFIG\n    )\n\n    // Cache the standalone config\n    configCache.set(cacheKey, {\n      config: standaloneConfig,\n      rawConfig: standaloneConfig,\n      configuredExperimentalFeatures: [],\n    })\n\n    return standaloneConfig\n  }\n\n  const curLog = silent\n    ? {\n        warn: () => {},\n        info: () => {},\n        error: () => {},\n      }\n    : Log\n\n  loadEnvConfig(dir, phase === PHASE_DEVELOPMENT_SERVER, curLog)\n\n  let configFileName = 'next.config.js'\n  const configuredExperimentalFeatures: ConfiguredExperimentalFeature[] = []\n\n  if (customConfig) {\n    // Check deprecation warnings on the custom config before merging with defaults\n    checkDeprecations(customConfig as NextConfig, configFileName, silent, dir)\n\n    const config = await applyModifyConfig(\n      assignDefaultsAndValidate(\n        dir,\n        {\n          configOrigin: 'server',\n          configFileName,\n          ...customConfig,\n        },\n        silent,\n        phase\n      ),\n      phase,\n      silent\n    )\n\n    // Cache the custom config result\n    configCache.set(cacheKey, {\n      config,\n      rawConfig: customConfig,\n      configuredExperimentalFeatures,\n    })\n\n    reportExperimentalFeatures?.(configuredExperimentalFeatures)\n\n    return config\n  }\n\n  const path = await findUp(CONFIG_FILES, { cwd: dir })\n\n  // If config file was found\n  if (path?.length) {\n    configFileName = basename(path)\n\n    let userConfigModule: any\n    try {\n      const envBefore = Object.assign({}, process.env)\n\n      // `import()` expects url-encoded strings, so the path must be properly\n      // escaped and (especially on Windows) absolute paths must pe prefixed\n      // with the `file://` protocol\n      if (process.env.__NEXT_TEST_MODE === 'jest') {\n        // dynamic import does not currently work inside of vm which\n        // jest relies on so we fall back to require for this case\n        // https://github.com/nodejs/node/issues/35889\n        userConfigModule = require(path)\n      } else if (configFileName === 'next.config.ts') {\n        userConfigModule = await transpileConfig({\n          nextConfigPath: path,\n          configFileName,\n          cwd: dir,\n        })\n      } else {\n        userConfigModule = await import(pathToFileURL(path).href)\n      }\n      const newEnv: typeof process.env = {} as any\n\n      for (const key of Object.keys(process.env)) {\n        if (envBefore[key] !== process.env[key]) {\n          newEnv[key] = process.env[key]\n        }\n      }\n      updateInitialEnv(newEnv)\n\n      if (rawConfig) {\n        // Cache the raw config\n        configCache.set(cacheKey, {\n          config: userConfigModule as NextConfigComplete,\n          rawConfig: userConfigModule,\n          configuredExperimentalFeatures,\n        })\n\n        reportExperimentalFeatures?.(configuredExperimentalFeatures)\n\n        return userConfigModule\n      }\n    } catch (err) {\n      // Capture the error for MCP tool reporting\n      NextInstanceErrorState.nextConfig.push(err)\n\n      // TODO: Modify docs to add cases of failing next.config.ts transformation\n      curLog.error(\n        `Failed to load ${configFileName}, see more info here https://nextjs.org/docs/messages/next-config-error`\n      )\n      throw err\n    }\n\n    const loadedConfig = Object.freeze(\n      (await normalizeConfig(\n        phase,\n        interopDefault(userConfigModule)\n      )) as NextConfig\n    )\n\n    if (loadedConfig.experimental) {\n      for (const name of Object.keys(\n        loadedConfig.experimental\n      ) as (keyof ExperimentalConfig)[]) {\n        const value = loadedConfig.experimental[name]\n\n        if (name.startsWith('turbopack') && !process.env.TURBOPACK) {\n          // Ignore any Turbopack config if Turbopack is not enabled\n          continue\n        }\n\n        addConfiguredExperimentalFeature(\n          configuredExperimentalFeatures,\n          name,\n          value\n        )\n      }\n    }\n\n    // Clone a new userConfig each time to avoid mutating the original\n    const userConfig = cloneObject(loadedConfig) as NextConfig\n\n    // Check deprecation warnings on the actual user config before merging with defaults\n    checkDeprecations(userConfig, configFileName, silent, dir)\n\n    // Always validate the config against schema in non minimal mode\n    if (!process.env.NEXT_MINIMAL && !silent) {\n      await validateConfigSchema(\n        userConfig,\n        configFileName,\n        curLog.warn,\n        (messages) => {\n          // Capture validation messages for MCP error reporting\n          if (messages.length > 0) {\n            const fullMessage = messages.join('\\n')\n            NextInstanceErrorState.nextConfig.push(new Error(fullMessage))\n          }\n        }\n      )\n    }\n\n    if ((userConfig as any).target && (userConfig as any).target !== 'server') {\n      throw new Error(\n        `The \"target\" property is no longer supported in ${configFileName}.\\n` +\n          'See more info here https://nextjs.org/docs/messages/deprecated-target-config'\n      )\n    }\n\n    if (reactProductionProfiling) {\n      userConfig.reactProductionProfiling = reactProductionProfiling\n    }\n\n    if (userConfig.experimental?.useLightningcss) {\n      const { loadBindings } =\n        require('../build/swc') as typeof import('../build/swc')\n      const isLightningSupported = (\n        await loadBindings(userConfig.experimental?.useWasmBinary)\n      )?.css?.lightning\n\n      if (!isLightningSupported) {\n        curLog.warn(\n          `experimental.useLightningcss is set, but the setting is disabled because next-swc/wasm does not support it yet.`\n        )\n        userConfig.experimental.useLightningcss = false\n      }\n    }\n\n    // serialize the regex config into string\n    if (userConfig?.htmlLimitedBots instanceof RegExp) {\n      // @ts-expect-error: override the htmlLimitedBots with default string, type covert: RegExp -> string\n      userConfig.htmlLimitedBots = userConfig.htmlLimitedBots.source\n    }\n\n    enforceExperimentalFeatures(userConfig, {\n      isDefaultConfig: false,\n      configuredExperimentalFeatures,\n      debugPrerender,\n      phase,\n    })\n\n    const completeConfig = assignDefaultsAndValidate(\n      dir,\n      {\n        configOrigin: relative(dir, path),\n        configFile: path,\n        configFileName,\n        ...userConfig,\n      },\n      silent,\n      phase\n    )\n\n    const finalConfig = await applyModifyConfig(completeConfig, phase, silent)\n\n    // Cache the final result\n    configCache.set(cacheKey, {\n      config: finalConfig,\n      rawConfig: userConfigModule, // Store the original user config module\n      configuredExperimentalFeatures,\n    })\n\n    if (reportExperimentalFeatures) {\n      reportExperimentalFeatures(configuredExperimentalFeatures)\n    }\n\n    return finalConfig\n  } else {\n    const configBaseName = basename(CONFIG_FILES[0], extname(CONFIG_FILES[0]))\n    const unsupportedConfig = findUp.sync(\n      [\n        `${configBaseName}.cjs`,\n        `${configBaseName}.cts`,\n        // TODO: Remove `as any` once we bump @types/node to v22.10.0+\n        ...((process.features as any).typescript ? [] : ['next.config.mts']),\n        `${configBaseName}.json`,\n        `${configBaseName}.jsx`,\n        `${configBaseName}.tsx`,\n      ],\n      { cwd: dir }\n    )\n    if (unsupportedConfig?.length) {\n      throw new Error(\n        `Configuring Next.js via '${basename(\n          unsupportedConfig\n        )}' is not supported. Please replace the file with 'next.config.js', 'next.config.mjs', or 'next.config.ts'.`\n      )\n    }\n  }\n\n  const clonedDefaultConfig = cloneObject(defaultConfig) as NextConfig\n\n  enforceExperimentalFeatures(clonedDefaultConfig, {\n    isDefaultConfig: true,\n    configuredExperimentalFeatures,\n    debugPrerender,\n    phase,\n  })\n\n  // always call assignDefaults to ensure settings like\n  // reactRoot can be updated correctly even with no next.config.js\n  const completeConfig = assignDefaultsAndValidate(\n    dir,\n    { ...clonedDefaultConfig, configFileName },\n    silent,\n    phase\n  ) as NextConfigComplete\n\n  setHttpClientAndAgentOptions(completeConfig)\n\n  const finalConfig = await applyModifyConfig(completeConfig, phase, silent)\n\n  // Cache the default config result\n  configCache.set(cacheKey, {\n    config: finalConfig,\n    rawConfig: clonedDefaultConfig,\n    configuredExperimentalFeatures,\n  })\n\n  if (reportExperimentalFeatures) {\n    reportExperimentalFeatures(configuredExperimentalFeatures)\n  }\n\n  return finalConfig\n}\n\nexport type ConfiguredExperimentalFeature = {\n  key: keyof ExperimentalConfig\n  value: ExperimentalConfig[keyof ExperimentalConfig]\n  reason?: string\n}\n\nfunction enforceExperimentalFeatures(\n  config: NextConfig,\n  options: {\n    isDefaultConfig: boolean\n    configuredExperimentalFeatures: ConfiguredExperimentalFeature[] | undefined\n    debugPrerender: boolean | undefined\n    phase: PHASE_TYPE\n  }\n) {\n  const {\n    configuredExperimentalFeatures,\n    debugPrerender,\n    isDefaultConfig,\n    phase,\n  } = options\n\n  config.experimental ??= {}\n\n  if (\n    debugPrerender &&\n    (phase === PHASE_PRODUCTION_BUILD || phase === PHASE_EXPORT)\n  ) {\n    // TODO: This is not an experimental feature, but should be enabled alongside other prerender debugging features.\n    config.enablePrerenderSourceMaps = true\n\n    setExperimentalFeatureForDebugPrerender(\n      config.experimental,\n      'serverSourceMaps',\n      true,\n      configuredExperimentalFeatures\n    )\n\n    setExperimentalFeatureForDebugPrerender(\n      config.experimental,\n      process.env.TURBOPACK ? 'turbopackMinify' : 'serverMinification',\n      false,\n      configuredExperimentalFeatures\n    )\n\n    setExperimentalFeatureForDebugPrerender(\n      config.experimental,\n      'prerenderEarlyExit',\n      false,\n      configuredExperimentalFeatures\n    )\n  }\n\n  // TODO: Remove this once we've made Cache Components the default.\n  if (\n    process.env.__NEXT_CACHE_COMPONENTS === 'true' &&\n    // We do respect an explicit value in the user config.\n    (config.cacheComponents === undefined ||\n      (isDefaultConfig && !config.cacheComponents))\n  ) {\n    config.cacheComponents = true\n  }\n\n  // TODO: Remove this once using the debug channel is the default.\n  if (\n    process.env.__NEXT_EXPERIMENTAL_DEBUG_CHANNEL === 'true' &&\n    // We do respect an explicit value in the user config.\n    (config.experimental.reactDebugChannel === undefined ||\n      (isDefaultConfig && !config.experimental.reactDebugChannel))\n  ) {\n    config.experimental.reactDebugChannel = true\n\n    if (configuredExperimentalFeatures) {\n      addConfiguredExperimentalFeature(\n        configuredExperimentalFeatures,\n        'reactDebugChannel',\n        true,\n        'enabled by `__NEXT_EXPERIMENTAL_DEBUG_CHANNEL`'\n      )\n    }\n  }\n\n  if (\n    process.env.__NEXT_EXPERIMENTAL_TRANSITION_INDICATOR === 'true' &&\n    // We do respect an explicit value in the user config.\n    (config.experimental.transitionIndicator === undefined ||\n      (isDefaultConfig && !config.experimental.transitionIndicator))\n  ) {\n    config.experimental.transitionIndicator = true\n\n    if (configuredExperimentalFeatures) {\n      addConfiguredExperimentalFeature(\n        configuredExperimentalFeatures,\n        'transitionIndicator',\n        true,\n        'enabled by `__NEXT_EXPERIMENTAL_TRANSITION_INDICATOR`'\n      )\n    }\n  }\n\n  if (\n    process.env.__NEXT_ENABLE_REACT_COMPILER === 'true' &&\n    // We do respect an explicit value in the user config.\n    (config.reactCompiler === undefined ||\n      (isDefaultConfig && !config.reactCompiler))\n  ) {\n    config.reactCompiler = true\n    // TODO: Report if we enable non-experimental features via env\n  }\n}\n\nfunction addConfiguredExperimentalFeature<\n  KeyType extends keyof ExperimentalConfig,\n>(\n  configuredExperimentalFeatures: ConfiguredExperimentalFeature[],\n  key: KeyType,\n  value: ExperimentalConfig[KeyType],\n  reason?: string\n) {\n  if (value !== (defaultConfig.experimental as Record<string, unknown>)[key]) {\n    configuredExperimentalFeatures.push({ key, value, reason })\n  }\n}\n\nfunction setExperimentalFeatureForDebugPrerender<\n  KeyType extends keyof ExperimentalConfig,\n>(\n  experimentalConfig: ExperimentalConfig,\n  key: KeyType,\n  value: ExperimentalConfig[KeyType],\n  configuredExperimentalFeatures: ConfiguredExperimentalFeature[] | undefined\n) {\n  if (experimentalConfig[key] !== value) {\n    experimentalConfig[key] = value\n\n    if (configuredExperimentalFeatures) {\n      const action =\n        value === true ? 'enabled' : value === false ? 'disabled' : 'set'\n\n      const reason = `${action} by \\`--debug-prerender\\``\n\n      addConfiguredExperimentalFeature(\n        configuredExperimentalFeatures,\n        key,\n        value,\n        reason\n      )\n    }\n  }\n}\n\nfunction cloneObject(obj: any): any {\n  // Primitives & null\n  if (obj === null || typeof obj !== 'object') {\n    return obj\n  }\n\n  // RegExp  clone via constructor\n  if (obj instanceof RegExp) {\n    return new RegExp(obj.source, obj.flags)\n  }\n\n  // Function  just reuse the function reference\n  if (typeof obj === 'function') {\n    return obj\n  }\n\n  // Arrays  map each element\n  if (Array.isArray(obj)) {\n    return obj.map(cloneObject)\n  }\n\n  // Detect nonplain objects (class instances)\n  const proto = Object.getPrototypeOf(obj)\n  const isPlainObject = proto === Object.prototype || proto === null\n\n  // If it's not a plain object, just return the original\n  if (!isPlainObject) {\n    return obj\n  }\n\n  // Plain object  create a new object with the same prototype\n  // and copy all properties, cloning data properties and keeping\n  // accessor properties (getters/setters) asis.\n  const result = Object.create(proto)\n  for (const key of Reflect.ownKeys(obj)) {\n    const descriptor = Object.getOwnPropertyDescriptor(obj, key)\n\n    if (descriptor && (descriptor.get || descriptor.set)) {\n      // Accessor property  copy descriptor asis (get/set functions)\n      Object.defineProperty(result, key, descriptor)\n    } else {\n      // Data property  clone the value\n      result[key] = cloneObject(obj[key])\n    }\n  }\n\n  return result\n}\n\nasync function validateConfigSchema(\n  userConfig: NextConfig,\n  configFileName: string,\n  warn: (message: string) => void,\n  onValidationMessages?: (messages: string[]) => void\n) {\n  // We only validate the config against schema in non minimal mode\n  const { configSchema } =\n    require('./config-schema') as typeof import('./config-schema')\n  const state = configSchema.safeParse(userConfig)\n\n  if (!state.success) {\n    const [warnings, fatalErrors] = normalizeNextConfigZodErrors(state.error)\n    const hasFatalErrors = fatalErrors.length > 0\n\n    // Group warnings first\n    if (warnings.length > 0) {\n      const warningMessages = [`Invalid ${configFileName} options detected: `]\n\n      for (const error of warnings) {\n        warningMessages.push(`    ${error.split('\\n').join('\\n    ')}`)\n      }\n\n      warningMessages.push(\n        'See more info here: https://nextjs.org/docs/messages/invalid-next-config'\n      )\n\n      // Call the callback with validation messages if provided\n      if (onValidationMessages) {\n        onValidationMessages(warningMessages)\n      }\n\n      for (const message of warningMessages) {\n        warn(message)\n      }\n    }\n\n    // Then throw hard errors\n    if (hasFatalErrors) {\n      await flushTelemetry()\n\n      const errorMessages = [\n        `Fatal next config errors found in ${configFileName} that must be fixed:`,\n      ]\n\n      for (const error of fatalErrors) {\n        errorMessages.push(`    ${error.split('\\n').join('\\n    ')}`)\n      }\n\n      errorMessages.push(\n        'These configuration options are required or have been migrated. Please update your configuration.'\n      )\n      errorMessages.push(\n        'See more info here: https://nextjs.org/docs/messages/invalid-next-config'\n      )\n\n      // Call the callback with validation messages if provided\n      if (onValidationMessages) {\n        onValidationMessages(errorMessages)\n      }\n\n      const fullErrorMessage = errorMessages.join('\\n')\n      throw new Error(fullErrorMessage)\n    }\n  }\n}\n"],"names":["existsSync","basename","extname","join","relative","isAbsolute","resolve","pathToFileURL","findUp","Log","ciEnvironment","CONFIG_FILES","PHASE_DEVELOPMENT_SERVER","PHASE_EXPORT","PHASE_PRODUCTION_BUILD","defaultConfig","normalizeConfig","loadWebpackHook","imageConfigDefault","loadEnvConfig","updateInitialEnv","flushTelemetry","findRootDirAndLockFiles","warnDuplicatedLockFiles","setHttpClientAndAgentOptions","pathHasPrefix","matchRemotePattern","hasNextSupport","transpileConfig","dset","normalizeZodErrors","HTML_LIMITED_BOT_UA_RE_STRING","findDir","interopDefault","djb2Hash","HardDeprecatedConfigError","NextInstanceErrorState","normalizeNextConfigZodErrors","error","warnings","fatalErrors","issues","issue","message","originalMessage","shouldExit","path","code","includes","push","warnOptionHasBeenDeprecated","config","nestedPropertyKey","reason","silent","hasWarned","current","found","nestedPropertyKeys","split","key","undefined","warnOnce","checkDeprecations","userConfig","configFileName","dir","images","domains","length","i18n","hasAppDir","Boolean","warnOptionHasBeenMovedOutOfExperimental","oldExperimentalKey","newKey","experimental","warn","newKeys","shift","warnCustomizedOption","defaultValue","customMessage","segs","seg","assignDefaultsAndValidate","phase","result","exportTrailingSlash","trailingSlash","Object","keys","reduce","currentConfig","value","Error","userDistDir","trim","Array","isArray","forEach","ext","constructor","c","k","v","trustHostHeader","allowDevelopmentBuild","process","env","NODE_ENV","TURBOPACK","sassOptions","ppr","output","rewrites","redirects","headers","assetPrefix","basePath","startsWith","endsWith","localPatterns","hasMatch","some","pattern","pathname","search","remotePatterns","map","protocol","hostname","port","proto","replace","url","URL","hasMatchForAssetPrefix","loader","loaderFile","absolutePath","outputStandalone","serverActions","bodySizeLimit","parseInt","toString","isNaN","proxyClientMaxBodySize","middlewareClientMaxBodySize","proxyPrefetch","middlewarePrefetch","externalProxyRewritesResolve","externalMiddlewareRewritesResolve","skipProxyUrlNormalize","skipMiddlewareUrlNormalize","normalizedValue","bytes","require","parse","outputFileTracingRoot","turbopack","root","runtimeServerDeploymentId","NEXT_DEPLOYMENT_ID","deploymentId","tracingRoot","turbopackRoot","rootDir","foundRootDir","lockFiles","i18nType","locales","defaultLocaleType","defaultLocale","invalidDomainItems","filter","item","domain","console","defaultLocaleDuplicate","find","altItem","hasInvalidLocale","locale","domainItem","JSON","stringify","invalidLocales","String","normalizedLocales","Set","duplicateLocales","localeLower","toLowerCase","has","add","size","localeDetectionType","localeDetection","devIndicators","position","allowedValues","cacheLife","defaultDefault","revalidate","expire","staleTimes","static","defaultCacheLifeProfile","stale","staticStaleTime","expireTime","cacheHandlers","allowedHandlerNameRegex","handlerKeys","invalidHandlerItems","test","handlerPath","userProvidedModularizeImports","modularizeImports","transform","lodash","userProvidedOptimizePackageImports","optimizePackageImports","htmlLimitedBots","mcpServer","__NEXT_EXPERIMENTAL_MCP_SERVER","cacheComponents","enablePrerenderSourceMaps","useCache","distDirRoot","distDir","isolatedDevBuild","applyModifyConfig","adapterPath","adapterMod","href","modifyConfig","info","name","configCache","Map","getCacheKey","customConfig","reactProductionProfiling","debugPrerender","pid","keyData","hasCustomConfig","loadConfig","rawConfig","reportExperimentalFeatures","cacheKey","cachedResult","get","configuredExperimentalFeatures","nextConfig","__NEXT_PRIVATE_RENDER_WORKER","err","__NEXT_PRIVATE_STANDALONE_CONFIG","standaloneConfig","set","curLog","configOrigin","cwd","userConfigModule","envBefore","assign","__NEXT_TEST_MODE","nextConfigPath","newEnv","loadedConfig","freeze","addConfiguredExperimentalFeature","cloneObject","NEXT_MINIMAL","validateConfigSchema","messages","fullMessage","target","useLightningcss","loadBindings","isLightningSupported","useWasmBinary","css","lightning","RegExp","source","enforceExperimentalFeatures","isDefaultConfig","completeConfig","configFile","finalConfig","configBaseName","unsupportedConfig","sync","features","typescript","clonedDefaultConfig","options","setExperimentalFeatureForDebugPrerender","__NEXT_CACHE_COMPONENTS","__NEXT_EXPERIMENTAL_DEBUG_CHANNEL","reactDebugChannel","__NEXT_EXPERIMENTAL_TRANSITION_INDICATOR","transitionIndicator","__NEXT_ENABLE_REACT_COMPILER","reactCompiler","experimentalConfig","action","obj","flags","getPrototypeOf","isPlainObject","prototype","create","Reflect","ownKeys","descriptor","getOwnPropertyDescriptor","defineProperty","onValidationMessages","configSchema","state","safeParse","success","hasFatalErrors","warningMessages","errorMessages","fullErrorMessage"],"mappings":"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","ignoreList":[0]}