{"version":3,"file":"count.cjs","names":["PgCountBuilder","entityKind"],"sources":["../../../src/pg-core/effect/count.ts"],"sourcesContent":["import type { Effect } from 'effect/Effect';\nimport type { TaggedDrizzleQueryError } from '~/effect-core/errors.ts';\nimport { applyEffectWrapper, type QueryEffect } from '~/effect-core/query-effect.ts';\nimport { entityKind } from '~/entity.ts';\nimport type { SQL, SQLWrapper } from '~/sql/sql.ts';\nimport type { PgDialect } from '../dialect.ts';\nimport { PgCountBuilder } from '../query-builders/count.ts';\nimport type { PgTable } from '../table.ts';\nimport type { PgViewBase } from '../view-base.ts';\nimport type { PgEffectSession } from './session.ts';\n\nexport interface PgEffectCountBuilder extends PgCountBuilder, QueryEffect<number, TaggedDrizzleQueryError> {}\n\nexport class PgEffectCountBuilder extends PgCountBuilder {\n\tstatic override readonly [entityKind]: string = 'PgEffectCountBuilder';\n\n\tprotected session: PgEffectSession;\n\n\tconstructor(\n\t\t{ source, dialect, filters, session }: {\n\t\t\tsource: PgTable | PgViewBase | SQL | SQLWrapper;\n\t\t\tfilters?: SQL<unknown>;\n\t\t\tdialect: PgDialect;\n\t\t\tsession: PgEffectSession;\n\t\t},\n\t) {\n\t\tsuper({ source, dialect, filters });\n\t\tthis.session = session;\n\t}\n\n\texecute(placeholderValues?: Record<string, unknown>): Effect<number, TaggedDrizzleQueryError> {\n\t\treturn this.session.prepareQuery<{\n\t\t\texecute: number;\n\t\t\tall: unknown;\n\t\t\tvalues: unknown;\n\t\t}>(\n\t\t\tthis.build(),\n\t\t\tundefined,\n\t\t\tundefined,\n\t\t\ttrue,\n\t\t\t(rows) => {\n\t\t\t\tconst v = rows[0]?.[0];\n\t\t\t\tif (typeof v === 'number') return v;\n\t\t\t\treturn v ? Number(v) : 0;\n\t\t\t},\n\t\t).execute(placeholderValues);\n\t}\n}\n\napplyEffectWrapper(PgEffectCountBuilder);\n"],"mappings":";;;;;;AAaA,IAAa,uBAAb,cAA0CA,oDAAe;CACxD,QAA0BC,0BAAsB;CAEhD,AAAU;CAEV,YACC,EAAE,QAAQ,SAAS,SAAS,WAM3B;AACD,QAAM;GAAE;GAAQ;GAAS;GAAS,CAAC;AACnC,OAAK,UAAU;;CAGhB,QAAQ,mBAAsF;AAC7F,SAAO,KAAK,QAAQ,aAKnB,KAAK,OAAO,EACZ,QACA,QACA,OACC,SAAS;GACT,MAAM,IAAI,KAAK,KAAK;AACpB,OAAI,OAAO,MAAM,SAAU,QAAO;AAClC,UAAO,IAAI,OAAO,EAAE,GAAG;IAExB,CAAC,QAAQ,kBAAkB;;;sDAIX,qBAAqB"}