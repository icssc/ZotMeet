{"version":3,"file":"varchar.cjs","names":["MsSqlColumnBuilder","entityKind","MsSqlColumn"],"sources":["../../../src/mssql-core/columns/varchar.ts"],"sourcesContent":["import type { ColumnBaseConfig } from '~/column.ts';\nimport { entityKind } from '~/entity.ts';\nimport type { AnyMsSqlTable } from '~/mssql-core/table.ts';\nimport { type Equal, getColumnNameAndConfig, type Writable } from '~/utils.ts';\nimport { MsSqlColumn, MsSqlColumnBuilder } from './common.ts';\n\nexport class MsSqlVarCharBuilder<TEnum extends [string, ...string[]]> extends MsSqlColumnBuilder<{\n\tdataType: Equal<TEnum, [string, ...string[]]> extends true ? 'string' : 'string enum';\n\tdata: TEnum[number];\n\tdriverParam: number | string;\n\tenumValues: TEnum;\n}, MsSqlVarCharConfig<'text', TEnum> & { rawLength: number | 'max' | undefined }> {\n\tstatic override readonly [entityKind]: string = 'MsSqlVarCharBuilder';\n\n\t/** @internal */\n\tconstructor(name: string, config: MsSqlVarCharConfig<'text', TEnum>) {\n\t\tsuper(name, config.enum?.length ? 'string enum' : 'string', 'MsSqlVarChar');\n\t\tthis.config.length = typeof config?.length === 'number' ? config.length : config?.length === 'max' ? 2147483647 : 1;\n\t\tthis.config.rawLength = config?.length;\n\t\tthis.config.enum = config.enum;\n\t\tthis.config.nonUnicode = config.nonUnicode;\n\t}\n\n\t/** @internal */\n\toverride build<TTableName extends string>(\n\t\ttable: AnyMsSqlTable<{ name: TTableName }>,\n\t) {\n\t\treturn new MsSqlVarChar(\n\t\t\ttable,\n\t\t\tthis.config,\n\t\t);\n\t}\n}\n\nexport class MsSqlVarChar<T extends ColumnBaseConfig<'string' | 'string enum'>> extends MsSqlColumn<\n\tT,\n\tMsSqlVarCharConfig<\n\t\t'text',\n\t\tT['enumValues']\n\t> & { rawLength: number | 'max' | undefined }\n> {\n\tstatic override readonly [entityKind]: string = 'MsSqlVarChar';\n\n\toverride readonly enumValues = this.config.enum;\n\n\treadonly nonUnicode: boolean = this.config.nonUnicode;\n\n\tgetSQLType(): string {\n\t\treturn this.config.rawLength === undefined\n\t\t\t? this.nonUnicode ? `nvarchar` : `varchar`\n\t\t\t: this.nonUnicode\n\t\t\t? `nvarchar(${this.config.rawLength})`\n\t\t\t: `varchar(${this.config.rawLength})`;\n\t}\n}\n\nexport class MsSqlVarCharJsonBuilder extends MsSqlColumnBuilder<{\n\tdataType: 'object json';\n\tdata: unknown;\n\tdriverParam: string;\n}, { length: number; nonUnicode: boolean; rawLength: number | 'max' | undefined }> {\n\tstatic override readonly [entityKind]: string = 'MsSqlVarCharJsonBuilder';\n\n\t/** @internal */\n\tconstructor(name: string, config: { length: number | 'max' | undefined }) {\n\t\tsuper(name, 'object json', 'MsSqlNVarCharJson');\n\t\tthis.config.length = typeof config?.length === 'number' ? config.length : config?.length === 'max' ? 2147483647 : 1;\n\t\tthis.config.rawLength = config?.length;\n\t\tthis.config.nonUnicode = true;\n\t}\n\n\t/** @internal */\n\toverride build<TTableName extends string>(\n\t\ttable: AnyMsSqlTable<{ name: TTableName }>,\n\t) {\n\t\treturn new MsSqlVarCharJson(\n\t\t\ttable,\n\t\t\tthis.config,\n\t\t);\n\t}\n}\n\nexport class MsSqlVarCharJson<T extends ColumnBaseConfig<'object json'>>\n\textends MsSqlColumn<T, { length: number; nonUnicode: boolean; rawLength: number | 'max' | undefined }>\n{\n\tstatic override readonly [entityKind]: string = 'MsSqlVarCharJson';\n\n\tgetSQLType(): string {\n\t\treturn this.config.rawLength === undefined\n\t\t\t? `nvarchar`\n\t\t\t: `nvarchar(${this.config.rawLength})`;\n\t}\n\n\toverride mapFromDriverValue(value: string): T['data'] {\n\t\treturn JSON.parse(value);\n\t}\n\n\toverride mapToDriverValue(value: T['data']): string {\n\t\treturn JSON.stringify(value);\n\t}\n}\n\nexport type MsSqlVarCharConfig<\n\tTMode extends 'text' | 'json',\n\tTEnum extends string[] | readonly string[] | undefined,\n> =\n\t& MsSqlVarCharConfigInitial<TMode, TEnum>\n\t& {\n\t\tnonUnicode: boolean;\n\t};\n\nexport type MsSqlVarCharConfigInitial<\n\tTMode extends 'text' | 'json' = 'text' | 'json',\n\tTEnum extends string[] | readonly string[] | undefined = string[] | readonly string[] | undefined,\n> = TMode extends 'text' ? {\n\t\tmode?: TMode;\n\t\tlength?: number | 'max';\n\t\tenum?: TEnum;\n\t}\n\t: {\n\t\tmode?: TMode;\n\t\tlength?: number | 'max';\n\t};\n\nexport function varchar(): MsSqlVarCharBuilder<[string, ...string[]]>;\nexport function varchar<U extends string, T extends Readonly<[U, ...U[]]>>(\n\tconfig?: MsSqlVarCharConfigInitial<'text', T | Writable<T>>,\n): MsSqlVarCharBuilder<Writable<T>>;\nexport function varchar<U extends string, T extends Readonly<[U, ...U[]]>>(\n\tname: string,\n\tconfig?: MsSqlVarCharConfigInitial<'text', T | Writable<T>>,\n): MsSqlVarCharBuilder<Writable<T>>;\nexport function varchar(\n\ta?: string | MsSqlVarCharConfigInitial<'text'>,\n\tb?: MsSqlVarCharConfigInitial<'text'>,\n): any {\n\tconst { name, config } = getColumnNameAndConfig<MsSqlVarCharConfigInitial<'text'>>(a, b);\n\n\treturn new MsSqlVarCharBuilder(name, {\n\t\t...config,\n\t\tmode: 'text',\n\t\tnonUnicode: false,\n\t} as any);\n}\n\nexport function nvarchar<\n\tU extends string,\n\tT extends Readonly<[U, ...U[]]>,\n\tTMode extends 'text' | 'json' = 'text' | 'json',\n>(\n\tconfig?: MsSqlVarCharConfigInitial<TMode, T | Writable<T>>,\n): Equal<TMode, 'json'> extends true ? MsSqlVarCharJsonBuilder\n\t: MsSqlVarCharBuilder<Writable<T>>;\nexport function nvarchar<\n\tU extends string,\n\tT extends Readonly<[U, ...U[]]>,\n\tTMode extends 'text' | 'json' = 'text' | 'json',\n>(\n\tname: string,\n\tconfig?: MsSqlVarCharConfigInitial<TMode, T | Writable<T>>,\n): Equal<TMode, 'json'> extends true ? MsSqlVarCharJsonBuilder\n\t: MsSqlVarCharBuilder<Writable<T>>;\nexport function nvarchar(\n\ta?: string | MsSqlVarCharConfigInitial,\n\tb?: MsSqlVarCharConfigInitial,\n): any {\n\tconst { name, config } = getColumnNameAndConfig<MsSqlVarCharConfigInitial>(a, b);\n\n\tif (config?.mode === 'json') {\n\t\treturn new MsSqlVarCharJsonBuilder(name, {\n\t\t\tlength: config.length,\n\t\t});\n\t}\n\n\treturn new MsSqlVarCharBuilder(name, {\n\t\tlength: config?.length,\n\t\tenum: (config as any)?.enum,\n\t\tnonUnicode: true,\n\t});\n}\n"],"mappings":";;;;;;AAMA,IAAa,sBAAb,cAA8EA,qDAKI;CACjF,QAA0BC,0BAAsB;;CAGhD,YAAY,MAAc,QAA2C;AACpE,QAAM,MAAM,OAAO,MAAM,SAAS,gBAAgB,UAAU,eAAe;AAC3E,OAAK,OAAO,SAAS,OAAO,QAAQ,WAAW,WAAW,OAAO,SAAS,QAAQ,WAAW,QAAQ,aAAa;AAClH,OAAK,OAAO,YAAY,QAAQ;AAChC,OAAK,OAAO,OAAO,OAAO;AAC1B,OAAK,OAAO,aAAa,OAAO;;;CAIjC,AAAS,MACR,OACC;AACD,SAAO,IAAI,aACV,OACA,KAAK,OACL;;;AAIH,IAAa,eAAb,cAAwFC,8CAMtF;CACD,QAA0BD,0BAAsB;CAEhD,AAAkB,aAAa,KAAK,OAAO;CAE3C,AAAS,aAAsB,KAAK,OAAO;CAE3C,aAAqB;AACpB,SAAO,KAAK,OAAO,cAAc,SAC9B,KAAK,aAAa,aAAa,YAC/B,KAAK,aACL,YAAY,KAAK,OAAO,UAAU,KAClC,WAAW,KAAK,OAAO,UAAU;;;AAItC,IAAa,0BAAb,cAA6CD,qDAIsC;CAClF,QAA0BC,0BAAsB;;CAGhD,YAAY,MAAc,QAAgD;AACzE,QAAM,MAAM,eAAe,oBAAoB;AAC/C,OAAK,OAAO,SAAS,OAAO,QAAQ,WAAW,WAAW,OAAO,SAAS,QAAQ,WAAW,QAAQ,aAAa;AAClH,OAAK,OAAO,YAAY,QAAQ;AAChC,OAAK,OAAO,aAAa;;;CAI1B,AAAS,MACR,OACC;AACD,SAAO,IAAI,iBACV,OACA,KAAK,OACL;;;AAIH,IAAa,mBAAb,cACSC,8CACT;CACC,QAA0BD,0BAAsB;CAEhD,aAAqB;AACpB,SAAO,KAAK,OAAO,cAAc,SAC9B,aACA,YAAY,KAAK,OAAO,UAAU;;CAGtC,AAAS,mBAAmB,OAA0B;AACrD,SAAO,KAAK,MAAM,MAAM;;CAGzB,AAAS,iBAAiB,OAA0B;AACnD,SAAO,KAAK,UAAU,MAAM;;;AAkC9B,SAAgB,QACf,GACA,GACM;CACN,MAAM,EAAE,MAAM,kDAAqE,GAAG,EAAE;AAExF,QAAO,IAAI,oBAAoB,MAAM;EACpC,GAAG;EACH,MAAM;EACN,YAAY;EACZ,CAAQ;;AAoBV,SAAgB,SACf,GACA,GACM;CACN,MAAM,EAAE,MAAM,kDAA6D,GAAG,EAAE;AAEhF,KAAI,QAAQ,SAAS,OACpB,QAAO,IAAI,wBAAwB,MAAM,EACxC,QAAQ,OAAO,QACf,CAAC;AAGH,QAAO,IAAI,oBAAoB,MAAM;EACpC,QAAQ,QAAQ;EAChB,MAAO,QAAgB;EACvB,YAAY;EACZ,CAAC"}