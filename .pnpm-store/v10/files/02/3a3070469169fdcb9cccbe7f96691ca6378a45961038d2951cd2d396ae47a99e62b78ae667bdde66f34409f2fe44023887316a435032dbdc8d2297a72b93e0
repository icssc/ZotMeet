{"version":3,"file":"count.cjs","names":["SQL","entityKind","countConfig: {\n\t\t\tsource: PgTable | PgViewBase | SQL | SQLWrapper;\n\t\t\tfilters?: SQL<unknown>;\n\t\t\tdialect: PgDialect;\n\t\t}"],"sources":["../../../src/pg-core/query-builders/count.ts"],"sourcesContent":["import { entityKind } from '~/entity.ts';\nimport { type QueryWithTypings, SQL, sql, type SQLWrapper } from '~/sql/sql.ts';\nimport type { PgDialect } from '../dialect.ts';\nimport type { PgTable } from '../table.ts';\nimport type { PgViewBase } from '../view-base.ts';\n\nexport class PgCountBuilder extends SQL<number> implements SQLWrapper<number> {\n\tstatic override readonly [entityKind]: string = 'PgCountBuilder';\n\n\tprivate dialect: PgDialect;\n\n\tprivate static buildEmbeddedCount(\n\t\tsource: PgTable | PgViewBase | SQL | SQLWrapper,\n\t\tfilters?: SQL<unknown>,\n\t\tparens?: boolean,\n\t): SQL<number> {\n\t\tconst where = sql` where ${filters}`.if(filters);\n\t\tconst query = sql<number>`select count(*) from ${source}${where}`;\n\n\t\treturn parens ? sql`(${query})` : query;\n\t}\n\n\tconstructor(\n\t\tprotected countConfig: {\n\t\t\tsource: PgTable | PgViewBase | SQL | SQLWrapper;\n\t\t\tfilters?: SQL<unknown>;\n\t\t\tdialect: PgDialect;\n\t\t},\n\t) {\n\t\tsuper(PgCountBuilder.buildEmbeddedCount(countConfig.source, countConfig.filters, true).queryChunks);\n\t\tthis.dialect = countConfig.dialect;\n\t\tthis.mapWith((e) => {\n\t\t\tif (typeof e === 'number') return e;\n\n\t\t\treturn Number(e ?? 0);\n\t\t});\n\t}\n\n\tprotected build(): QueryWithTypings {\n\t\tconst { filters, source } = this.countConfig;\n\t\tconst query = PgCountBuilder.buildEmbeddedCount(source, filters);\n\n\t\treturn this.dialect.sqlToQuery(query);\n\t}\n}\n"],"mappings":";;;;;AAMA,IAAa,iBAAb,MAAa,uBAAuBA,iBAA0C;CAC7E,QAA0BC,0BAAsB;CAEhD,AAAQ;CAER,OAAe,mBACd,QACA,SACA,QACc;EAEd,MAAM,QAAQ,gBAAW,wBAAwB,SADnC,gBAAG,UAAU,UAAU,GAAG,QAAQ;AAGhD,SAAO,SAAS,gBAAG,IAAI,MAAM,KAAK;;CAGnC,YACC,AAAUC,aAKT;AACD,QAAM,eAAe,mBAAmB,YAAY,QAAQ,YAAY,SAAS,KAAK,CAAC,YAAY;EANzF;AAOV,OAAK,UAAU,YAAY;AAC3B,OAAK,SAAS,MAAM;AACnB,OAAI,OAAO,MAAM,SAAU,QAAO;AAElC,UAAO,OAAO,KAAK,EAAE;IACpB;;CAGH,AAAU,QAA0B;EACnC,MAAM,EAAE,SAAS,WAAW,KAAK;EACjC,MAAM,QAAQ,eAAe,mBAAmB,QAAQ,QAAQ;AAEhE,SAAO,KAAK,QAAQ,WAAW,MAAM"}