{"version":3,"file":"timestamp.cjs","names":["CockroachDateColumnBaseBuilder","entityKind","CockroachColumn"],"sources":["../../../src/cockroach-core/columns/timestamp.ts"],"sourcesContent":["import type { AnyCockroachTable, CockroachTable } from '~/cockroach-core/table.ts';\nimport type { ColumnBaseConfig } from '~/column.ts';\nimport { entityKind } from '~/entity.ts';\nimport { type Equal, getColumnNameAndConfig } from '~/utils.ts';\nimport { CockroachColumn } from './common.ts';\nimport { CockroachDateColumnBaseBuilder } from './date.common.ts';\n\nexport class CockroachTimestampBuilder extends CockroachDateColumnBaseBuilder<\n\t{\n\t\tdataType: 'object date';\n\t\tdata: Date;\n\t\tdriverParam: string;\n\t},\n\t{ withTimezone: boolean; precision: number | undefined }\n> {\n\tstatic override readonly [entityKind]: string = 'CockroachTimestampBuilder';\n\n\tconstructor(name: string, withTimezone: boolean, precision: number | undefined) {\n\t\tsuper(name, 'object date', 'CockroachTimestamp');\n\t\tthis.config.withTimezone = withTimezone;\n\t\tthis.config.precision = precision;\n\t}\n\n\t/** @internal */\n\toverride build<TTableName extends string>(\n\t\ttable: AnyCockroachTable<{ name: TTableName }>,\n\t) {\n\t\treturn new CockroachTimestamp(\n\t\t\ttable,\n\t\t\tthis.config,\n\t\t);\n\t}\n}\n\nexport class CockroachTimestamp<T extends ColumnBaseConfig<'object date'>> extends CockroachColumn<T> {\n\tstatic override readonly [entityKind]: string = 'CockroachTimestamp';\n\n\treadonly withTimezone: boolean;\n\treadonly precision: number | undefined;\n\n\tconstructor(table: CockroachTable<any>, config: CockroachTimestampBuilder['config']) {\n\t\tsuper(table, config);\n\t\tthis.withTimezone = config.withTimezone;\n\t\tthis.precision = config.precision;\n\t}\n\n\tgetSQLType(): string {\n\t\tconst precision = this.precision === undefined ? '' : `(${this.precision})`;\n\t\treturn `timestamp${this.withTimezone ? 'tz' : ''}${precision}`;\n\t}\n\n\toverride mapFromDriverValue = (value: string): Date | null => {\n\t\treturn new Date(this.withTimezone ? value : value + '+0000');\n\t};\n\n\toverride mapToDriverValue = (value: Date | string): string => {\n\t\tif (typeof value === 'string') return value;\n\t\treturn value.toISOString();\n\t};\n}\n\nexport class CockroachTimestampStringBuilder extends CockroachDateColumnBaseBuilder<\n\t{\n\t\tdataType: 'string timestamp';\n\t\tdata: string;\n\t\tdriverParam: string;\n\t},\n\t{ withTimezone: boolean; precision: number | undefined }\n> {\n\tstatic override readonly [entityKind]: string = 'CockroachTimestampStringBuilder';\n\n\tconstructor(name: string, withTimezone: boolean, precision: number | undefined) {\n\t\tsuper(name, 'string timestamp', 'CockroachTimestampString');\n\t\tthis.config.withTimezone = withTimezone;\n\t\tthis.config.precision = precision;\n\t}\n\n\t/** @internal */\n\toverride build<TTableName extends string>(\n\t\ttable: AnyCockroachTable<{ name: TTableName }>,\n\t) {\n\t\treturn new CockroachTimestampString(\n\t\t\ttable,\n\t\t\tthis.config,\n\t\t);\n\t}\n}\n\nexport class CockroachTimestampString<T extends ColumnBaseConfig<'string timestamp'>> extends CockroachColumn<T> {\n\tstatic override readonly [entityKind]: string = 'CockroachTimestampString';\n\n\treadonly withTimezone: boolean;\n\treadonly precision: number | undefined;\n\n\tconstructor(\n\t\ttable: CockroachTable<any>,\n\t\tconfig: CockroachTimestampStringBuilder['config'],\n\t) {\n\t\tsuper(table, config);\n\t\tthis.withTimezone = config.withTimezone;\n\t\tthis.precision = config.precision;\n\t}\n\n\tgetSQLType(): string {\n\t\tconst precision = this.precision === undefined ? '' : `(${this.precision})`;\n\t\treturn `timestamp${this.withTimezone ? 'tz' : ''}${precision}`;\n\t}\n\n\toverride mapToDriverValue = (value: Date | string): string => {\n\t\tif (typeof value === 'string') return value;\n\t\treturn value.toISOString();\n\t};\n}\n\nexport type Precision = 0 | 1 | 2 | 3 | 4 | 5 | 6;\n\nexport interface CockroachTimestampConfig<TMode extends 'date' | 'string' = 'date' | 'string'> {\n\tmode?: TMode;\n\tprecision?: Precision;\n\twithTimezone?: boolean;\n}\n\nexport function timestamp<TMode extends CockroachTimestampConfig['mode'] & {}>(\n\tconfig?: CockroachTimestampConfig<TMode>,\n): Equal<TMode, 'string'> extends true ? CockroachTimestampStringBuilder\n\t: CockroachTimestampBuilder;\nexport function timestamp<TMode extends CockroachTimestampConfig['mode'] & {}>(\n\tname: string,\n\tconfig?: CockroachTimestampConfig<TMode>,\n): Equal<TMode, 'string'> extends true ? CockroachTimestampStringBuilder\n\t: CockroachTimestampBuilder;\nexport function timestamp(a?: string | CockroachTimestampConfig, b: CockroachTimestampConfig = {}) {\n\tconst { name, config } = getColumnNameAndConfig<CockroachTimestampConfig | undefined>(a, b);\n\tif (config?.mode === 'string') {\n\t\treturn new CockroachTimestampStringBuilder(name, config.withTimezone ?? false, config.precision);\n\t}\n\treturn new CockroachTimestampBuilder(name, config?.withTimezone ?? false, config?.precision);\n}\n"],"mappings":";;;;;;;AAOA,IAAa,4BAAb,cAA+CA,0EAO7C;CACD,QAA0BC,0BAAsB;CAEhD,YAAY,MAAc,cAAuB,WAA+B;AAC/E,QAAM,MAAM,eAAe,qBAAqB;AAChD,OAAK,OAAO,eAAe;AAC3B,OAAK,OAAO,YAAY;;;CAIzB,AAAS,MACR,OACC;AACD,SAAO,IAAI,mBACV,OACA,KAAK,OACL;;;AAIH,IAAa,qBAAb,cAAmFC,sDAAmB;CACrG,QAA0BD,0BAAsB;CAEhD,AAAS;CACT,AAAS;CAET,YAAY,OAA4B,QAA6C;AACpF,QAAM,OAAO,OAAO;AACpB,OAAK,eAAe,OAAO;AAC3B,OAAK,YAAY,OAAO;;CAGzB,aAAqB;EACpB,MAAM,YAAY,KAAK,cAAc,SAAY,KAAK,IAAI,KAAK,UAAU;AACzE,SAAO,YAAY,KAAK,eAAe,OAAO,KAAK;;CAGpD,AAAS,sBAAsB,UAA+B;AAC7D,SAAO,IAAI,KAAK,KAAK,eAAe,QAAQ,QAAQ,QAAQ;;CAG7D,AAAS,oBAAoB,UAAiC;AAC7D,MAAI,OAAO,UAAU,SAAU,QAAO;AACtC,SAAO,MAAM,aAAa;;;AAI5B,IAAa,kCAAb,cAAqDD,0EAOnD;CACD,QAA0BC,0BAAsB;CAEhD,YAAY,MAAc,cAAuB,WAA+B;AAC/E,QAAM,MAAM,oBAAoB,2BAA2B;AAC3D,OAAK,OAAO,eAAe;AAC3B,OAAK,OAAO,YAAY;;;CAIzB,AAAS,MACR,OACC;AACD,SAAO,IAAI,yBACV,OACA,KAAK,OACL;;;AAIH,IAAa,2BAAb,cAA8FC,sDAAmB;CAChH,QAA0BD,0BAAsB;CAEhD,AAAS;CACT,AAAS;CAET,YACC,OACA,QACC;AACD,QAAM,OAAO,OAAO;AACpB,OAAK,eAAe,OAAO;AAC3B,OAAK,YAAY,OAAO;;CAGzB,aAAqB;EACpB,MAAM,YAAY,KAAK,cAAc,SAAY,KAAK,IAAI,KAAK,UAAU;AACzE,SAAO,YAAY,KAAK,eAAe,OAAO,KAAK;;CAGpD,AAAS,oBAAoB,UAAiC;AAC7D,MAAI,OAAO,UAAU,SAAU,QAAO;AACtC,SAAO,MAAM,aAAa;;;AAqB5B,SAAgB,UAAU,GAAuC,IAA8B,EAAE,EAAE;CAClG,MAAM,EAAE,MAAM,kDAAwE,GAAG,EAAE;AAC3F,KAAI,QAAQ,SAAS,SACpB,QAAO,IAAI,gCAAgC,MAAM,OAAO,gBAAgB,OAAO,OAAO,UAAU;AAEjG,QAAO,IAAI,0BAA0B,MAAM,QAAQ,gBAAgB,OAAO,QAAQ,UAAU"}