{"version":3,"sources":["../../../../../src/build/webpack/plugins/force-complete-runtime.ts"],"sourcesContent":["import { webpack } from 'next/dist/compiled/webpack/webpack'\n\nexport default class ForceCompleteRuntimePlugin {\n  allSharedRuntimeGlobals = new Set([\n    // List is incomplete. These are the globals that are not commonly in the\n    // Webpack runtime but may show up during after Client navs.\n    // If you ever get \"__webpack_require__.X is not a function\" or similar,\n    // check https://github.com/webpack/webpack/blob/0f84d1e3bf69915dc060f23ced9dfa468a884a42/lib/RuntimeGlobals.js\n    // for which one it is and add it here.\n    webpack.RuntimeGlobals.compatGetDefaultExport,\n  ])\n\n  apply(compiler: webpack.Compiler) {\n    compiler.hooks.thisCompilation.tap(\n      'ForceCompleteRuntimePlugin',\n      (compilation) => {\n        // Ensure that each chunk uses the complete Webpack runtime.\n        // That way soft nav to a new page has the full runtime available\n        // by the time the chunk loads.\n        // This is a workaround until we can get Webpack to include runtime updates\n        // in the Flight response or the Flight Client to wait for HMR updates.\n        compilation.hooks.afterChunks.tap(\n          { name: 'ForceCompleteRuntimePlugin' },\n          (chunks) => {\n            for (const chunk of chunks) {\n              compilation.chunkGraph.addChunkRuntimeRequirements(\n                chunk,\n                this.allSharedRuntimeGlobals\n              )\n              // Just need to add runtime requirements to one chunk since we only\n              // have one runtime chunk for all other chunks.\n              break\n            }\n          }\n        )\n      }\n    )\n  }\n}\n"],"names":["webpack","ForceCompleteRuntimePlugin","apply","compiler","hooks","thisCompilation","tap","compilation","afterChunks","name","chunks","chunk","chunkGraph","addChunkRuntimeRequirements","allSharedRuntimeGlobals","Set","RuntimeGlobals","compatGetDefaultExport"],"mappings":"AAAA,SAASA,OAAO,QAAQ,qCAAoC;AAE5D,eAAe,MAAMC;IAUnBC,MAAMC,QAA0B,EAAE;QAChCA,SAASC,KAAK,CAACC,eAAe,CAACC,GAAG,CAChC,8BACA,CAACC;YACC,4DAA4D;YAC5D,iEAAiE;YACjE,+BAA+B;YAC/B,2EAA2E;YAC3E,uEAAuE;YACvEA,YAAYH,KAAK,CAACI,WAAW,CAACF,GAAG,CAC/B;gBAAEG,MAAM;YAA6B,GACrC,CAACC;gBACC,KAAK,MAAMC,SAASD,OAAQ;oBAC1BH,YAAYK,UAAU,CAACC,2BAA2B,CAChDF,OACA,IAAI,CAACG,uBAAuB;oBAI9B;gBACF;YACF;QAEJ;IAEJ;;aAlCAA,0BAA0B,IAAIC,IAAI;YAChC,yEAAyE;YACzE,4DAA4D;YAC5D,wEAAwE;YACxE,+GAA+G;YAC/G,uCAAuC;YACvCf,QAAQgB,cAAc,CAACC,sBAAsB;SAC9C;;AA4BH","ignoreList":[0]}