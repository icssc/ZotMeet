{"version":3,"file":"refresh-materialized-view.js","names":["session: CockroachSession","dialect: CockroachDialect"],"sources":["../../../src/cockroach-core/query-builders/refresh-materialized-view.ts"],"sourcesContent":["import type { CockroachDialect } from '~/cockroach-core/dialect.ts';\nimport type {\n\tCockroachPreparedQuery,\n\tCockroachQueryResultHKT,\n\tCockroachQueryResultKind,\n\tCockroachSession,\n\tPreparedQueryConfig,\n} from '~/cockroach-core/session.ts';\nimport type { CockroachMaterializedView } from '~/cockroach-core/view.ts';\nimport { entityKind } from '~/entity.ts';\nimport { QueryPromise } from '~/query-promise.ts';\nimport type { RunnableQuery } from '~/runnable-query.ts';\nimport type { Query, SQL, SQLWrapper } from '~/sql/sql.ts';\nimport { tracer } from '~/tracing.ts';\nimport type { NeonAuthToken } from '~/utils.ts';\n\n// eslint-disable-next-line @typescript-eslint/no-empty-interface\nexport interface CockroachRefreshMaterializedView<TQueryResult extends CockroachQueryResultHKT>\n\textends\n\t\tQueryPromise<CockroachQueryResultKind<TQueryResult, never>>,\n\t\tRunnableQuery<CockroachQueryResultKind<TQueryResult, never>, 'cockroach'>,\n\t\tSQLWrapper\n{\n\treadonly _: {\n\t\treadonly dialect: 'cockroach';\n\t\treadonly result: CockroachQueryResultKind<TQueryResult, never>;\n\t};\n}\n\nexport class CockroachRefreshMaterializedView<TQueryResult extends CockroachQueryResultHKT>\n\textends QueryPromise<CockroachQueryResultKind<TQueryResult, never>>\n\timplements RunnableQuery<CockroachQueryResultKind<TQueryResult, never>, 'cockroach'>, SQLWrapper\n{\n\tstatic override readonly [entityKind]: string = 'CockroachRefreshMaterializedView';\n\n\tprivate config: {\n\t\tview: CockroachMaterializedView;\n\t\tconcurrently?: boolean;\n\t\twithNoData?: boolean;\n\t};\n\n\tconstructor(\n\t\tview: CockroachMaterializedView,\n\t\tprivate session: CockroachSession,\n\t\tprivate dialect: CockroachDialect,\n\t) {\n\t\tsuper();\n\t\tthis.config = { view };\n\t}\n\n\tconcurrently(): this {\n\t\tif (this.config.withNoData !== undefined) {\n\t\t\tthrow new Error('Cannot use concurrently and withNoData together');\n\t\t}\n\t\tthis.config.concurrently = true;\n\t\treturn this;\n\t}\n\n\twithNoData(): this {\n\t\tif (this.config.concurrently !== undefined) {\n\t\t\tthrow new Error('Cannot use concurrently and withNoData together');\n\t\t}\n\t\tthis.config.withNoData = true;\n\t\treturn this;\n\t}\n\n\t/** @internal */\n\tgetSQL(): SQL {\n\t\treturn this.dialect.buildRefreshMaterializedViewQuery(this.config);\n\t}\n\n\ttoSQL(): Query {\n\t\tconst { typings: _typings, ...rest } = this.dialect.sqlToQuery(this.getSQL());\n\t\treturn rest;\n\t}\n\n\t/** @internal */\n\t_prepare(name?: string): CockroachPreparedQuery<\n\t\tPreparedQueryConfig & {\n\t\t\texecute: CockroachQueryResultKind<TQueryResult, never>;\n\t\t}\n\t> {\n\t\treturn tracer.startActiveSpan('drizzle.prepareQuery', () => {\n\t\t\treturn this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()), undefined, name, true);\n\t\t});\n\t}\n\n\tprepare(name: string): CockroachPreparedQuery<\n\t\tPreparedQueryConfig & {\n\t\t\texecute: CockroachQueryResultKind<TQueryResult, never>;\n\t\t}\n\t> {\n\t\treturn this._prepare(name);\n\t}\n\n\tprivate authToken?: NeonAuthToken;\n\t/** @internal */\n\tsetToken(token: NeonAuthToken) {\n\t\tthis.authToken = token;\n\t\treturn this;\n\t}\n\n\texecute: ReturnType<this['prepare']>['execute'] = (placeholderValues) => {\n\t\treturn tracer.startActiveSpan('drizzle.operation', () => {\n\t\t\treturn this._prepare().execute(placeholderValues, this.authToken);\n\t\t});\n\t};\n}\n"],"mappings":";;;;;AA6BA,IAAa,mCAAb,cACS,aAET;CACC,QAA0B,cAAsB;CAEhD,AAAQ;CAMR,YACC,MACA,AAAQA,SACR,AAAQC,SACP;AACD,SAAO;EAHC;EACA;AAGR,OAAK,SAAS,EAAE,MAAM;;CAGvB,eAAqB;AACpB,MAAI,KAAK,OAAO,eAAe,OAC9B,OAAM,IAAI,MAAM,kDAAkD;AAEnE,OAAK,OAAO,eAAe;AAC3B,SAAO;;CAGR,aAAmB;AAClB,MAAI,KAAK,OAAO,iBAAiB,OAChC,OAAM,IAAI,MAAM,kDAAkD;AAEnE,OAAK,OAAO,aAAa;AACzB,SAAO;;;CAIR,SAAc;AACb,SAAO,KAAK,QAAQ,kCAAkC,KAAK,OAAO;;CAGnE,QAAe;EACd,MAAM,EAAE,SAAS,UAAU,GAAG,SAAS,KAAK,QAAQ,WAAW,KAAK,QAAQ,CAAC;AAC7E,SAAO;;;CAIR,SAAS,MAIP;AACD,SAAO,OAAO,gBAAgB,8BAA8B;AAC3D,UAAO,KAAK,QAAQ,aAAa,KAAK,QAAQ,WAAW,KAAK,QAAQ,CAAC,EAAE,QAAW,MAAM,KAAK;IAC9F;;CAGH,QAAQ,MAIN;AACD,SAAO,KAAK,SAAS,KAAK;;CAG3B,AAAQ;;CAER,SAAS,OAAsB;AAC9B,OAAK,YAAY;AACjB,SAAO;;CAGR,WAAmD,sBAAsB;AACxE,SAAO,OAAO,gBAAgB,2BAA2B;AACxD,UAAO,KAAK,UAAU,CAAC,QAAQ,mBAAmB,KAAK,UAAU;IAChE"}